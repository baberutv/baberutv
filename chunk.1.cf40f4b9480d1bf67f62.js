webpackJsonp([1,2],{357:function(y,E,R){"use strict";function S(G){return function(){var K=G.apply(this,arguments);return new Promise(function(W,V){function H(q,Y){try{var z=K[q](Y),X=z.value}catch(Q){return void V(Q)}return z.done?void W(X):Promise.resolve(X).then(function(Q){H("next",Q)},function(Q){H("throw",Q)})}return H("next")})}}Object.defineProperty(E,"__esModule",{value:!0});var A=R(386),L=R.n(A),D=R(362),I=R.n(D),O=R(327),C=R.n(O),F=R(7),N=R.n(F),M=R(367),B=R.i(D.createStyleSheet)("Video",()=>({container:{backgroundColor:"#000",margin:0},video:{display:"block",height:"auto",margin:"0 auto",maxWidth:"100%",padding:"90px 0 20px",width:"1280px"}}));class U extends F.Component{constructor(){super(...arguments),this.hls=null,this.handleBeforeUnload=this.handleBeforeUnload.bind(this),this.handleCanPlay=this.handleCanPlay.bind(this)}componentDidMount(){window.addEventListener("beforeunload",this.handleBeforeUnload),"undefined"!=typeof this.videoElement.playsInline&&(this.videoElement.playsInline=!0);var G=this.videoElement.canPlayType("application/vnd.apple.mpegURL");!["probably","maybe"].includes(G)&&L.a.isSupported()&&(this.hls=new L.a),this.props.src&&this.loadSource(this.props.src)}componentWillReceiveProps(G){var K=G.src;this.props.src!==K&&this.loadSource(K)}shouldComponentUpdate(G){return this.props.src!==G.src}componentWillUnmount(){this.hls&&this.hls.destroy(),window.removeEventListener("beforeunload",this.handleBeforeUnload)}handleBeforeUnload(G){if(!this.videoElement.paused){var K="";return G.preventDefault(),Object.assign(G,{returnValue:K}),K}}handleCanPlay(){var G=this.props.src;M.a.transaction("rw",M.a.videos,S(function*(){G&&1>(yield M.a.videos.where("uri").equals(G).count())&&(yield M.a.videos.add({uri:G,createdAt:new Date}))}))}loadSource(G){this.hls?G?(this.hls.attachMedia(this.videoElement),this.hls.loadSource(G)):!this.hls.url&&this.hls.destroy():this.videoElement.src=G,G||this.videoElement.pause()}render(){var G=this.context.styleManager.render(B);return N.a.createElement("div",{className:G.container},N.a.createElement("video",{autoPlay:!0,className:G.video,controls:!0,onCanPlay:this.handleCanPlay,ref:(K)=>this.videoElement=K}))}}E["default"]=U,U.contextTypes={setVideo:F.PropTypes.func.isRequired,styleManager:C.a.muiRequired},U.defaultProps={src:null},U.displayName="Video",U.propTypes={src:F.PropTypes.string}},367:function(y,E,R){"use strict";var S=R(384),A=new S.a("media");A.version(1).stores({videos:"++id,name,uri,createdAt"}),E.a=A},384:function(y,E,R){"use strict";(function(S,A){function L(Ca,wa){return"object"==typeof wa?(ct(wa).forEach(function(Fa){Ca[Fa]=wa[Fa]}),Ca):Ca}function D(Ca,wa){return mt.call(Ca,wa)}function I(Ca,wa){"function"==typeof wa&&(wa=wa(pt(Ca))),ct(wa).forEach(function(Fa){O(Ca,Fa,wa[Fa])})}function O(Ca,wa,Fa,Na){yt(Ca,wa,L(Fa&&D(Fa,"get")&&"function"==typeof Fa.get?{get:Fa.get,set:Fa.set,configurable:!0}:{value:Fa,configurable:!0,writable:!0},Na))}function C(Ca){return{from:function(wa){return Ca.prototype=Object.create(wa.prototype),O(Ca.prototype,"constructor",Ca),{extend:I.bind(null,Ca.prototype)}}}}function F(Ca,wa){var Fa=ht(Ca,wa),Na;return Fa||(Na=pt(Ca))&&F(Na,wa)}function N(Ca,wa,Fa){return vt.call(Ca,wa,Fa)}function M(Ca,wa){return wa(Ca)}function B(Ca){var wa=setTimeout(Ca,1e3);clearTimeout(wa)}function U(Ca){if(!Ca)throw new Error("Assertion Failed")}function G(Ca){gt.setImmediate?A(Ca):setTimeout(Ca,0)}function K(Ca,wa){return Ca.reduce(function(Fa,Na,Ma){var Ba=wa(Na,Ma);return Ba&&(Fa[Ba[0]]=Ba[1]),Fa},{})}function W(Ca,wa){return function(){try{Ca.apply(this,arguments)}catch(Fa){wa(Fa)}}}function V(Ca,wa,Fa){try{Ca.apply(null,Fa)}catch(Na){wa&&wa(Na)}}function H(Ca,wa){if(D(Ca,wa))return Ca[wa];if(!wa)return Ca;if("string"!=typeof wa){for(var Fa=[],Na=0,Ma=wa.length,Ba;Na<Ma;++Na)Ba=H(Ca,wa[Na]),Fa.push(Ba);return Fa}var Ua=wa.indexOf(".");if(-1!==Ua){var Ga=Ca[wa.substr(0,Ua)];return Ga===void 0?void 0:H(Ga,wa.substr(Ua+1))}}function q(Ca,wa,Fa){if(Ca&&void 0!==wa&&!("isFrozen"in Object&&Object.isFrozen(Ca)))if("string"!=typeof wa&&"length"in wa){U("string"!=typeof Fa&&"length"in Fa);for(var Na=0,Ma=wa.length;Na<Ma;++Na)q(Ca,wa[Na],Fa[Na])}else{var Ba=wa.indexOf(".");if(-1!==Ba){var Ua=wa.substr(0,Ba),Ga=wa.substr(Ba+1);if(""===Ga)void 0===Fa?delete Ca[Ua]:Ca[Ua]=Fa;else{var Ka=Ca[Ua];Ka||(Ka=Ca[Ua]={}),q(Ka,Ga,Fa)}}else void 0===Fa?delete Ca[wa]:Ca[wa]=Fa}}function z(Ca){var wa={};for(var Fa in Ca)D(Ca,Fa)&&(wa[Fa]=Ca[Fa]);return wa}function X(Ca){return _t.apply([],Ca)}function Q(Ca){if(!Ca||"object"!=typeof Ca)return Ca;var wa;if(ft(Ca)){wa=[];for(var Fa=0,Na=Ca.length;Fa<Na;++Fa)wa.push(Q(Ca[Fa]))}else if(0<=bt.indexOf(Ca.constructor))wa=Ca;else for(var Ma in wa=Ca.constructor?Object.create(Ca.constructor.prototype):{},Ca)D(Ca,Ma)&&(wa[Ma]=Q(Ca[Ma]));return wa}function Z(Ca,wa,Fa,Na){return Fa=Fa||{},Na=Na||"",ct(Ca).forEach(function(Ma){if(!D(wa,Ma))Fa[Na+Ma]=void 0;else{var Ba=Ca[Ma],Ua=wa[Ma];"object"==typeof Ba&&"object"==typeof Ua&&Ba&&Ua&&Ba.constructor===Ua.constructor?Z(Ba,Ua,Fa,Na+Ma+"."):Ba!==Ua&&(Fa[Na+Ma]=wa[Ma])}}),ct(wa).forEach(function(Ma){D(Ca,Ma)||(Fa[Na+Ma]=wa[Ma])}),Fa}function J(Ca){var wa,Fa,Na,Ma;if(1===arguments.length){if(ft(Ca))return Ca.slice();if(this===Tt&&"string"==typeof Ca)return[Ca];if(Ma=kt(Ca)){for(Fa=[];Na=Ma.next(),!Na.done;)Fa.push(Na.value);return Fa}if(null==Ca)return[Ca];if(wa=Ca.length,"number"==typeof wa){for(Fa=Array(wa);wa--;)Fa[wa]=Ca[wa];return Fa}return[Ca]}for(wa=arguments.length,Fa=Array(wa);wa--;)Fa[wa]=arguments[wa];return Fa}function $(Ca,wa){Rt=Ca,St=wa}function ee(){"use strict";if(At)try{throw ee.arguments,new Error}catch(Ca){return Ca}return new Error}function te(Ca,wa){var Fa=Ca.stack;return Fa?(wa=wa||0,0===Fa.indexOf(Ca.name)&&(wa+=(Ca.name+Ca.message).split("\n").length),Fa.split("\n").slice(wa).filter(St).map(function(Na){return"\n"+Na}).join("")):""}function ae(Ca,wa){return function(){return console.warn(Ca+" is deprecated. See https://github.com/dfahlander/Dexie.js/wiki/Deprecations. "+te(ee(),1)),wa.apply(this,arguments)}}function ne(Ca,wa){this._e=ee(),this.name=Ca,this.message=wa}function oe(Ca,wa){return Ca+". Errors: "+wa.map(function(Fa){return Fa.toString()}).filter(function(Fa,Na,Ma){return Ma.indexOf(Fa)===Na}).join("\n")}function le(Ca,wa,Fa,Na){this._e=ee(),this.failures=wa,this.failedKeys=Na,this.successCount=Fa}function ie(Ca,wa){this._e=ee(),this.name="BulkError",this.failures=wa,this.message=oe(Ca,wa)}function de(){}function ue(Ca){return Ca}function ce(Ca,wa){return null==Ca||Ca===ue?wa:function(Fa){return wa(Ca(Fa))}}function fe(Ca,wa){return function(){Ca.apply(this,arguments),wa.apply(this,arguments)}}function ge(Ca,wa){return Ca===de?wa:function(){var Fa=Ca.apply(this,arguments);void 0!==Fa&&(arguments[0]=Fa);var Na=this.onsuccess,Ma=this.onerror;this.onsuccess=null,this.onerror=null;var Ba=wa.apply(this,arguments);return Na&&(this.onsuccess=this.onsuccess?fe(Na,this.onsuccess):Na),Ma&&(this.onerror=this.onerror?fe(Ma,this.onerror):Ma),void 0===Ba?Fa:Ba}}function pe(Ca,wa){return Ca===de?wa:function(){Ca.apply(this,arguments);var Fa=this.onsuccess,Na=this.onerror;this.onsuccess=this.onerror=null,wa.apply(this,arguments),Fa&&(this.onsuccess=this.onsuccess?fe(Fa,this.onsuccess):Fa),Na&&(this.onerror=this.onerror?fe(Na,this.onerror):Na)}}function me(Ca,wa){return Ca===de?wa:function(Fa){var Na=Ca.apply(this,arguments);L(Fa,Na);var Ma=this.onsuccess,Ba=this.onerror;this.onsuccess=null,this.onerror=null;var Ua=wa.apply(this,arguments);return Ma&&(this.onsuccess=this.onsuccess?fe(Ma,this.onsuccess):Ma),Ba&&(this.onerror=this.onerror?fe(Ba,this.onerror):Ba),void 0===Na?void 0===Ua?void 0:Ua:L(Na,Ua)}}function ye(Ca,wa){return Ca===de?wa:function(){return!1!==wa.apply(this,arguments)&&Ca.apply(this,arguments)}}function he(Ca,wa){return Ca===de?wa:function(){var Fa=Ca.apply(this,arguments);if(Fa&&"function"==typeof Fa.then){for(var Na=this,Ma=arguments.length,Ba=Array(Ma);Ma--;)Ba[Ma]=arguments[Ma];return Fa.then(function(){return wa.apply(Na,Ba)})}return wa.apply(this,arguments)}}function ve(Ca){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=de,this._lib=!1;var wa=this._PSD=na;if(Rt&&(this._stackHolder=ee(),this._prev=null,this._numPrev=0),"function"!=typeof Ca){if(Ca!==Nt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&ke(this,this._value))}this._state=null,this._value=null,++wa.ref,Ee(this,Ca)}function be(Ca,wa,Fa,Na,Ma){this.onFulfilled="function"==typeof Ca?Ca:null,this.onRejected="function"==typeof wa?wa:null,this.resolve=Fa,this.reject=Na,this.psd=Ma}function Ee(Ca,wa){try{wa(function(Fa){if(null===Ca._state){if(Fa===Ca)throw new TypeError("A promise cannot be resolved with itself.");var Na=Ca._lib&&Pe();Fa&&"function"==typeof Fa.then?Ee(Ca,function(Ma,Ba){Fa instanceof ve?Fa._then(Ma,Ba):Fa.then(Ma,Ba)}):(Ca._state=!0,Ca._value=Fa,Te(Ca)),Na&&Ie()}},ke.bind(null,Ca))}catch(Fa){ke(Ca,Fa)}}function ke(Ca,wa){if(ea.push(wa),null===Ca._state){var Fa=Ca._lib&&Pe();wa=aa(wa),Ca._state=!1,Ca._value=wa,Rt&&null!==wa&&"object"==typeof wa&&!wa._promise&&V(function(){var Na=F(wa,"stack");wa._promise=Ca,O(wa,"stack",{get:function(){return zt?Na&&(Na.get?Na.get.apply(wa):Na.value):Ca.stack}})}),Ce(Ca),Te(Ca),Fa&&Ie()}}function Te(Ca){var wa=Ca._listeners;Ca._listeners=[];for(var Fa=0,Na=wa.length;Fa<Na;++Fa)Re(Ca,wa[Fa]);var Ma=Ca._PSD;--Ma.ref||Ma.finalize(),0==la&&(++la,Qt(function(){0==--la&&xe()},[]))}function Re(Ca,wa){if(null===Ca._state)return void Ca._listeners.push(wa);var Fa=Ca._state?wa.onFulfilled:wa.onRejected;return null===Fa?(Ca._state?wa.resolve:wa.reject)(Ca._value):void(++wa.psd.ref,++la,Qt(Se,[Fa,Ca,wa]))}function Se(Ca,wa,Fa){try{ta=wa;var Ma=wa._value,Na;wa._state?Na=Ca(Ma):(ea.length&&(ea=[]),Na=Ca(Ma),-1===ea.indexOf(Ma)&&we(wa)),Fa.resolve(Na)}catch(Ba){Fa.reject(Ba)}finally{ta=null,0==--la&&xe(),--Fa.psd.ref||Fa.psd.finalize()}}function Ae(Ca,wa,Fa){if(wa.length===Fa)return wa;var Na="";if(!1===Ca._state){var Ma=Ca._value,Ba,Ua;null==Ma?(Ba=Ma,Ua=""):(Ba=Ma.name||"Error",Ua=Ma.message||Ma,Na=te(Ma,0)),wa.push(Ba+(Ua?": "+Ua:"")+Na)}return Rt&&(Na=te(Ca._stackHolder,2),Na&&-1===wa.indexOf(Na)&&wa.push(Na),Ca._prev&&Ae(Ca._prev,wa,Fa)),wa}function Le(Ca,wa){var Fa=wa?wa._numPrev+1:0;Fa<Mt&&(Ca._prev=wa,Ca._numPrev=Fa)}function De(){Pe()&&Ie()}function Pe(){var Ca=Zt;return Zt=!1,Jt=!1,Ca}function Ie(){var Ca,wa,Fa;do for(;0<oa.length;)for(Ca=oa,oa=[],Fa=Ca.length,wa=0;wa<Fa;++wa){var Na=Ca[wa];Na[0].apply(null,Na[1])}while(0<oa.length);Zt=!0,Jt=!0}function xe(){var Ca=$t;$t=[],Ca.forEach(function(Na){Na._PSD.onunhandled.call(null,Na._value,Na)});for(var wa=ia.slice(0),Fa=wa.length;Fa;)wa[--Fa]()}function Oe(Ca){function wa(){Ca(),ia.splice(ia.indexOf(wa),1)}ia.push(wa),++la,Qt(function(){0==--la&&xe()},[])}function Ce(Ca){$t.some(function(wa){return wa._value===Ca._value})||$t.push(Ca)}function we(Ca){for(var wa=$t.length;wa;)if($t[--wa]._value===Ca._value)return void $t.splice(wa,1)}function Fe(Ca){return new ve(Nt,!1,Ca)}function Ne(Ca,wa){var Fa=na;return function(){var Na=Pe(),Ma=na;try{return We(Fa,!0),Ca.apply(this,arguments)}catch(Ba){wa&&wa(Ba)}finally{We(Ma,!1),Na&&Ie()}}}function Me(Ca,wa,Fa,Na){var Ma=na,Ba=Object.create(Ma);Ba.parent=Ma,Ba.ref=0,Ba.global=!1,Ba.id=++ma;var Ua=ra.env;Ba.env=Yt?{Promise:ve,all:ve.all,race:ve.race,resolve:ve.resolve,reject:ve.reject,nthen:ze(Ua.nthen,Ba),gthen:ze(Ua.gthen,Ba)}:{},wa&&L(Ba,wa),++Ma.ref,Ba.finalize=function(){--this.parent.ref||this.parent.finalize()};var Ga=He(Ba,Ca,Fa,Na);return 0===Ba.ref&&Ba.finalize(),Ga}function Be(){return da.id||(da.id=++ca),++da.awaits,da.echoes+=Ut,da.id}function Ue(Ca){!da.awaits||Ca&&Ca!==da.id||(0==--da.awaits&&(da.id=0),da.echoes=da.awaits*Ut)}function Ge(Ca){return da.echoes&&Ca&&Ca.constructor===Ht?(Be(),Ca.then(function(wa){return Ue(),wa},function(wa){return Ue(),ha(wa)})):Ca}function Ke(Ca){++pa,da.echoes&&0!=--da.echoes||(da.echoes=da.id=0),fa.push(na),We(Ca,!0)}function je(){var Ca=fa[fa.length-1];fa.pop(),We(Ca,!1)}function We(Ca,wa){var Fa=na;if(((wa?da.echoes&&(!ga++||Ca!==na):ga&&(! --ga||Ca!==na))&&qe(wa?Ke.bind(null,Ca):je),Ca!==na)&&(na=Ca,Fa===ra&&(ra.env=Ve()),Yt)){var Na=ra.env.Promise,Ma=Ca.env;jt.then=Ma.nthen,Na.prototype.then=Ma.gthen,(Fa.global||Ca.global)&&(gt.Promise=Ma.Promise,Na.all=Ma.all,Na.race=Ma.race,Na.resolve=Ma.resolve,Na.reject=Ma.reject)}}function Ve(){var Ca=gt.Promise;return Yt?{Promise:Ca,all:Ca.all,race:Ca.race,resolve:Ca.resolve,reject:Ca.reject,nthen:jt.then,gthen:Ca.prototype.then}:{}}function He(Ca,wa,Fa,Na,Ma){var Ba=na;try{return We(Ca,!0),wa(Fa,Na,Ma)}finally{We(Ba,!1)}}function qe(Ca){Vt.call(Kt,Ca)}function Ye(Ca,wa,Fa){return"function"==typeof Ca?function(){var Na=na;Fa&&Be(),We(wa,!0);try{return Ca.apply(this,arguments)}finally{We(Na,!1)}}:Ca}function ze(Ca,wa){return function(Fa,Na){return Ca.call(this,Ye(Fa,wa,!1),Ye(Na,wa,!1))}}function Xe(Ca,wa){var Fa;try{Fa=wa.onuncatched(Ca)}catch(Ba){}if(!1!==Fa)try{var Ma={promise:wa,reason:Ca},Na;if(gt.document&&document.createEvent?(Na=document.createEvent("Event"),Na.initEvent(ya,!0,!0),L(Na,Ma)):gt.CustomEvent&&(Na=new CustomEvent(ya,{detail:Ma}),L(Na,Ma)),Na&&gt.dispatchEvent&&(dispatchEvent(Na),!gt.PromiseRejectionEvent&&gt.onunhandledrejection))try{gt.onunhandledrejection(Na)}catch(Ba){}Na.defaultPrevented||console.warn("Unhandled rejection: "+(Ca.stack||Ca))}catch(Ba){}}function Qe(Ca){function wa(Ga,Ka,ja){if("object"==typeof Ga)return Fa(Ga);Ka||(Ka=ye),ja||(ja=de);var Wa={subscribers:[],fire:ja,subscribe:function(Va){-1===Wa.subscribers.indexOf(Va)&&(Wa.subscribers.push(Va),Wa.fire=Ka(Wa.fire,Va))},unsubscribe:function(Va){Wa.subscribers=Wa.subscribers.filter(function(Ha){return Ha!==Va}),Wa.fire=Wa.subscribers.reduce(Ka,ja)}};return Na[Ga]=Ma[Ga]=Wa,Wa}function Fa(Ga){ct(Ga).forEach(function(Ka){var ja=Ga[Ka];if(ft(ja))wa(Ka,Ga[Ka][0],Ga[Ka][1]);else if("asap"===ja)var Wa=wa(Ka,ue,function(){for(var Ha=arguments.length,qa=Array(Ha);Ha--;)qa[Ha]=arguments[Ha];Wa.subscribers.forEach(function(Ya){G(function(){Ya.apply(null,qa)})})});else throw new Ct.InvalidArgument("Invalid event config")})}var Na={},Ma=function(Ga,Ka){if(Ka){for(var ja=arguments.length,Wa=Array(ja-1);--ja;)Wa[ja-1]=arguments[ja];return Na[Ga].subscribe.apply(null,Wa),Ca}return"string"==typeof Ga?Na[Ga]:void 0};Ma.addEventType=wa;for(var Ba=1,Ua=arguments.length;Ba<Ua;++Ba)wa(arguments[Ba]);return Ma}function Ze(Ca,wa){function Na(Kr){this._cfg={version:Kr,storesSource:null,dbschema:{},tables:{},contentUpgrade:null},this.stores({})}function Ma(Kr,jr,Wr){var Vr=Cr._createTransaction(Or,Rr,kr);Vr.create(jr),Vr._completion.catch(Wr);var Hr=Vr._reject.bind(Vr);Me(function(){na.trans=Vr,0===Kr?(ct(kr).forEach(function(qr){Ga(jr,qr,kr[qr].primKey,kr[qr].indexes)}),ve.follow(function(){return Cr.on.populate.fire(Vr)}).catch(Hr)):Ba(Kr,Vr,jr).catch(Hr)})}function Ba(Kr,jr,Wr){function Vr(){return Hr.length?ve.resolve(Hr.shift()(jr.idbtrans)).then(Vr):ve.resolve()}var Hr=[],qr=Tr.filter(function(Xr){return Xr._cfg.version===Kr})[0];if(!qr)throw new Ct.Upgrade("Dexie specification of currently installed DB version is missing");kr=Cr._dbSchema=qr._cfg.dbschema;var Yr=!1,zr=Tr.filter(function(Xr){return Xr._cfg.version>Kr});return zr.forEach(function(Xr){Hr.push(function(){var Qr=kr,Zr=Xr._cfg.dbschema;pr(Qr,Wr),pr(Zr,Wr),kr=Cr._dbSchema=Zr;var Jr=Ua(Qr,Zr);if(Jr.add.forEach(function($r){Ga(Wr,$r[0],$r[1].primKey,$r[1].indexes)}),Jr.change.forEach(function($r){if($r.recreate)throw new Ct.Upgrade("Not yet support for changing primary key");else{var en=Wr.objectStore($r.name);$r.add.forEach(function(tn){Wa(en,tn)}),$r.change.forEach(function(tn){en.deleteIndex(tn.name),Wa(en,tn)}),$r.del.forEach(function(tn){en.deleteIndex(tn)})}}),Xr._cfg.contentUpgrade)return Yr=!0,ve.follow(function(){Xr._cfg.contentUpgrade(jr)})}),Hr.push(function(Qr){if(!Yr||!Aa){var Zr=Xr._cfg.dbschema;ja(Zr,Qr)}})}),Vr().then(function(){Ka(kr,Wr)})}function Ua(Kr,jr){var Wr={del:[],add:[],change:[]};for(var Vr in Kr)jr[Vr]||Wr.del.push(Vr);for(Vr in jr){var Hr=Kr[Vr],qr=jr[Vr];if(!Hr)Wr.add.push([Vr,qr]);else{var Yr={name:Vr,def:qr,recreate:!1,del:[],add:[],change:[]};if(Hr.primKey.src!==qr.primKey.src)Yr.recreate=!0,Wr.change.push(Yr);else{var zr=Hr.idxByName,Xr=qr.idxByName;for(var Qr in zr)Xr[Qr]||Yr.del.push(Qr);for(Qr in Xr){var Zr=zr[Qr],Jr=Xr[Qr];Zr?Zr.src!==Jr.src&&Yr.change.push(Jr):Yr.add.push(Jr)}(0<Yr.del.length||0<Yr.add.length||0<Yr.change.length)&&Wr.change.push(Yr)}}}return Wr}function Ga(Kr,jr,Wr,Vr){var Hr=Kr.db.createObjectStore(jr,Wr.keyPath?{keyPath:Wr.keyPath,autoIncrement:Wr.auto}:{autoIncrement:Wr.auto});return Vr.forEach(function(qr){Wa(Hr,qr)}),Hr}function Ka(Kr,jr){ct(Kr).forEach(function(Wr){jr.db.objectStoreNames.contains(Wr)||Ga(jr,Wr,Kr[Wr].primKey,Kr[Wr].indexes)})}function ja(Kr,jr){for(var Wr=0,Vr;Wr<jr.db.objectStoreNames.length;++Wr)Vr=jr.db.objectStoreNames[Wr],null==Kr[Vr]&&jr.db.deleteObjectStore(Vr)}function Wa(Kr,jr){Kr.createIndex(jr.name,jr.keyPath,{unique:jr.unique,multiEntry:jr.multi})}function Va(Kr,jr,Wr){if(!Ir&&!na.letThrough){if(!Dr){if(!_r)return ha(new Ct.DatabaseClosed);Cr.open().catch(de)}return Fr.then(function(){return Va(Kr,jr,Wr)})}var Vr=Cr._createTransaction(Kr,jr,kr);try{Vr.create()}catch(Hr){return ha(Hr)}return Vr._promise(Kr,function(Hr,qr){return Me(function(){return na.trans=Vr,Wr(Hr,qr,Vr)})}).then(function(Hr){return Vr._completion.then(function(){return Hr})})}function Ha(Kr,jr,Wr){var Vr=arguments.length;if(2>Vr)throw new Ct.InvalidArgument("Too few arguments");for(var Hr=Array(Vr-1);--Vr;)Hr[Vr-1]=arguments[Vr];Wr=Hr.pop();var qr=X(Hr);return[Kr,qr,Wr]}function qa(Kr,jr,Wr){this.name=Kr,this.schema=jr,this._tx=Wr,this.hook=Sr[Kr]?Sr[Kr].hook:Qe(null,{creating:[ge,de],reading:[ce,ue],updating:[me,de],deleting:[pe,de]})}function Ya(Kr,jr,Wr){return(Wr?rt:tt)(function(Vr){Kr.push(Vr),jr&&jr()})}function za(Kr,jr,Wr,Vr,Hr){return new ve(function(qr,Yr){var zr=Wr.length,Xr=zr-1;if(0===zr)return qr();if(!Vr)for(var Qr=0,Zr;Qr<zr;++Qr)Zr=Kr.delete(Wr[Qr]),Zr.onerror=tt(Yr),Qr===Xr&&(Zr.onsuccess=Ne(function(){return qr()}));else{var $r=rt(Yr),en=et(null),Jr;V(function(){for(var tn=0;tn<zr;++tn){Jr={onsuccess:null,onerror:null};var an=Wr[tn];Hr.call(Jr,an[0],an[1],jr);var rn=Kr.delete(an[0]);rn._hookCtx=Jr,rn.onerror=$r,rn.onsuccess=tn===Xr?et(qr):en}},function(tn){throw Jr.onerror&&Jr.onerror(tn),tn})}})}function Xa(Kr,jr,Wr,Vr){var Hr=this;this.db=Cr,this.mode=Kr,this.storeNames=jr,this.idbtrans=null,this.on=Qe(this,"complete","error","abort"),this.parent=Vr||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new ve(function(qr,Yr){Hr._resolve=qr,Hr._reject=Yr}),this._completion.then(function(){Hr.active=!1,Hr.on.complete.fire()},function(qr){var Yr=Hr.active;return Hr.active=!1,Hr.on.error.fire(qr),Hr.parent?Hr.parent._reject(qr):Yr&&Hr.idbtrans&&Hr.idbtrans.abort(),ha(qr)})}function Qa(Kr,jr,Wr){this._ctx={table:Kr,index:":id"===jr?null:jr,or:Wr}}function Za(Kr,jr){var Wr=null,Vr=null;if(jr)try{Wr=jr()}catch(Yr){Vr=Yr}var Hr=Kr._ctx,qr=Hr.table;this._ctx={table:qr,index:Hr.index,isPrimKey:!Hr.index||qr.schema.primKey.keyPath&&Hr.index===qr.schema.primKey.name,range:Wr,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:Infinity,error:Vr,or:Hr.or,valueMapper:qr.hook.reading.fire}}function Ja(Kr,jr){return!(Kr.filter||Kr.algorithm||Kr.or)&&(jr?Kr.justLimit:!Kr.replayFilter)}function $a(Kr,jr){return Kr._cfg.version-jr._cfg.version}function tr(Kr,jr,Wr){jr.forEach(function(Vr){var Hr=Wr[Vr];Kr.forEach(function(qr){Vr in qr||(qr===Xa.prototype||qr instanceof Xa?O(qr,Vr,{get:function(){return this.table(Vr)}}):qr[Vr]=new qa(Vr,Hr))})})}function ar(Kr){Kr.forEach(function(jr){for(var Wr in jr)jr[Wr]instanceof qa&&delete jr[Wr]})}function rr(Kr,jr,Wr,Vr,Hr,qr){var Yr=qr?function(Xr,Qr,Zr){return Wr(qr(Xr),Qr,Zr)}:Wr,zr=Ne(Yr,Hr);Kr.onerror||(Kr.onerror=tt(Hr)),Kr.onsuccess=jr?W(function(){var Qr=Kr.result;if(Qr){var Zr=function(){Qr.continue()};jr(Qr,function(Jr){Zr=Jr},Vr,Hr)&&zr(Qr.value,Qr,function(Jr){Zr=Jr}),Zr()}else Vr()},Hr):W(function(){var Qr=Kr.result;if(Qr){var Zr=function(){Qr.continue()};zr(Qr.value,Qr,function(Jr){Zr=Jr}),Zr()}else Vr()},Hr)}function nr(Kr){var jr=[];return Kr.split(",").forEach(function(Wr){Wr=Wr.trim();var Vr=Wr.replace(/([&*]|\+\+)/g,""),Hr=/^\[/.test(Vr)?Vr.match(/^\[(.*)\]$/)[1].split("+"):Vr;jr.push(new lt(Vr,Hr||null,/\&/.test(Wr),/\*/.test(Wr),/\+\+/.test(Wr),ft(Hr),/\./.test(Wr)))}),jr}function or(Kr,jr){return br.cmp(Kr,jr)}function lr(Kr,jr){return 0>or(Kr,jr)?Kr:jr}function ir(Kr,jr){return 0<or(Kr,jr)?Kr:jr}function sr(Kr,jr){return br.cmp(Kr,jr)}function dr(Kr,jr){return br.cmp(jr,Kr)}function ur(Kr,jr){return Kr<jr?-1:Kr===jr?0:1}function cr(Kr,jr){return Kr>jr?-1:Kr===jr?0:1}function fr(Kr,jr){return Kr?jr?function(){return Kr.apply(this,arguments)&&jr.apply(this,arguments)}:Kr:jr}function gr(){if(Cr.verno=Ar.version/10,Cr._dbSchema=kr={},Rr=N(Ar.objectStoreNames,0),0!==Rr.length){var Kr=Ar.transaction(dt(Rr),"readonly");Rr.forEach(function(jr){for(var Wr=Kr.objectStore(jr),Vr=Wr.keyPath,Hr=Vr&&"string"==typeof Vr&&-1!==Vr.indexOf("."),qr=new lt(Vr,Vr||"",!1,!1,!!Wr.autoIncrement,Vr&&"string"!=typeof Vr,Hr),Yr=[],zr=0,Xr;zr<Wr.indexNames.length;++zr){Xr=Wr.index(Wr.indexNames[zr]),Vr=Xr.keyPath,Hr=Vr&&"string"==typeof Vr&&-1!==Vr.indexOf(".");var Qr=new lt(Xr.name,Vr,!!Xr.unique,!!Xr.multiEntry,!1,Vr&&"string"!=typeof Vr,Hr);Yr.push(Qr)}kr[jr]=new st(jr,qr,Yr,{})}),tr([Sr],ct(kr),kr)}}function pr(Kr,jr){for(var Wr=jr.db.objectStoreNames,Vr=0;Vr<Wr.length;++Vr){var Hr=Wr[Vr],qr=jr.objectStore(Hr);Gr="getAll"in qr;for(var Yr=0;Yr<qr.indexNames.length;++Yr){var zr=qr.indexNames[Yr],Xr=qr.index(zr).keyPath,Qr="string"==typeof Xr?Xr:"["+N(Xr).join("+")+"]";if(Kr[Hr]){var Zr=Kr[Hr].idxByName[Qr];Zr&&(Zr.name=zr)}}}}function mr(Kr){Cr.on("blocked").fire(Kr),Ra.filter(function(jr){return jr.name===Cr.name&&jr!==Cr&&!jr._vcFired}).map(function(jr){return jr.on("versionchange").fire(Kr)})}var yr=Ze.dependencies,hr=L({addons:Ze.addons,autoOpen:!0,indexedDB:yr.indexedDB,IDBKeyRange:yr.IDBKeyRange},wa),vr=hr.addons,_r=hr.autoOpen,br=hr.indexedDB,Er=hr.IDBKeyRange,kr=this._dbSchema={},Tr=[],Rr=[],Sr={},Ar=null,Lr=null,Dr=!1,Pr=null,Ir=!1,xr="readonly",Or="readwrite",Cr=this,wr,Fr=new ve(function(Kr){wr=Kr}),Nr,Mr=new ve(function(Kr,jr){Nr=jr}),Br=!0,Ur=!!ut(br),Gr;this.version=function(Kr){if(Ar||Dr)throw new Ct.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,Kr);var jr=Tr.filter(function(Wr){return Wr._cfg.version===Kr})[0];return jr?jr:(jr=new Na(Kr),Tr.push(jr),Tr.sort($a),Br=!1,jr)},L(Na.prototype,{stores:function(Kr){this._cfg.storesSource=this._cfg.storesSource?L(this._cfg.storesSource,Kr):Kr;var jr={};Tr.forEach(function(Vr){L(jr,Vr._cfg.storesSource)});var Wr=this._cfg.dbschema={};return this._parseStoresSpec(jr,Wr),kr=Cr._dbSchema=Wr,ar([Sr,Cr,Xa.prototype]),tr([Sr,Cr,Xa.prototype,this._cfg.tables],ct(Wr),Wr),Rr=ct(Wr),this},upgrade:function(Kr){var jr=this;return Ia(function(){Kr(Cr._createTransaction(Or,ct(jr._cfg.dbschema),jr._cfg.dbschema))}),this._cfg.contentUpgrade=Kr,this},_parseStoresSpec:function(Kr,jr){ct(Kr).forEach(function(Wr){if(null!==Kr[Wr]){var Vr={},Hr=nr(Kr[Wr]),qr=Hr.shift();if(qr.multi)throw new Ct.Schema("Primary key cannot be multi-valued");qr.keyPath&&q(Vr,qr.keyPath,qr.auto?0:qr.keyPath),Hr.forEach(function(Yr){if(Yr.auto)throw new Ct.Schema("Only primary key can be marked as autoIncrement (++)");if(!Yr.keyPath)throw new Ct.Schema("Index must have a name and cannot be an empty string");q(Vr,Yr.keyPath,Yr.compound?Yr.keyPath.map(function(){return""}):"")}),jr[Wr]=new st(Wr,qr,Hr,Vr)}})}}),this._allTables=Sr,this._createTransaction=function(Kr,jr,Wr,Vr){return new Xa(Kr,jr,Wr,Vr)},this._whenReady=function(Kr){return xa||Ir||na.letThrough?Kr():new ve(function(jr,Wr){if(!Dr){if(!_r)return void Wr(new Ct.DatabaseClosed);Cr.open().catch(de)}Fr.then(jr,Wr)}).then(Kr)},this.verno=0,this.open=function(){if(Dr||Ar)return Fr.then(function(){return Lr?ha(Lr):Cr});Rt&&(Mr._stackHolder=ee()),Dr=!0,Lr=null,Ir=!1;var Kr=wr,jr=null;return ve.race([Mr,new ve(function(Wr,Vr){if(B(function(){return Wr()}),!br)throw new Ct.MissingAPI("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using old Safari versions, make sure to include indexedDB polyfill.");var Hr=Br?br.open(Ca):br.open(Ca,Math.round(10*Cr.verno));if(!Hr)throw new Ct.MissingAPI("IndexedDB API not available");Hr.onerror=tt(Vr),Hr.onblocked=Ne(mr),Hr.onupgradeneeded=Ne(function(qr){if(jr=Hr.transaction,Br&&!Cr._allowEmptyDB){Hr.onerror=nt,jr.abort(),Hr.result.close();var Yr=br.deleteDatabase(Ca);Yr.onsuccess=Yr.onerror=Ne(function(){Vr(new Ct.NoSuchDatabase("Database "+Ca+" doesnt exist"))})}else{jr.onerror=tt(Vr);var zr=qr.oldVersion>Math.pow(2,62)?0:qr.oldVersion;Ma(zr/10,jr,Vr,Hr)}},Vr),Hr.onsuccess=Ne(function(){if(jr=null,Ar=Hr.result,Ra.push(Cr),Br)gr();else if(0<Ar.objectStoreNames.length)try{pr(kr,Ar.transaction(dt(Ar.objectStoreNames),xr))}catch(qr){}Ar.onversionchange=Ne(function(qr){Cr._vcFired=!0,Cr.on("versionchange").fire(qr)}),Ur||"__dbnames"===Ca||Pa.dbnames.put({name:Ca}).catch(de),Wr()},Vr)})]).then(function(){return Pr=[],ve.resolve(Ze.vip(Cr.on.ready.fire)).then(function Wr(){if(0<Pr.length){var Vr=Pr.reduce(he,de);return Pr=[],ve.resolve(Ze.vip(Vr)).then(Wr)}})}).finally(function(){Pr=null}).then(function(){return Dr=!1,Cr}).catch(function(Wr){try{jr&&jr.abort()}catch(Vr){}return Dr=!1,Cr.close(),Lr=Wr,ha(Lr)}).finally(function(){Ir=!0,Kr()})},this.close=function(){var Kr=Ra.indexOf(Cr);if(0<=Kr&&Ra.splice(Kr,1),Ar){try{Ar.close()}catch(jr){}Ar=null}_r=!1,Lr=new Ct.DatabaseClosed,Dr&&Nr(Lr),Fr=new ve(function(jr){wr=jr}),Mr=new ve(function(jr,Wr){Nr=Wr})},this.delete=function(){var Kr=0<arguments.length;return new ve(function(jr,Wr){function Vr(){Cr.close();var Hr=br.deleteDatabase(Ca);Hr.onsuccess=Ne(function(){Ur||Pa.dbnames.delete(Ca).catch(de),jr()}),Hr.onerror=tt(Wr),Hr.onblocked=mr}if(Kr)throw new Ct.InvalidArgument("Arguments not allowed in db.delete()");Dr?Fr.then(Vr):Vr()})},this.backendDB=function(){return Ar},this.isOpen=function(){return null!==Ar},this.hasBeenClosed=function(){return Lr&&Lr instanceof Ct.DatabaseClosed},this.hasFailed=function(){return null!==Lr},this.dynamicallyOpened=function(){return Br},this.name=Ca,I(this,{tables:{get:function(){return ct(Sr).map(function(Kr){return Sr[Kr]})}}}),this.on=Qe(this,"populate","blocked","versionchange",{ready:[he,de]}),this.on.ready.subscribe=M(this.on.ready.subscribe,function(Kr){return function(jr,Wr){Ze.vip(function(){Ir?(!Lr&&ve.resolve().then(jr),Wr&&Kr(jr)):Pr?(Pr.push(jr),Wr&&Kr(jr)):(Kr(jr),!Wr&&Kr(function Vr(){Cr.on.ready.unsubscribe(jr),Cr.on.ready.unsubscribe(Vr)}))})}}),Ia(function(){Cr.on("populate").fire(Cr._createTransaction(Or,Rr,kr))}),this.transaction=function(){var Kr=Ha.apply(this,arguments);return this._transaction.apply(this,Kr)},this._transaction=function(Kr,jr,Wr){function Vr(){return ve.resolve().then(function(){var zr=na.transless||na,Xr=Cr._createTransaction(Kr,Yr,kr,Hr);Hr?Xr.idbtrans=Hr.idbtrans:Xr.create(),Wr.constructor===qt&&Be();var Zr,Jr=ve.follow(function(){if(Zr=Wr.call(Xr,Xr),Zr)if(Zr.constructor===Ht){var $r=Ue.bind(null,null);Zr.then($r,$r)}else"function"==typeof Zr.next&&"function"==typeof Zr.throw&&(Zr=ot(Zr))},{trans:Xr,transless:zr});return(Zr&&"function"==typeof Zr.then?ve.resolve(Zr).then(function($r){return Xr.active?$r:ha(new Ct.PrematureCommit("Transaction committed too early. See http://bit.ly/2eVASrf"))}):Jr.then(function(){return Zr})).then(function($r){return Hr&&Xr._resolve(),Xr._completion.then(function(){return $r})}).catch(function($r){return Xr._reject($r),ha($r)})})}var Hr=na.trans;Hr&&Hr.db===Cr&&-1===Kr.indexOf("!")||(Hr=null);var qr=-1!==Kr.indexOf("?");Kr=Kr.replace("!","").replace("?","");try{var Yr=jr.map(function(zr){var Xr=zr instanceof qa?zr.name:zr;if("string"!=typeof Xr)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return Xr});if("r"==Kr||Kr==xr)Kr=xr;else if("rw"==Kr||Kr==Or)Kr=Or;else throw new Ct.InvalidArgument("Invalid transaction mode: "+Kr);if(Hr){if(Hr.mode===xr&&Kr===Or)if(qr)Hr=null;else throw new Ct.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");Hr&&Yr.forEach(function(zr){if(Hr&&-1===Hr.storeNames.indexOf(zr))if(qr)Hr=null;else throw new Ct.SubTransaction("Table "+zr+" not included in parent transaction.")}),qr&&Hr&&!Hr.active&&(Hr=null)}}catch(zr){return Hr?Hr._promise(null,function(Xr,Qr){Qr(zr)}):ha(zr)}return Hr?Hr._promise(Kr,Vr,"lock"):na.trans?He(na.transless,function(){return Cr._whenReady(Vr)}):Cr._whenReady(Vr)},this.table=function(Kr){if(xa&&Br)return new qa(Kr);if(!D(Sr,Kr))throw new Ct.InvalidTable("Table "+Kr+" does not exist");return Sr[Kr]},I(qa.prototype,{_trans:function(jr,Wr,Vr){var Hr=this._tx||na.trans;return Hr&&Hr.db===Cr?Hr===na.trans?Hr._promise(jr,Wr,Vr):Me(function(){return Hr._promise(jr,Wr,Vr)},{trans:Hr,transless:na.transless||na}):Va(jr,[this.name],Wr)},_idbstore:function(jr,Wr,Vr){if(xa)return new ve(Wr);var qr=this.name;return this._trans(jr,function(Yr,zr,Xr){if(-1===Xr.storeNames.indexOf(qr))throw new Ct.NotFound("Table"+qr+" not part of transaction");return Wr(Yr,zr,Xr.idbtrans.objectStore(qr),Xr)},Vr)},get:function(Kr,jr){if(Kr&&Kr.constructor===Object)return this.where(Kr).first(jr);var Wr=this;return this._idbstore(xr,function(Vr,Hr,qr){xa&&Vr(Wr.schema.instanceTemplate);var Yr=qr.get(Kr);Yr.onerror=tt(Hr),Yr.onsuccess=Ne(function(){Vr(Wr.hook.reading.fire(Yr.result))},Hr)}).then(jr)},where:function(Kr){if("string"==typeof Kr)return new Qa(this,Kr);if(ft(Kr))return new Qa(this,"["+Kr.join("+")+"]");var jr=ct(Kr);if(1===jr.length)return this.where(jr[0]).equals(Kr[jr[0]]);var Wr=this.schema.indexes.concat(this.schema.primKey).filter(function(Yr){return Yr.compound&&jr.every(function(zr){return 0<=Yr.keyPath.indexOf(zr)})&&Yr.keyPath.every(function(zr){return 0<=jr.indexOf(zr)})})[0];if(Wr&&ba!==_a)return this.where(Wr.name).equals(Wr.keyPath.map(function(Yr){return Kr[Yr]}));Wr||console.warn("The query "+JSON.stringify(Kr)+" on "+this.name+" would benefit of a "+("compound index ["+jr.join("+")+"]"));var Vr=this.schema.idxByName,Hr=jr.reduce(function(Yr,zr){return[Yr[0]||Vr[zr],Yr[0]||!Vr[zr]?fr(Yr[1],function(Xr){return""+H(Xr,zr)==""+Kr[zr]}):Yr[1]]},[null,null]),qr=Hr[0];return qr?this.where(qr.name).equals(Kr[qr.keyPath]).filter(Hr[1]):Wr?this.filter(Hr[1]):this.where(jr).equals("")},count:function(Kr){return this.toCollection().count(Kr)},offset:function(Kr){return this.toCollection().offset(Kr)},limit:function(Kr){return this.toCollection().limit(Kr)},reverse:function(){return this.toCollection().reverse()},filter:function(Kr){return this.toCollection().and(Kr)},each:function(Kr){return this.toCollection().each(Kr)},toArray:function(Kr){return this.toCollection().toArray(Kr)},orderBy:function(Kr){return new Za(new Qa(this,ft(Kr)?"["+Kr.join("+")+"]":Kr))},toCollection:function(){return new Za(new Qa(this))},mapToClass:function(Kr,jr){this.schema.mappedClass=Kr;var Wr=Object.create(Kr.prototype);jr&&$e(Wr,jr),this.schema.instanceTemplate=Wr;var Vr=function(Hr){if(!Hr)return Hr;var qr=Object.create(Kr.prototype);for(var Yr in Hr)if(D(Hr,Yr))try{qr[Yr]=Hr[Yr]}catch(zr){}return qr};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=Vr,this.hook("reading",Vr),Kr},defineClass:function(Kr){return this.mapToClass(Ze.defineClass(Kr),Kr)},bulkDelete:function(Kr){return this.hook.deleting.fire===de?this._idbstore(Or,function(jr,Wr,Vr,Hr){jr(za(Vr,Hr,Kr,!1,de))}):this.where(":id").anyOf(Kr).delete().then(function(){})},bulkPut:function(Kr,jr){var Wr=this;return this._idbstore(Or,function(Vr,Hr,qr){if(!qr.keyPath&&!Wr.schema.primKey.auto&&!jr)throw new Ct.InvalidArgument("bulkPut() with non-inbound keys requires keys array in second argument");if(qr.keyPath&&jr)throw new Ct.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(jr&&jr.length!==Kr.length)throw new Ct.InvalidArgument("Arguments objects and keys must have the same length");if(0===Kr.length)return Vr();var Yr=function(nn){0===Xr.length?Vr(nn):Hr(new ie(Wr.name+".bulkPut(): "+Xr.length+" of "+Zr+" operations failed",Xr))},zr,Xr=[],Qr,Zr=Kr.length,Jr=Wr;if(Wr.hook.creating.fire===de&&Wr.hook.updating.fire===de){Qr=Ya(Xr);for(var $r=0,en=Kr.length;$r<en;++$r)zr=jr?qr.put(Kr[$r],jr[$r]):qr.put(Kr[$r]),zr.onerror=Qr;zr.onerror=Ya(Xr,Yr),zr.onsuccess=at(Yr)}else{var tn=jr||qr.keyPath&&Kr.map(function(nn){return H(nn,qr.keyPath)}),an=tn&&K(tn,function(nn,on){return null!=nn&&[nn,Kr[on]]}),rn=tn?Jr.where(":id").anyOf(tn.filter(function(nn){return null!=nn})).modify(function(){this.value=an[this.primKey],an[this.primKey]=null}).catch(le,function(nn){Xr=nn.failures}).then(function(){for(var nn=[],on=jr&&[],ln=tn.length-1,dn;0<=ln;--ln)dn=tn[ln],(null==dn||an[dn])&&(nn.push(Kr[ln]),jr&&on.push(dn),null!=dn&&(an[dn]=null));return nn.reverse(),jr&&on.reverse(),Jr.bulkAdd(nn,on)}).then(function(nn){var on=tn[tn.length-1];return null==on?nn:on}):Jr.bulkAdd(Kr);rn.then(Yr).catch(ie,function(nn){Xr=Xr.concat(nn.failures),Yr()}).catch(Hr)}},"locked")},bulkAdd:function(Kr,jr){var Wr=this,Vr=this.hook.creating.fire;return this._idbstore(Or,function(Hr,qr,Yr,zr){function Xr(on){0===Zr.length?Hr(on):qr(new ie(Wr.name+".bulkAdd(): "+Zr.length+" of "+en+" operations failed",Zr))}if(!Yr.keyPath&&!Wr.schema.primKey.auto&&!jr)throw new Ct.InvalidArgument("bulkAdd() with non-inbound keys requires keys array in second argument");if(Yr.keyPath&&jr)throw new Ct.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(jr&&jr.length!==Kr.length)throw new Ct.InvalidArgument("Arguments objects and keys must have the same length");if(0===Kr.length)return Hr();var Zr=[],en=Kr.length,Qr,Jr,$r;if(Vr!==de){var tn=Yr.keyPath,an;Jr=Ya(Zr,null,!0),$r=et(null),V(function(){for(var on=0,ln=Kr.length;on<ln;++on){an={onerror:null,onsuccess:null};var dn=jr&&jr[on],un=Kr[on],cn=jr?dn:tn?H(un,tn):void 0,gn=Vr.call(an,cn,un,zr);null==cn&&null!=gn&&(tn?(un=Q(un),q(un,tn,gn)):dn=gn),Qr=null==dn?Yr.add(un):Yr.add(un,dn),Qr._hookCtx=an,on<ln-1&&(Qr.onerror=Jr,an.onsuccess&&(Qr.onsuccess=$r))}},function(on){throw an.onerror&&an.onerror(on),on}),Qr.onerror=Ya(Zr,Xr,!0),Qr.onsuccess=et(Xr)}else{Jr=Ya(Zr);for(var rn=0,nn=Kr.length;rn<nn;++rn)Qr=jr?Yr.add(Kr[rn],jr[rn]):Yr.add(Kr[rn]),Qr.onerror=Jr;Qr.onerror=Ya(Zr,Xr),Qr.onsuccess=at(Xr)}})},add:function(Kr,jr){var Wr=this.hook.creating.fire;return this._idbstore(Or,function(Vr,Hr,qr,Yr){var zr={onsuccess:null,onerror:null};if(Wr!==de){var Xr=null==jr?qr.keyPath?H(Kr,qr.keyPath):void 0:jr,Qr=Wr.call(zr,Xr,Kr,Yr);null==Xr&&null!=Qr&&(qr.keyPath?q(Kr,qr.keyPath,Qr):jr=Qr)}try{var Zr=null==jr?qr.add(Kr):qr.add(Kr,jr);Zr._hookCtx=zr,Zr.onerror=rt(Hr),Zr.onsuccess=et(function(Jr){var $r=qr.keyPath;$r&&q(Kr,$r,Jr),Vr(Jr)})}catch(Jr){throw zr.onerror&&zr.onerror(Jr),Jr}})},put:function(Kr,jr){var Wr=this,Vr=this.hook.creating.fire,Hr=this.hook.updating.fire;if(Vr!==de||Hr!==de){var qr=this.schema.primKey.keyPath,Yr=void 0===jr?qr&&H(Kr,qr):jr;return null==Yr?this.add(Kr):(Kr=Q(Kr),this._trans(Or,function(){return Wr.where(":id").equals(Yr).modify(function(){this.value=Kr}).then(function(zr){return 0===zr?Wr.add(Kr,jr):Yr})},"locked"))}return this._idbstore(Or,function(zr,Xr,Qr){var Zr=void 0===jr?Qr.put(Kr):Qr.put(Kr,jr);Zr.onerror=tt(Xr),Zr.onsuccess=Ne(function(Jr){var $r=Qr.keyPath;$r&&q(Kr,$r,Jr.target.result),zr(Zr.result)})})},"delete":function(Kr){return this.hook.deleting.subscribers.length?this.where(":id").equals(Kr).delete():this._idbstore(Or,function(jr,Wr,Vr){var Hr=Vr.delete(Kr);Hr.onerror=tt(Wr),Hr.onsuccess=Ne(function(){jr(Hr.result)})})},clear:function(){return this.hook.deleting.subscribers.length?this.toCollection().delete():this._idbstore(Or,function(Kr,jr,Wr){var Vr=Wr.clear();Vr.onerror=tt(jr),Vr.onsuccess=Ne(function(){Kr(Vr.result)})})},update:function(Kr,jr){if("object"!=typeof jr||ft(jr))throw new Ct.InvalidArgument("Modifications must be an object.");if("object"==typeof Kr&&!ft(Kr)){ct(jr).forEach(function(Vr){q(Kr,Vr,jr[Vr])});var Wr=H(Kr,this.schema.primKey.keyPath);return void 0===Wr?ha(new Ct.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(Wr).modify(jr)}return this.where(":id").equals(Kr).modify(jr)}}),I(Xa.prototype,{_lock:function(){return U(!na.global),++this._reculock,1!==this._reculock||na.global||(na.lockOwnerFor=this),this},_unlock:function(){if(U(!na.global),0==--this._reculock)for(na.global||(na.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var Kr=this._blockedFuncs.shift();try{He(Kr[1],Kr[0])}catch(jr){}}return this},_locked:function(){return this._reculock&&na.lockOwnerFor!==this},create:function(Kr){var jr=this;if(!this.mode)return this;if(U(!this.idbtrans),!Kr&&!Ar)switch(Lr&&Lr.name){case"DatabaseClosedError":throw new Ct.DatabaseClosed(Lr);case"MissingAPIError":throw new Ct.MissingAPI(Lr.message,Lr);default:throw new Ct.OpenFailed(Lr);}if(!this.active)throw new Ct.TransactionInactive;return U(null===this._completion._state),Kr=this.idbtrans=Kr||Ar.transaction(dt(this.storeNames),this.mode),Kr.onerror=Ne(function(Wr){nt(Wr),jr._reject(Kr.error)}),Kr.onabort=Ne(function(Wr){nt(Wr),jr.active&&jr._reject(new Ct.Abort),jr.active=!1,jr.on("abort").fire(Wr)}),Kr.oncomplete=Ne(function(){jr.active=!1,jr._resolve()}),this},_promise:function(Kr,jr,Wr){var Vr=this;if(Kr===Or&&this.mode!==Or)return ha(new Ct.ReadOnly("Transaction is readonly"));if(!this.active)return ha(new Ct.TransactionInactive);if(this._locked())return new ve(function(qr,Yr){Vr._blockedFuncs.push([function(){Vr._promise(Kr,jr,Wr).then(qr,Yr)},na])});if(Wr)return Me(function(){var qr=new ve(function(Yr,zr){Vr._lock();var Xr=jr(Yr,zr,Vr);Xr&&Xr.then&&Xr.then(Yr,zr)});return qr.finally(function(){return Vr._unlock()}),qr._lib=!0,qr});var Hr=new ve(function(qr,Yr){var zr=jr(qr,Yr,Vr);zr&&zr.then&&zr.then(qr,Yr)});return Hr._lib=!0,Hr},_root:function(){return this.parent?this.parent._root():this},waitFor:function(Kr){var jr=this._root();if(Kr=ve.resolve(Kr),jr._waitingFor)jr._waitingFor=jr._waitingFor.then(function(){return Kr});else{jr._waitingFor=Kr,jr._waitingQueue=[];var Wr=jr.idbtrans.objectStore(jr.storeNames[0]);(function Hr(){for(++jr._spinCount;jr._waitingQueue.length;)jr._waitingQueue.shift()();jr._waitingFor&&(Wr.get(-Infinity).onsuccess=Hr)})()}var Vr=jr._waitingFor;return new ve(function(Hr,qr){Kr.then(function(Yr){return jr._waitingQueue.push(Ne(Hr.bind(null,Yr)))},function(Yr){return jr._waitingQueue.push(Ne(qr.bind(null,Yr)))}).finally(function(){jr._waitingFor===Vr&&(jr._waitingFor=null)})})},abort:function(){this.active&&this._reject(new Ct.Abort),this.active=!1},tables:{get:ae("Transaction.tables",function(){return Sr})},table:function(Kr){var jr=Cr.table(Kr);return new qa(Kr,jr.schema,this)}}),I(Qa.prototype,function(){function Kr(Yr,zr,Xr){var Qr=Yr instanceof Qa?new Za(Yr):Yr;return Qr._ctx.error=Xr?new Xr(zr):new TypeError(zr),Qr}function jr(Yr){return new Za(Yr,function(){return Er.only("")}).limit(0)}function Wr(Yr){return"next"===Yr?function(zr){return zr.toUpperCase()}:function(zr){return zr.toLowerCase()}}function Vr(Yr){return"next"===Yr?function(zr){return zr.toLowerCase()}:function(zr){return zr.toUpperCase()}}function Hr(Yr,zr,Xr,Qr,Zr,Jr){for(var $r=Math.min(Yr.length,Qr.length),en=-1,tn=0,an;tn<$r;++tn){if(an=zr[tn],an!==Qr[tn])return 0>Zr(Yr[tn],Xr[tn])?Yr.substr(0,tn)+Xr[tn]+Xr.substr(tn+1):0>Zr(Yr[tn],Qr[tn])?Yr.substr(0,tn)+Qr[tn]+Xr.substr(tn+1):0<=en?Yr.substr(0,en)+zr[en]+Xr.substr(en+1):null;0>Zr(Yr[tn],an)&&(en=tn)}return $r<Qr.length&&"next"===Jr?Yr+Xr.substr(Yr.length):$r<Yr.length&&"prev"===Jr?Yr.substr(0,Xr.length):0>en?null:Yr.substr(0,en)+Qr[en]+Xr.substr(en+1)}function qr(Yr,zr,Xr,Qr){function Zr(un){Jr=Wr(un),$r=Vr(un),en="next"===un?ur:cr;var cn=Xr.map(function(gn){return{lower:$r(gn),upper:Jr(gn)}}).sort(function(gn,pn){return en(gn.lower,pn.lower)});tn=cn.map(function(gn){return gn.upper}),an=cn.map(function(gn){return gn.lower}),rn=un,nn="next"===un?"":Qr}var on=Xr.length,Jr,$r,en,tn,an,rn,nn;if(!Xr.every(function(un){return"string"==typeof un}))return Kr(Yr,Ta);Zr("next");var ln=new Za(Yr,function(){return Er.bound(tn[0],an[on-1]+Qr)});ln._ondirectionchange=function(un){Zr(un)};var dn=0;return ln._addAlgorithm(function(un,cn,gn){var pn=un.key;if("string"!=typeof pn)return!1;var mn=$r(pn);if(zr(mn,an,dn))return!0;for(var yn=null,hn=dn,vn;hn<on;++hn)vn=Hr(pn,mn,tn[hn],an[hn],en,rn),null===vn&&null==yn?dn=hn+1:(null==yn||0<en(yn,vn))&&(yn=vn);return null===yn?cn(gn):cn(function(){un.continue(yn+nn)}),!1}),ln}return{between:function(Yr,zr,Xr,Qr){Xr=!1!==Xr,Qr=!0===Qr;try{return 0<or(Yr,zr)||0===or(Yr,zr)&&(Xr||Qr)&&!(Xr&&Qr)?jr(this):new Za(this,function(){return Er.bound(Yr,zr,!Xr,!Qr)})}catch(Zr){return Kr(this,ka)}},equals:function(Yr){return new Za(this,function(){return Er.only(Yr)})},above:function(Yr){return new Za(this,function(){return Er.lowerBound(Yr,!0)})},aboveOrEqual:function(Yr){return new Za(this,function(){return Er.lowerBound(Yr)})},below:function(Yr){return new Za(this,function(){return Er.upperBound(Yr,!0)})},belowOrEqual:function(Yr){return new Za(this,function(){return Er.upperBound(Yr)})},startsWith:function(Yr){return"string"==typeof Yr?this.between(Yr,Yr+_a,!0,!0):Kr(this,Ta)},startsWithIgnoreCase:function(Yr){return""===Yr?this.startsWith(Yr):qr(this,function(zr,Xr){return 0===zr.indexOf(Xr[0])},[Yr],_a)},equalsIgnoreCase:function(Yr){return qr(this,function(zr,Xr){return zr===Xr[0]},[Yr],"")},anyOfIgnoreCase:function(){var Yr=J.apply(Tt,arguments);return 0===Yr.length?jr(this):qr(this,function(zr,Xr){return-1!==Xr.indexOf(zr)},Yr,"")},startsWithAnyOfIgnoreCase:function(){var Yr=J.apply(Tt,arguments);return 0===Yr.length?jr(this):qr(this,function(zr,Xr){return Xr.some(function(Qr){return 0===zr.indexOf(Qr)})},Yr,_a)},anyOf:function(){var Yr=J.apply(Tt,arguments),zr=sr;try{Yr.sort(zr)}catch(Zr){return Kr(this,ka)}if(0===Yr.length)return jr(this);var Xr=new Za(this,function(){return Er.bound(Yr[0],Yr[Yr.length-1])});Xr._ondirectionchange=function(Zr){zr="next"===Zr?sr:dr,Yr.sort(zr)};var Qr=0;return Xr._addAlgorithm(function(Zr,Jr,$r){for(var en=Zr.key;0<zr(en,Yr[Qr]);)if(++Qr,Qr===Yr.length)return Jr($r),!1;return 0===zr(en,Yr[Qr])||(Jr(function(){Zr.continue(Yr[Qr])}),!1)}),Xr},notEqual:function(Yr){return this.inAnyRange([[Ea,Yr],[Yr,ba]],{includeLowers:!1,includeUppers:!1})},noneOf:function(){var Yr=J.apply(Tt,arguments);if(0===Yr.length)return new Za(this);try{Yr.sort(sr)}catch(Xr){return Kr(this,ka)}var zr=Yr.reduce(function(Xr,Qr){return Xr?Xr.concat([[Xr[Xr.length-1][1],Qr]]):[[Ea,Qr]]},null);return zr.push([Yr[Yr.length-1],ba]),this.inAnyRange(zr,{includeLowers:!1,includeUppers:!1})},inAnyRange:function(Yr,zr){function Xr(dn,un){for(var cn=0,gn=dn.length,pn;cn<gn;++cn)if(pn=dn[cn],0>or(un[0],pn[1])&&0<or(un[1],pn[0])){pn[0]=lr(pn[0],un[0]),pn[1]=ir(pn[1],un[1]);break}return cn===gn&&dn.push(un),dn}function Qr(dn,un){return en(dn[0],un[0])}function Zr(dn){return!rn(dn)&&!nn(dn)}if(0===Yr.length)return jr(this);if(!Yr.every(function(dn){return void 0!==dn[0]&&void 0!==dn[1]&&0>=sr(dn[0],dn[1])}))return Kr(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Ct.InvalidArgument);var Jr=!zr||!1!==zr.includeLowers,$r=zr&&!0===zr.includeUppers,en=sr,tn;try{tn=Yr.reduce(Xr,[]),tn.sort(Qr)}catch(dn){return Kr(this,ka)}var an=0,rn=$r?function(dn){return 0<sr(dn,tn[an][1])}:function(dn){return 0<=sr(dn,tn[an][1])},nn=Jr?function(dn){return 0<dr(dn,tn[an][0])}:function(dn){return 0<=dr(dn,tn[an][0])},on=rn,ln=new Za(this,function(){return Er.bound(tn[0][0],tn[tn.length-1][1],!Jr,!$r)});return ln._ondirectionchange=function(dn){"next"===dn?(on=rn,en=sr):(on=nn,en=dr),tn.sort(Qr)},ln._addAlgorithm(function(dn,un,cn){for(var gn=dn.key;on(gn);)if(++an,an===tn.length)return un(cn),!1;return!!Zr(gn)||(0===or(gn,tn[an][1])||0===or(gn,tn[an][0])?!1:(un(function(){en===sr?dn.continue(tn[an][0]):dn.continue(tn[an][1])}),!1))}),ln},startsWithAnyOf:function(){var Yr=J.apply(Tt,arguments);return Yr.every(function(zr){return"string"==typeof zr})?0===Yr.length?jr(this):this.inAnyRange(Yr.map(function(zr){return[zr,zr+_a]})):Kr(this,"startsWithAnyOf() only works with strings")}}}),I(Za.prototype,function(){function Kr(zr,Xr){zr.filter=fr(zr.filter,Xr)}function jr(zr,Xr,Qr){var Zr=zr.replayFilter;zr.replayFilter=Zr?function(){return fr(Zr(),Xr())}:Xr,zr.justLimit=Qr&&!Zr}function Wr(zr,Xr){zr.isMatch=fr(zr.isMatch,Xr)}function Vr(zr,Xr){if(zr.isPrimKey)return Xr;var Qr=zr.table.schema.idxByName[zr.index];if(!Qr)throw new Ct.Schema("KeyPath "+zr.index+" on object store "+Xr.name+" is not indexed");return Xr.index(Qr.name)}function Hr(zr,Xr){var Qr=Vr(zr,Xr);return zr.keysOnly&&"openKeyCursor"in Qr?Qr.openKeyCursor(zr.range||null,zr.dir+zr.unique):Qr.openCursor(zr.range||null,zr.dir+zr.unique)}function qr(zr,Xr,Qr,Zr,Jr){var $r=zr.replayFilter?fr(zr.filter,zr.replayFilter()):zr.filter;zr.or?function(){function en(){2==++rn&&Qr()}function tn(nn,on,ln){if(!$r||$r(on,ln,en,Zr)){var dn=on.primaryKey.toString();D(an,dn)||(an[dn]=!0,Xr(nn,on,ln))}}var an={},rn=0;zr.or._iterate(tn,en,Zr,Jr),rr(Hr(zr,Jr),zr.algorithm,tn,en,Zr,!zr.keysOnly&&zr.valueMapper)}():rr(Hr(zr,Jr),fr(zr.algorithm,$r),Xr,Qr,Zr,!zr.keysOnly&&zr.valueMapper)}function Yr(zr){return zr.table.schema.instanceTemplate}return{_read:function(zr,Xr){var Qr=this._ctx;return Qr.error?Qr.table._trans(null,ha.bind(null,Qr.error)):Qr.table._idbstore(xr,zr).then(Xr)},_write:function(zr){var Xr=this._ctx;return Xr.error?Xr.table._trans(null,ha.bind(null,Xr.error)):Xr.table._idbstore(Or,zr,"locked")},_addAlgorithm:function(zr){var Xr=this._ctx;Xr.algorithm=fr(Xr.algorithm,zr)},_iterate:function(zr,Xr,Qr,Zr){return qr(this._ctx,zr,Xr,Qr,Zr)},clone:function(zr){var Xr=Object.create(this.constructor.prototype),Qr=Object.create(this._ctx);return zr&&L(Qr,zr),Xr._ctx=Qr,Xr},raw:function(){return this._ctx.valueMapper=null,this},each:function(zr){var Xr=this._ctx;if(xa){var Qr=Yr(Xr),Zr=Xr.table.schema.primKey.keyPath,Jr=H(Qr,Xr.index?Xr.table.schema.idxByName[Xr.index].keyPath:Zr),$r=H(Qr,Zr);zr(Qr,{key:Jr,primaryKey:$r})}return this._read(function(en,tn,an){qr(Xr,zr,en,tn,an)})},count:function(zr){if(xa)return ve.resolve(0).then(zr);var Xr=this._ctx;if(Ja(Xr,!0))return this._read(function(Zr,Jr,$r){var en=Vr(Xr,$r),tn=Xr.range?en.count(Xr.range):en.count();tn.onerror=tt(Jr),tn.onsuccess=function(an){Zr(Math.min(an.target.result,Xr.limit))}},zr);var Qr=0;return this._read(function(Zr,Jr,$r){qr(Xr,function(){return++Qr,!1},function(){Zr(Qr)},Jr,$r)},zr)},sortBy:function(zr,Xr){function Qr(an,rn){return rn?Qr(an[Jr[rn]],rn-1):an[$r]}function Zr(an,rn){var nn=Qr(an,en),on=Qr(rn,en);return nn<on?-tn:nn>on?tn:0}var Jr=zr.split(".").reverse(),$r=Jr[0],en=Jr.length-1,tn="next"===this._ctx.dir?1:-1;return this.toArray(function(an){return an.sort(Zr)}).then(Xr)},toArray:function(zr){var Xr=this._ctx;return this._read(function(Qr,Zr,Jr){if(xa&&Qr([Yr(Xr)]),Gr&&"next"===Xr.dir&&Ja(Xr,!0)&&0<Xr.limit){var $r=Xr.table.hook.reading.fire,en=Vr(Xr,Jr),tn=Xr.limit<Infinity?en.getAll(Xr.range,Xr.limit):en.getAll(Xr.range);tn.onerror=tt(Zr),tn.onsuccess=$r===ue?at(Qr):at(function(rn){try{Qr(rn.map($r))}catch(nn){Zr(nn)}})}else{var an=[];qr(Xr,function(rn){an.push(rn)},function(){Qr(an)},Zr,Jr)}},zr)},offset:function(zr){var Xr=this._ctx;return 0>=zr?this:(Xr.offset+=zr,Ja(Xr)?jr(Xr,function(){var Qr=zr;return function(Zr,Jr){return 0===Qr||(1===Qr?(--Qr,!1):(Jr(function(){Zr.advance(Qr),Qr=0}),!1))}}):jr(Xr,function(){var Qr=zr;return function(){return 0>--Qr}}),this)},limit:function(zr){return this._ctx.limit=Math.min(this._ctx.limit,zr),jr(this._ctx,function(){var Xr=zr;return function(Qr,Zr,Jr){return 0>=--Xr&&Zr(Jr),0<=Xr}},!0),this},until:function(zr,Xr){var Qr=this._ctx;return xa&&zr(Yr(Qr)),Kr(this._ctx,function(Zr,Jr,$r){return!zr(Zr.value)||(Jr($r),Xr)}),this},first:function(zr){return this.limit(1).toArray(function(Xr){return Xr[0]}).then(zr)},last:function(zr){return this.reverse().first(zr)},filter:function(zr){return xa&&zr(Yr(this._ctx)),Kr(this._ctx,function(Xr){return zr(Xr.value)}),Wr(this._ctx,zr),this},and:function(zr){return this.filter(zr)},or:function(zr){return new Qa(this._ctx.table,zr,this)},reverse:function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},desc:function(){return this.reverse()},eachKey:function(zr){var Xr=this._ctx;return Xr.keysOnly=!Xr.isMatch,this.each(function(Qr,Zr){zr(Zr.key,Zr)})},eachUniqueKey:function(zr){return this._ctx.unique="unique",this.eachKey(zr)},eachPrimaryKey:function(zr){var Xr=this._ctx;return Xr.keysOnly=!Xr.isMatch,this.each(function(Qr,Zr){zr(Zr.primaryKey,Zr)})},keys:function(zr){var Xr=this._ctx;Xr.keysOnly=!Xr.isMatch;var Qr=[];return this.each(function(Zr,Jr){Qr.push(Jr.key)}).then(function(){return Qr}).then(zr)},primaryKeys:function(zr){var Xr=this._ctx;if(Gr&&"next"===Xr.dir&&Ja(Xr,!0)&&0<Xr.limit)return this._read(function(Zr,Jr,$r){var en=Vr(Xr,$r),tn=Xr.limit<Infinity?en.getAllKeys(Xr.range,Xr.limit):en.getAllKeys(Xr.range);tn.onerror=tt(Jr),tn.onsuccess=at(Zr)}).then(zr);Xr.keysOnly=!Xr.isMatch;var Qr=[];return this.each(function(Zr,Jr){Qr.push(Jr.primaryKey)}).then(function(){return Qr}).then(zr)},uniqueKeys:function(zr){return this._ctx.unique="unique",this.keys(zr)},firstKey:function(zr){return this.limit(1).keys(function(Xr){return Xr[0]}).then(zr)},lastKey:function(zr){return this.reverse().firstKey(zr)},distinct:function(){var zr=this._ctx,Xr=zr.index&&zr.table.schema.idxByName[zr.index];if(!Xr||!Xr.multi)return this;var Qr={};return Kr(this._ctx,function(Zr){var Jr=Zr.primaryKey.toString(),$r=D(Qr,Jr);return Qr[Jr]=!0,!$r}),this},modify:function(zr){var Xr=this,Qr=this._ctx,Zr=Qr.table.hook,Jr=Zr.updating.fire,$r=Zr.deleting.fire;return xa&&"function"==typeof zr&&zr.call({value:Qr.table.schema.instanceTemplate},Qr.table.schema.instanceTemplate),this._write(function(en,tn,an,rn){function on(bn){return bn&&(hn.push(bn),vn.push(_n)),tn(new le("Error modifying one or more objects",hn,mn,vn))}function ln(){yn&&mn+hn.length===pn&&(0<hn.length?on():en(mn))}var dn;if("function"==typeof zr)dn=Jr===de&&$r===de?zr:function(bn){var En=Q(bn);if(!1===zr.call(this,bn,this))return!1;if(!D(this,"value"))$r.call(this,this.primKey,bn,rn);else{var kn=Z(En,this.value),Tn=Jr.call(this,kn,this.primKey,En,rn);Tn&&(bn=this.value,ct(Tn).forEach(function(Rn){q(bn,Rn,Tn[Rn])}))}};else if(Jr===de){var un=ct(zr),cn=un.length;dn=function(bn){for(var En=!1,kn=0;kn<cn;++kn){var Tn=un[kn],Rn=zr[Tn];H(bn,Tn)!==Rn&&(q(bn,Tn,Rn),En=!0)}return En}}else{var gn=zr;zr=z(gn),dn=function(bn){var En=!1,kn=Jr.call(this,zr,this.primKey,Q(bn),rn);return kn&&L(zr,kn),ct(zr).forEach(function(Tn){var Rn=zr[Tn];H(bn,Tn)!==Rn&&(q(bn,Tn,Rn),En=!0)}),kn&&(zr=z(gn)),En}}var pn=0,mn=0,yn=!1,hn=[],vn=[],_n=null;Xr.clone().raw()._iterate(function(bn,En){function kn(Sn){return hn.push(Sn),vn.push(Tn.primKey),ln(),!0}_n=En.primaryKey;var Tn={primKey:En.primaryKey,value:bn,onsuccess:null,onerror:null};if(!1!==dn.call(Tn,bn,Tn)){var Rn=!D(Tn,"value");++pn,V(function(){var Sn=Rn?En.delete():En.update(Tn.value);Sn._hookCtx=Tn,Sn.onerror=rt(kn),Sn.onsuccess=et(function(){++mn,ln()})},kn)}else Tn.onsuccess&&Tn.onsuccess(Tn.value)},function(){yn=!0,ln()},on,an)})},"delete":function(){var zr=this,Xr=this._ctx,Qr=Xr.range,Zr=Xr.table.hook.deleting.fire,Jr=Zr!==de;if(!Jr&&Ja(Xr)&&(Xr.isPrimKey&&!La||!Qr))return this._write(function(en,tn,an){var rn=tt(tn),nn=Qr?an.count(Qr):an.count();nn.onerror=rn,nn.onsuccess=function(){var on=nn.result;V(function(){var ln=Qr?an.delete(Qr):an.clear();ln.onerror=rn,ln.onsuccess=function(){return en(on)}},function(ln){return tn(ln)})}});var $r=Jr?2e3:1e4;return this._write(function(en,tn,an,rn){var nn=0,on=zr.clone({keysOnly:!Xr.isMatch&&!Jr}).distinct().limit($r).raw(),ln=[],dn=function(){return on.each(Jr?function(un,cn){ln.push([cn.primaryKey,cn.value])}:function(un,cn){ln.push(cn.primaryKey)}).then(function(){return Jr?ln.sort(function(un,cn){return sr(un[0],cn[0])}):ln.sort(sr),za(an,rn,ln,Jr,Zr)}).then(function(){var un=ln.length;return nn+=un,ln=[],un<$r?nn:dn()})};en(dn())})}}}),L(this,{Collection:Za,Table:qa,Transaction:Xa,Version:Na,WhereClause:Qa}),function(){Cr.on("versionchange",function(Kr){0<Kr.newVersion?console.warn("Another connection wants to upgrade database '"+Cr.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+Cr.name+"'. Closing db now to resume the delete request."),Cr.close()}),Cr.on("blocked",function(Kr){!Kr.newVersion||Kr.newVersion<Kr.oldVersion?console.warn("Dexie.delete('"+Cr.name+"') was blocked"):console.warn("Upgrade '"+Cr.name+"' blocked by other connection holding version "+Kr.oldVersion/10)})}(),vr.forEach(function(Kr){Kr(Cr)})}function Je(Ca){if("function"==typeof Ca)return new Ca;if(ft(Ca))return[Je(Ca[0])];if(Ca&&"object"==typeof Ca){var wa={};return $e(wa,Ca),wa}return Ca}function $e(Ca,wa){return ct(wa).forEach(function(Fa){var Na=Je(wa[Fa]);Ca[Fa]=Na}),Ca}function et(Ca){return Ne(function(wa){var Fa=wa.target,Na=Fa.result,Ma=Fa._hookCtx,Ba=Ma&&Ma.onsuccess;Ba&&Ba(Na),Ca&&Ca(Na)},Ca)}function tt(Ca){return Ne(function(wa){return nt(wa),Ca(wa.target.error),!1})}function at(Ca){return Ne(function(wa){Ca(wa.target.result)})}function rt(Ca){return Ne(function(wa){var Fa=wa.target,Na=Fa.error,Ma=Fa._hookCtx,Ba=Ma&&Ma.onerror;return Ba&&Ba(Na),nt(wa),Ca(Na),!1})}function nt(Ca){Ca.stopPropagation&&Ca.stopPropagation(),Ca.preventDefault&&Ca.preventDefault()}function ot(Ca){function wa(Ua){return function(Ga){var Ka=Ua(Ga),ja=Ka.value;return Ka.done?ja:ja&&"function"==typeof ja.then?ja.then(Ma,Ba):ft(ja)?ve.all(ja).then(Ma,Ba):Ma(ja)}}var Fa=function(Ua){return Ca.next(Ua)},Ma=wa(Fa),Ba=wa(function(Ua){return Ca.throw(Ua)});return wa(Fa)()}function lt(Ca,wa,Fa,Na,Ma,Ba,Ua){this.name=Ca,this.keyPath=wa,this.unique=Fa,this.multi=Na,this.auto=Ma,this.compound=Ba,this.dotted=Ua;var Ga="string"==typeof wa?wa:wa&&"["+[].join.call(wa,"+")+"]";this.src=(Fa?"&":"")+(Na?"*":"")+(Ma?"++":"")+Ga}function st(Ca,wa,Fa,Na){this.name=Ca,this.primKey=wa||new lt,this.indexes=Fa||[new lt],this.instanceTemplate=Na,this.mappedClass=null,this.idxByName=K(Fa,function(Ma){return[Ma.name,Ma]})}function dt(Ca){return 1===Ca.length?Ca[0]:Ca}function ut(Ca){var wa=Ca&&(Ca.getDatabaseNames||Ca.webkitGetDatabaseNames);return wa&&wa.bind(Ca)}var ct=Object.keys,ft=Array.isArray,gt="undefined"==typeof self?"undefined"==typeof window?S:window:self,pt=Object.getPrototypeOf,mt={}.hasOwnProperty,yt=Object.defineProperty,ht=Object.getOwnPropertyDescriptor,vt=[].slice,_t=[].concat,bt="Boolean,String,Date,RegExp,Blob,File,FileList,ArrayBuffer,DataView,Uint8ClampedArray,ImageData,Map,Set".split(",").concat(X([8,16,32,64].map(function(Ca){return["Int","Uint","Float"].map(function(wa){return wa+Ca+"Array"})}))).filter(function(Ca){return gt[Ca]}).map(function(Ca){return gt[Ca]}),Et="undefined"!=typeof Symbol&&Symbol.iterator,kt=Et?function(Ca){var wa;return null!=Ca&&(wa=Ca[Et])&&wa.apply(Ca)}:function(){return null},Tt={},Rt="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href),St=function(){return!0},At=!new Error("").stack,Dt=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Pt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Dt),It={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed"};C(ne).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+te(this._e,2))}},toString:function(){return this.name+": "+this.message}}),C(le).from(ne),C(ie).from(ne);var xt=Pt.reduce(function(Ca,wa){return Ca[wa]=wa+"Error",Ca},{}),Ct=Pt.reduce(function(Ca,wa){function Fa(Ma,Ba){this._e=ee(),this.name=Na,Ma?"string"==typeof Ma?(this.message=Ma,this.inner=Ba||null):"object"==typeof Ma&&(this.message=Ma.name+" "+Ma.message,this.inner=Ma):(this.message=It[wa]||Na,this.inner=null)}var Na=wa+"Error";return C(Fa).from(ne),Ca[wa]=Fa,Ca},{});Ct.Syntax=SyntaxError,Ct.Type=TypeError,Ct.Range=RangeError;var wt=Dt.reduce(function(Ca,wa){return Ca[wa+"Error"]=Ct[wa],Ca},{}),Ft=Pt.reduce(function(Ca,wa){return-1===["Syntax","Type","Range"].indexOf(wa)&&(Ca[wa+"Error"]=Ct[wa]),Ca},{});Ft.ModifyError=le,Ft.DexieError=ne,Ft.BulkError=ie;var Nt={},Mt=100,Ut=7,Gt=function(){try{return new Function("let F=async ()=>{},p=F();return [p,Object.getPrototypeOf(p),Promise.resolve(),F.constructor];")()}catch(wa){var Ca=gt.Promise;return Ca?[Ca.resolve(),Ca.prototype,Ca.resolve()]:[]}}(),Kt=Gt[0],jt=Gt[1],Wt=Gt[2],Vt=jt&&jt.then,Ht=Kt&&Kt.constructor,qt=Gt[3],Yt=!!Wt,zt=!1,Xt=Wt?function(){Wt.then(De)}:gt.setImmediate?A.bind(null,De):gt.MutationObserver?function(){var Ca=document.createElement("div");new MutationObserver(function(){De(),Ca=null}).observe(Ca,{attributes:!0}),Ca.setAttribute("i","1")}:function(){setTimeout(De,0)},Qt=function(Ca,wa){oa.push([Ca,wa]),Jt&&(Xt(),Jt=!1)},Zt=!0,Jt=!0,$t=[],ea=[],ta=null,aa=ue,ra={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Xe,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(function(Ca){try{Xe(Ca[0],Ca[1])}catch(wa){}})}},na=ra,oa=[],la=0,ia=[],sa={get:function(){function Ca(Na,Ma){var Ba=this,Ua=!wa.global&&(wa!==na||Fa!==pa);Ua&&Ue();var Ga=new ve(function(Ka,ja){Re(Ba,new be(Ye(Na,wa,Ua),Ye(Ma,wa,Ua),Ka,ja,wa))});return Rt&&Le(Ga,this),Ga}var wa=na,Fa=pa;return Ca.prototype=Nt,Ca},set:function(Ca){O(this,"then",Ca&&Ca.prototype===Nt?sa:{get:function(){return Ca},set:sa.set})}};I(ve.prototype,{then:sa,_then:function(Ca,wa){Re(this,new be(null,null,Ca,wa,na))},catch:function(Ca){if(1===arguments.length)return this.then(null,Ca);var wa=arguments[0],Fa=arguments[1];return"function"==typeof wa?this.then(null,function(Na){return Na instanceof wa?Fa(Na):Fe(Na)}):this.then(null,function(Na){return Na&&Na.name===wa?Fa(Na):Fe(Na)})},finally:function(Ca){return this.then(function(wa){return Ca(),wa},function(wa){return Ca(),Fe(wa)})},stack:{get:function(){if(this._stack)return this._stack;try{zt=!0;var Ca=Ae(this,[],20),wa=Ca.join("\nFrom previous: ");return null!==this._state&&(this._stack=wa),wa}finally{zt=!1}}},timeout:function(Ca,wa){var Fa=this;return Ca<Infinity?new ve(function(Na,Ma){var Ba=setTimeout(function(){return Ma(new Ct.Timeout(wa))},Ca);Fa.then(Na,Ma).finally(clearTimeout.bind(null,Ba))}):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&O(ve.prototype,Symbol.toStringTag,"Promise"),ra.env=Ve(),I(ve,{all:function(){var Ca=J.apply(null,arguments).map(Ge);return new ve(function(wa,Fa){0===Ca.length&&wa([]);var Na=Ca.length;Ca.forEach(function(Ma,Ba){return ve.resolve(Ma).then(function(Ua){Ca[Ba]=Ua,--Na||wa(Ca)},Fa)})})},resolve:function(Ca){if(Ca instanceof ve)return Ca;if(Ca&&"function"==typeof Ca.then)return new ve(function(Fa,Na){Ca.then(Fa,Na)});var wa=new ve(Nt,!0,Ca);return Le(wa,ta),wa},reject:Fe,race:function(){var Ca=J.apply(null,arguments).map(Ge);return new ve(function(wa,Fa){Ca.map(function(Na){return ve.resolve(Na).then(wa,Fa)})})},PSD:{get:function(){return na},set:function(Ca){return na=Ca}},newPSD:Me,usePSD:He,scheduler:{get:function(){return Qt},set:function(Ca){Qt=Ca}},rejectionMapper:{get:function(){return aa},set:function(Ca){aa=Ca}},follow:function(Ca,wa){return new ve(function(Fa,Na){return Me(function(Ma,Ba){var Ua=na;Ua.unhandleds=[],Ua.onunhandled=Ba,Ua.finalize=fe(function(){var Ga=this;Oe(function(){0===Ga.unhandleds.length?Ma():Ba(Ga.unhandleds[0])})},Ua.finalize),Ca()},wa,Fa,Na)})}});var da={awaits:0,echoes:0,id:0},ca=0,fa=[],ga=0,pa=0,ma=0,ya="unhandledrejection";B(function(){Qt=function(Ca,wa){setTimeout(function(){Ca.apply(null,wa)},0)}});var ha=ve.reject,va="{version}",_a=String.fromCharCode(65535),ba=function(){try{return IDBKeyRange.only([[]]),[[]]}catch(Ca){return _a}}(),Ea=-Infinity,ka="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Ta="String expected.",Ra=[],Sa="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Aa=Sa,La=Sa,Da=function(Ca){return!/(dexie\.js|dexie\.min\.js)/.test(Ca)},Pa;$(Rt,Da);var Ia=function(){},xa=!1,Oa=gt.idbModules&&gt.idbModules.shimIndexedDB?gt.idbModules:{};I(Ze,Ft),I(Ze,{delete:function(Ca){var wa=new Ze(Ca),Fa=wa.delete();return Fa.onblocked=function(Na){return wa.on("blocked",Na),this},Fa},exists:function(Ca){return new Ze(Ca).open().then(function(wa){return wa.close(),!0}).catch(Ze.NoSuchDatabaseError,function(){return!1})},getDatabaseNames:function(Ca){var wa=ut(Ze.dependencies.indexedDB);return wa?new ve(function(Fa,Na){var Ma=wa();Ma.onsuccess=function(Ba){Fa(N(Ba.target.result,0))},Ma.onerror=tt(Na)}).then(Ca):Pa.dbnames.toCollection().primaryKeys(Ca)},defineClass:function(Ca){return function(Fa){Fa?L(this,Fa):xa&&$e(this,Ca)}},applyStructure:$e,ignoreTransaction:function(Ca){return na.trans?He(na.transless,Ca):Ca()},vip:function(Ca){return Me(function(){return na.letThrough=!0,Ca()})},async:function(Ca){return function(){try{var wa=ot(Ca.apply(this,arguments));return wa&&"function"==typeof wa.then?wa:ve.resolve(wa)}catch(Fa){return ha(Fa)}}},spawn:function(Ca,wa,Fa){try{var Na=ot(Ca.apply(Fa,wa||[]));return Na&&"function"==typeof Na.then?Na:ve.resolve(Na)}catch(Ma){return ha(Ma)}},currentTransaction:{get:function(){return na.trans||null}},waitFor:function(Ca,wa){var Fa=ve.resolve("function"==typeof Ca?Ze.ignoreTransaction(Ca):Ca).timeout(wa||6e4);return na.trans?na.trans.waitFor(Fa):Fa},Promise:ve,debug:{get:function(){return Rt},set:function(Ca){$(Ca,"dexie"===Ca?function(){return!0}:Da)}},derive:C,extend:L,props:I,override:M,Events:Qe,getByKeyPath:H,setByKeyPath:q,delByKeyPath:function(Ca,wa){"string"==typeof wa?q(Ca,wa,void 0):"length"in wa&&[].map.call(wa,function(Fa){q(Ca,Fa,void 0)})},shallowClone:z,deepClone:Q,getObjectDiff:Z,asap:G,maxKey:ba,minKey:Ea,addons:[],connections:Ra,MultiModifyError:Ct.Modify,errnames:xt,IndexSpec:lt,TableSchema:st,dependencies:{indexedDB:Oa.shimIndexedDB||gt.indexedDB||gt.mozIndexedDB||gt.webkitIndexedDB||gt.msIndexedDB,IDBKeyRange:Oa.IDBKeyRange||gt.IDBKeyRange||gt.webkitIDBKeyRange},semVer:va,version:va.split(".").map(function(Ca){return parseInt(Ca)}).reduce(function(Ca,wa,Fa){return Ca+wa/Math.pow(10,2*Fa)}),fakeAutoComplete:Ia,default:Ze,Dexie:Ze}),ve.rejectionMapper=function(Ca,wa){if(!Ca||Ca instanceof ne||Ca instanceof TypeError||Ca instanceof SyntaxError||!Ca.name||!wt[Ca.name])return Ca;var Fa=new wt[Ca.name](wa||Ca.message,Ca);return"stack"in Ca&&O(Fa,"stack",{get:function(){return this.inner.stack}}),Fa},B(function(){Ze.fakeAutoComplete=Ia=B,Ze.fake=xa=!0}),Pa=new Ze("__dbnames"),Pa.version(1).stores({dbnames:"name"}),function(){var Ca="Dexie.DatabaseNames";if(typeof localStorage!==void 0&&gt.document!==void 0)try{JSON.parse(localStorage.getItem(Ca)||"[]").forEach(function(wa){return Pa.dbnames.put({name:wa}).catch(de)}),localStorage.removeItem(Ca)}catch(wa){}}(),E.a=Ze}).call(E,R(352),R(394).setImmediate)},386:function(y){var S,S;(function(A){y.exports=A()})(function(){var A;return function I(O,C,F){function N(U,G){if(!C[U]){if(!O[U]){if(!G&&"function"==typeof S&&S)return S(U,!0);if(M)return M(U,!0);var W=new Error("Cannot find module '"+U+"'");throw W.code="MODULE_NOT_FOUND",W}var V=C[U]={exports:{}};O[U][0].call(V.exports,function(H){var q=O[U][1][H];return N(q?q:H)},V,V.exports,I,O,C,F)}return C[U].exports}for(var M="function"==typeof S&&S,B=0;B<F.length;B++)N(F[B]);return N}({1:[function(I,O){function F(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function N(G){return"function"==typeof G}function M(G){return"number"==typeof G}function B(G){return"object"==typeof G&&null!==G}function U(G){return void 0===G}O.exports=F,F.EventEmitter=F,F.prototype._events=void 0,F.prototype._maxListeners=void 0,F.defaultMaxListeners=10,F.prototype.setMaxListeners=function(G){if(!M(G)||0>G||isNaN(G))throw TypeError("n must be a positive number");return this._maxListeners=G,this},F.prototype.emit=function(G){var K,W,V,H,q,Y;if(this._events||(this._events={}),"error"===G&&(!this._events.error||B(this._events.error)&&!this._events.error.length))if(K=arguments[1],K instanceof Error)throw K;else{var z=new Error("Uncaught, unspecified \"error\" event. ("+K+")");throw z.context=K,z}if(W=this._events[G],U(W))return!1;if(N(W))switch(arguments.length){case 1:W.call(this);break;case 2:W.call(this,arguments[1]);break;case 3:W.call(this,arguments[1],arguments[2]);break;default:H=Array.prototype.slice.call(arguments,1),W.apply(this,H);}else if(B(W))for(H=Array.prototype.slice.call(arguments,1),Y=W.slice(),V=Y.length,q=0;q<V;q++)Y[q].apply(this,H);return!0},F.prototype.addListener=function(G,K){var W;if(!N(K))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",G,N(K.listener)?K.listener:K),this._events[G]?B(this._events[G])?this._events[G].push(K):this._events[G]=[this._events[G],K]:this._events[G]=K,B(this._events[G])&&!this._events[G].warned&&(W=U(this._maxListeners)?F.defaultMaxListeners:this._maxListeners,W&&0<W&&this._events[G].length>W&&(this._events[G].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[G].length),"function"==typeof console.trace&&console.trace())),this},F.prototype.on=F.prototype.addListener,F.prototype.once=function(G,K){function W(){this.removeListener(G,W),V||(V=!0,K.apply(this,arguments))}if(!N(K))throw TypeError("listener must be a function");var V=!1;return W.listener=K,this.on(G,W),this},F.prototype.removeListener=function(G,K){var W,V,H,q;if(!N(K))throw TypeError("listener must be a function");if(!this._events||!this._events[G])return this;if(W=this._events[G],H=W.length,V=-1,W===K||N(W.listener)&&W.listener===K)delete this._events[G],this._events.removeListener&&this.emit("removeListener",G,K);else if(B(W)){for(q=H;0<q--;)if(W[q]===K||W[q].listener&&W[q].listener===K){V=q;break}if(0>V)return this;1===W.length?(W.length=0,delete this._events[G]):W.splice(V,1),this._events.removeListener&&this.emit("removeListener",G,K)}return this},F.prototype.removeAllListeners=function(G){var K,W;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[G]&&delete this._events[G],this;if(0===arguments.length){for(K in this._events)"removeListener"!==K&&this.removeAllListeners(K);return this.removeAllListeners("removeListener"),this._events={},this}if(W=this._events[G],N(W))this.removeListener(G,W);else if(W)for(;W.length;)this.removeListener(G,W[W.length-1]);return delete this._events[G],this},F.prototype.listeners=function(G){var K;return K=this._events&&this._events[G]?N(this._events[G])?[this._events[G]]:this._events[G].slice():[],K},F.prototype.listenerCount=function(G){if(this._events){var K=this._events[G];if(N(K))return 1;if(K)return K.length}return 0},F.listenerCount=function(G,K){return G.listenerCount(K)}},{}],2:[function(I,O,C){(function(F){var N=/^((?:[^\/;?#]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,M=/^([^\/;?#]*)(.*)$/,B=/(?:\/|^)\.(?=\/)/g,U=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,G={buildAbsoluteURL:function(K,W,V){if(V=V||{},K=K.trim(),W=W.trim(),!W){if(!V.alwaysNormalize)return K;var H=this.parseURL(K);if(!Y)throw new Error("Error trying to parse base URL.");return H.path=G.normalizePath(H.path),G.buildURLFromParts(H)}var q=this.parseURL(W);if(!q)throw new Error("Error trying to parse relative URL.");if(q.scheme)return V.alwaysNormalize?(q.path=G.normalizePath(q.path),G.buildURLFromParts(q)):W;var Y=this.parseURL(K);if(!Y)throw new Error("Error trying to parse base URL.");if(!Y.netLoc&&Y.path&&"/"!==Y.path[0]){var z=M.exec(Y.path);Y.netLoc=z[1],Y.path=z[2]}Y.netLoc&&!Y.path&&(Y.path="/");var X={scheme:Y.scheme,netLoc:q.netLoc,path:null,params:q.params,query:q.query,fragment:q.fragment};if(!q.netLoc&&(X.netLoc=Y.netLoc,"/"!==q.path[0]))if(!q.path)X.path=Y.path,q.params||(X.params=Y.params,!q.query&&(X.query=Y.query));else{var Q=Y.path,Z=Q.substring(0,Q.lastIndexOf("/")+1)+q.path;X.path=G.normalizePath(Z)}return null===X.path&&(X.path=V.alwaysNormalize?G.normalizePath(q.path):q.path),G.buildURLFromParts(X)},parseURL:function(K){var W=N.exec(K);return W?{scheme:W[1]||"",netLoc:W[2]||"",path:W[3]||"",params:W[4]||"",query:W[5]||"",fragment:W[6]||""}:null},normalizePath:function(K){for(K=K.split("").reverse().join("").replace(B,"");K.length!==(K=K.replace(U,"")).length;);return K.split("").reverse().join("")},buildURLFromParts:function(K){return K.scheme+K.netLoc+K.path+K.params+K.query+K.fragment}};"object"==typeof C&&"object"==typeof O?O.exports=G:"function"==typeof A&&A.amd?A([],function(){return G}):"object"==typeof C?C.URLToolkit=G:F.URLToolkit=G})(this)},{}],3:[function(I,O){var F=arguments[3],N=arguments[4],M=arguments[5],B=JSON.stringify;O.exports=function(U,G){function K(oe){for(var le in J[oe]=!0,N[oe][1]){var ie=N[oe][1][le];J[ie]||K(ie)}}for(var V=Object.keys(M),H=0,q=V.length,W;H<q;H++){var Y=V[H],z=M[Y].exports;if(z===U||z&&z.default===U){W=Y;break}}if(!W){W=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var X={},H=0,q=V.length,Y;H<q;H++)Y=V[H],X[Y]=Y;N[W]=[Function(["require","module","exports"],"("+U+")(self)"),X]}var Q=Math.floor(Math.pow(16,8)*Math.random()).toString(16),Z={};Z[W]=W,N[Q]=[Function(["require"],"var f = require("+B(W)+");(f.default ? f.default : f)(self);"),Z];var J={};K(Q);var $="("+F+")({"+Object.keys(J).map(function(oe){return B(oe)+":["+N[oe][0]+","+B(N[oe][1])+"]"}).join(",")+"},{},["+B(Q)+"])",ee=window.URL||window.webkitURL||window.mozURL||window.msURL,te=new Blob([$],{type:"text/javascript"});if(G&&G.bare)return te;var ae=ee.createObjectURL(te),ne=new Worker(ae);return ne.objectURL=ae,ne}},{}],4:[function(I,O,C){"use strict";function F(ie){return ie&&ie.__esModule?ie:{default:ie}}Object.defineProperty(C,"__esModule",{value:!0}),C.hlsDefaultConfig=void 0;var N=I(5),M=F(N),B=I(8),U=F(B),G=I(9),K=F(G),W=I(10),V=F(W),H=I(55),q=F(H),Y=I(7),z=F(Y),X=I(6),Q=F(X),Z=I(47),J=F(Z),$=I(15),ee=F($),te=I(14),ae=F(te),ne=I(13),oe=F(ne),le=C.hlsDefaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:60000000,maxBufferHole:0.5,maxSeekHole:2,lowBufferWatchdogPeriod:0.5,highBufferWatchdogPeriod:3,nudgeOffset:0.1,nudgeMaxRetry:3,maxFragLookUpTolerance:0.2,liveSyncDurationCount:3,liveMaxLatencyDurationCount:Infinity,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64000,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64000,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64000,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:0.2,appendErrorMaxRetry:3,loader:q.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:M.default,bufferController:U.default,capLevelController:K.default,fpsController:V.default,audioStreamController:Q.default,audioTrackController:z.default,subtitleStreamController:oe.default,subtitleTrackController:ae.default,timelineController:ee.default,cueHandler:J.default,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",stretchShortVideoTrack:!1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:0.95,abrBandWidthUpFactor:0.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0}},{5:5,6:6,7:7,8:8,9:9,10:10,13:13,14:14,15:15,47:47,55:55}],5:[function(I,O,C){"use strict";function F(J){return J&&J.__esModule?J:{default:J}}function N(J,$){if(!(J instanceof $))throw new TypeError("Cannot call a class as a function")}function M(J,$){if(!J)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return $&&("object"==typeof $||"function"==typeof $)?$:J}function B(J,$){if("function"!=typeof $&&null!==$)throw new TypeError("Super expression must either be null or a function, not "+typeof $);J.prototype=Object.create($&&$.prototype,{constructor:{value:J,enumerable:!1,writable:!0,configurable:!0}}),$&&(Object.setPrototypeOf?Object.setPrototypeOf(J,$):J.__proto__=$)}Object.defineProperty(C,"__esModule",{value:!0});var U=function(){function J($,ee){for(var te=0,ae;te<ee.length;te++)ae=ee[te],ae.enumerable=ae.enumerable||!1,ae.configurable=!0,"value"in ae&&(ae.writable=!0),Object.defineProperty($,ae.key,ae)}return function($,ee,te){return ee&&J($.prototype,ee),te&&J($,te),$}}(),G=I(32),K=F(G),W=I(31),V=F(W),H=I(34),q=F(H),Y=I(30),z=I(50),X=I(48),Q=F(X),Z=function(J){function $(ee){N(this,$);var te=M(this,($.__proto__||Object.getPrototypeOf($)).call(this,ee,K.default.FRAG_LOADING,K.default.FRAG_LOADED,K.default.FRAG_BUFFERED,K.default.ERROR));return te.lastLoadedFragLevel=0,te._nextAutoLevel=-1,te.hls=ee,te.onCheck=te._abandonRulesCheck.bind(te),te}return B($,J),U($,[{key:"destroy",value:function(){this.clearTimer(),V.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(te){var ae=te.frag;if("main"===ae.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this._bwEstimator){var ne=this.hls,oe=te.frag.level,le=ne.levels[oe].details.live,ie=ne.config,se,de;le?(se=ie.abrEwmaFastLive,de=ie.abrEwmaSlowLive):(se=ie.abrEwmaFastVoD,de=ie.abrEwmaSlowVoD),this._bwEstimator=new Q.default(ne,de,se,ie.abrEwmaDefaultEstimate)}this.fragCurrent=ae}}},{key:"_abandonRulesCheck",value:function(){var te=this.hls,ae=te.media,ne=this.fragCurrent,oe=ne.loader,le=te.minAutoLevel;if(!oe||oe.stats&&oe.stats.aborted)return z.logger.warn("frag loader destroy or aborted, disarm abandonRules"),void this.clearTimer();var ie=oe.stats;if(ae&&(!ae.paused&&0!==ae.playbackRate||!ae.readyState)&&ne.autoLevel&&ne.level){var se=performance.now()-ie.trequest,de=Math.abs(ae.playbackRate);if(se>500*ne.duration/de){var ue=te.levels,ce=Math.max(1,ie.bw?ie.bw/8:1e3*ie.loaded/se),fe=ue[ne.level],ge=fe.realBitrate?Math.max(fe.realBitrate,fe.bitrate):fe.bitrate,pe=ie.total?ie.total:Math.max(ie.loaded,Math.round(ne.duration*ge/8)),me=ae.currentTime,ye=(pe-ie.loaded)/ce,he=(q.default.bufferInfo(ae,me,te.config.maxBufferHole).end-me)/de;if(he<2*ne.duration/de&&ye>he){var be=void 0,ve;for(be=ne.level-1;be>le;be--){var Ee=ue[be].realBitrate?Math.max(ue[be].realBitrate,ue[be].bitrate):ue[be].bitrate;if(ve=ne.duration*Ee/(8*0.8*ce),ve<he)break}ve<ye&&(z.logger.warn("loading too slow, abort fragment loading and switch to level "+be+":fragLoadedDelay["+be+"]<fragLoadedDelay["+(ne.level-1)+"];bufferStarvationDelay:"+ve.toFixed(1)+"<"+ye.toFixed(1)+":"+he.toFixed(1)),te.nextLoadLevel=be,this._bwEstimator.sample(se,ie.loaded),oe.abort(),this.clearTimer(),te.trigger(K.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:ne,stats:ie}))}}}}},{key:"onFragLoaded",value:function(te){var ae=te.frag;if("main"===ae.type&&!isNaN(ae.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=ae.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var ne=this.hls.levels[ae.level],oe=(ne.loaded?ne.loaded.bytes:0)+te.stats.loaded,le=(ne.loaded?ne.loaded.duration:0)+te.frag.duration;ne.loaded={bytes:oe,duration:le},ne.realBitrate=Math.round(8*oe/le)}if(te.frag.bitrateTest){var ie=te.stats;ie.tparsed=ie.tbuffered=ie.tload,this.onFragBuffered(te)}}}},{key:"onFragBuffered",value:function(te){var ae=te.stats,ne=te.frag;if(!0!==ae.aborted&&1===ne.loadCounter&&"main"===ne.type&&!isNaN(ne.sn)&&(!ne.bitrateTest||ae.tload===ae.tbuffered)){var oe=ae.tparsed-ae.trequest;z.logger.log("latency/loading/parsing/append/kbps:"+Math.round(ae.tfirst-ae.trequest)+"/"+Math.round(ae.tload-ae.tfirst)+"/"+Math.round(ae.tparsed-ae.tload)+"/"+Math.round(ae.tbuffered-ae.tparsed)+"/"+Math.round(8*ae.loaded/(ae.tbuffered-ae.trequest))),this._bwEstimator.sample(oe,ae.loaded),this.bitrateTestDelay=ne.bitrateTest?oe/1e3:0}}},{key:"onError",value:function(te){switch(te.details){case Y.ErrorDetails.FRAG_LOAD_ERROR:case Y.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break;default:}}},{key:"clearTimer",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"_findBestLevel",value:function(te,ae,ne,oe,le,ie,se,de,ue){for(var ce=le;ce>=oe;ce--){var fe=ue[ce],ge=fe.details,pe=ge?ge.totalduration/ge.fragments.length:ae,me=!!ge&&ge.live,ye=void 0;ye=ce<=te?se*ne:de*ne;var he=ue[ce].realBitrate?Math.max(ue[ce].realBitrate,ue[ce].bitrate):ue[ce].bitrate,ve=he*pe/ye;if(z.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+ce+"/"+Math.round(ye)+"/"+he+"/"+pe+"/"+ie+"/"+ve),ye>he&&(!ve||me||ve<ie))return ce}return-1}},{key:"nextAutoLevel",get:function(){var te=this._nextAutoLevel,ae=this._bwEstimator;if(-1!==te&&(!ae||!ae.canEstimate()))return te;var ne=this._nextABRAutoLevel;return-1!==te&&(ne=Math.min(te,ne)),ne},set:function(te){this._nextAutoLevel=te}},{key:"_nextABRAutoLevel",get:function(){var te=this.hls,ae=te.maxAutoLevel,ne=te.levels,oe=te.config,le=te.minAutoLevel,ie=te.media,se=this.lastLoadedFragLevel,de=this.fragCurrent?this.fragCurrent.duration:0,ue=ie?ie.currentTime:0,ce=ie&&0!==ie.playbackRate?Math.abs(ie.playbackRate):1,fe=this._bwEstimator?this._bwEstimator.getEstimate():oe.abrEwmaDefaultEstimate,ge=(q.default.bufferInfo(ie,ue,oe.maxBufferHole).end-ue)/ce,pe=this._findBestLevel(se,de,fe,le,ae,ge,oe.abrBandWidthFactor,oe.abrBandWidthUpFactor,ne);if(0<=pe)return pe;z.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var me=de?Math.min(de,oe.maxStarvationDelay):oe.maxStarvationDelay,ye=oe.abrBandWidthFactor,he=oe.abrBandWidthUpFactor;if(0==ge){var ve=this.bitrateTestDelay;if(ve){var be=de?Math.min(de,oe.maxLoadingDelay):oe.maxLoadingDelay;me=be-ve,z.logger.trace("bitrate test took "+Math.round(1e3*ve)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*me)+" ms"),ye=he=1}}return pe=this._findBestLevel(se,de,fe,le,ae,ge+me,ye,he,ne),Math.max(pe,0)}}]),$}(V.default);C.default=Z},{30:30,31:31,32:32,34:34,48:48,50:50}],6:[function(I,O,C){"use strict";function F(ie){return ie&&ie.__esModule?ie:{default:ie}}function N(ie,se){if(!(ie instanceof se))throw new TypeError("Cannot call a class as a function")}function M(ie,se){if(!ie)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return se&&("object"==typeof se||"function"==typeof se)?se:ie}function B(ie,se){if("function"!=typeof se&&null!==se)throw new TypeError("Super expression must either be null or a function, not "+typeof se);ie.prototype=Object.create(se&&se.prototype,{constructor:{value:ie,enumerable:!1,writable:!0,configurable:!0}}),se&&(Object.setPrototypeOf?Object.setPrototypeOf(ie,se):ie.__proto__=se)}Object.defineProperty(C,"__esModule",{value:!0});var U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(ie){return typeof ie}:function(ie){return ie&&"function"==typeof Symbol&&ie.constructor===Symbol&&ie!==Symbol.prototype?"symbol":typeof ie},G=function(){function ie(se,de){for(var ue=0,ce;ue<de.length;ue++)ce=de[ue],ce.enumerable=ce.enumerable||!1,ce.configurable=!0,"value"in ce&&(ce.writable=!0),Object.defineProperty(se,ce.key,ce)}return function(se,de,ue){return de&&ie(se.prototype,de),ue&&ie(se,ue),se}}(),K=I(45),W=F(K),V=I(34),H=F(V),q=I(24),Y=F(q),z=I(32),X=F(z),Q=I(31),Z=F(Q),J=I(35),$=F(J),ee=I(51),te=F(ee),ae=I(30),ne=I(50),oe={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},le=function(ie){function se(de){N(this,se);var ue=M(this,(se.__proto__||Object.getPrototypeOf(se)).call(this,de,X.default.MEDIA_ATTACHED,X.default.MEDIA_DETACHING,X.default.AUDIO_TRACKS_UPDATED,X.default.AUDIO_TRACK_SWITCHING,X.default.AUDIO_TRACK_LOADED,X.default.KEY_LOADED,X.default.FRAG_LOADED,X.default.FRAG_PARSING_INIT_SEGMENT,X.default.FRAG_PARSING_DATA,X.default.FRAG_PARSED,X.default.ERROR,X.default.BUFFER_CREATED,X.default.BUFFER_APPENDED,X.default.BUFFER_FLUSHED,X.default.INIT_PTS_FOUND));return ue.config=de.config,ue.audioCodecSwap=!1,ue.ticks=0,ue._state=oe.STOPPED,ue.ontick=ue.tick.bind(ue),ue.initPTS=[],ue.waitingFragment=null,ue}return B(se,ie),G(se,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),Z.default.prototype.destroy.call(this),this.state=oe.STOPPED}},{key:"onInitPtsFound",value:function(ue){var ce=ue.id,fe=ue.frag.cc,ge=ue.initPTS;"main"===ce&&(this.initPTS[fe]=ge,ne.logger.log("InitPTS for cc:"+fe+" found from video track:"+ge),this.state===oe.WAITING_INIT_PTS&&(ne.logger.log("sending pending audio frag to demuxer"),this.state=oe.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null))}},{key:"startLoad",value:function(ue){if(this.tracks){var ce=this.lastCurrentTime;this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.fragLoadError=0,0<ce&&-1===ue?(ne.logger.log("audio:override startPosition with lastCurrentTime @"+ce.toFixed(3)),this.state=oe.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:ue,this.state=oe.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=ue,this.state=oe.STOPPED}},{key:"stopLoad",value:function(){var ue=this.fragCurrent;ue&&(ue.loader&&ue.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=oe.STOPPED}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),1<this.ticks&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){var ue=this,pe=this.hls,me=pe.config,be=function(){switch(ue.state){case oe.ERROR:case oe.PAUSED:case oe.BUFFER_FLUSHING:break;case oe.STARTING:ue.state=oe.WAITING_TRACK,ue.loadedmetadata=!1;break;case oe.IDLE:var Ee=ue.tracks;if(!Ee)break;if(!ue.media&&(ue.startFragRequested||!me.startFragPrefetch))break;ce=ue.loadedmetadata?ue.media.currentTime:ue.nextLoadPosition;var ke=ue.mediaBuffer?ue.mediaBuffer:ue.media,Te=H.default.bufferInfo(ke,ce,me.maxBufferHole),Re=Te.len,Se=Te.end,Ae=ue.fragPrevious,Le=me.maxMaxBufferLength,De=ue.audioSwitch,Pe=ue.trackId;if(Re<Le&&Pe<Ee.length){if(ge=Ee[Pe].details,"undefined"==typeof ge){ue.state=oe.WAITING_TRACK;break}if(!De&&!ge.live&&Ae&&Ae.sn===ge.endSN&&(!ue.media.seeking||ue.media.duration-Se<Ae.duration/2)){ue.hls.trigger(X.default.BUFFER_EOS,{type:"audio"}),ue.state=oe.ENDED;break}var Ie=ge.fragments,xe=Ie.length,Oe=Ie[0].start,Ce=Ie[xe-1].start+Ie[xe-1].duration,we;if(De)if(ge.live&&!ge.PTSKnown)ne.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),Se=0;else if(Se=ce,ge.PTSKnown&&ce<Oe)if(Te.end>Oe||Te.nextStart)ne.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),ue.media.currentTime=Oe+0.05;else return{v:void 0};if(ge.initSegment&&!ge.initSegment.data)we=ge.initSegment;else if(!(Se<=Oe))(function(){var Be=me.maxFragLookUpTolerance,Ue=Ae?Ie[Ae.sn-Ie[0].sn+1]:void 0,Ge=function(je){var We=Math.min(Be,je.duration);return je.start+je.duration-We<=Se?1:je.start-We>Se&&je.start?-1:0},Me;Se<Ce?(Se>Ce-Be&&(Be=0),Me=Ue&&!Ge(Ue)?Ue:W.default.search(Ie,Ge)):Me=Ie[xe-1],Me&&(we=Me,Oe=Me.start,Ae&&we.level===Ae.level&&we.sn===Ae.sn&&(we.sn<ge.endSN?(we=Ie[we.sn+1-ge.startSN],ne.logger.log("SN just loaded, load next one: "+we.sn)):we=null))})();else if(we=Ie[0],ge.live&&we.loadIdx&&we.loadIdx===ue.fragLoadIdx){var Fe=Te.nextStart?Te.nextStart:Oe;return ne.logger.log("no alt audio available @currentTime:"+ue.media.currentTime+", seeking @"+(Fe+0.05)),ue.media.currentTime=Fe+0.05,{v:void 0}}if(we)if(we.decryptdata&&null!=we.decryptdata.uri&&null==we.decryptdata.key)ne.logger.log("Loading key for "+we.sn+" of ["+ge.startSN+" ,"+ge.endSN+"],track "+Pe),ue.state=oe.KEY_LOADING,pe.trigger(X.default.KEY_LOADING,{frag:we});else{if(ne.logger.log("Loading "+we.sn+" of ["+ge.startSN+" ,"+ge.endSN+"],track "+Pe+", currentTime:"+ce+",bufferEnd:"+Se.toFixed(3)),void 0===ue.fragLoadIdx?ue.fragLoadIdx=0:ue.fragLoadIdx++,we.loadCounter){we.loadCounter++;var Ne=me.fragLoadingLoopThreshold;if(we.loadCounter>Ne&&Math.abs(ue.fragLoadIdx-we.loadIdx)<Ne)return pe.trigger(X.default.ERROR,{type:ae.ErrorTypes.MEDIA_ERROR,details:ae.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:we}),{v:void 0}}else we.loadCounter=1;we.loadIdx=ue.fragLoadIdx,ue.fragCurrent=we,ue.startFragRequested=!0,isNaN(we.sn)||(ue.nextLoadPosition=we.start+we.duration),pe.trigger(X.default.FRAG_LOADING,{frag:we}),ue.state=oe.FRAG_LOADING}}break;case oe.WAITING_TRACK:fe=ue.tracks[ue.trackId],fe&&fe.details&&(ue.state=oe.IDLE);break;case oe.FRAG_LOADING_WAITING_RETRY:ye=performance.now(),he=ue.retryDate,ke=ue.media,ve=ke&&ke.seeking,(!he||ye>=he||ve)&&(ne.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),ue.state=oe.IDLE);break;case oe.WAITING_INIT_PTS:case oe.STOPPED:case oe.FRAG_LOADING:case oe.PARSING:case oe.PARSED:case oe.ENDED:break;default:}}(),ce,fe,ge,ye,he,ve;if("object"===("undefined"==typeof be?"undefined":U(be)))return be.v}},{key:"onMediaAttached",value:function(ue){var ce=this.media=this.mediaBuffer=ue.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),ce.addEventListener("seeking",this.onvseeking),ce.addEventListener("ended",this.onvended);var fe=this.config;this.tracks&&fe.autoStartLoad&&this.startLoad(fe.startPosition)}},{key:"onMediaDetaching",value:function(){var ue=this.media;ue&&ue.ended&&(ne.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var ce=this.tracks;ce&&ce.forEach(function(fe){fe.details&&fe.details.fragments.forEach(function(ge){ge.loadCounter=void 0})}),ue&&(ue.removeEventListener("seeking",this.onvseeking),ue.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){this.state===oe.ENDED&&(this.state=oe.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()}},{key:"onMediaEnded",value:function(){this.startPosition=this.lastCurrentTime=0}},{key:"onAudioTracksUpdated",value:function(ue){ne.logger.log("audio tracks updated"),this.tracks=ue.audioTracks}},{key:"onAudioTrackSwitching",value:function(ue){var ce=!!ue.url;this.trackId=ue.id,this.state=oe.IDLE,this.fragCurrent=null,this.state=oe.PAUSED,this.waitingFragment=null,ce?!this.timer&&(this.timer=setInterval(this.ontick,100)):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),ce&&(this.audioSwitch=!0,this.state=oe.IDLE,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold)),this.tick()}},{key:"onAudioTrackLoaded",value:function(ue){var ce=ue.details,fe=ue.id,ge=this.tracks[fe],pe=ce.totalduration,me=0;if(ne.logger.log("track "+fe+" loaded ["+ce.startSN+","+ce.endSN+"],duration:"+pe),ce.live){var ye=ge.details;ye&&0<ce.fragments.length?($.default.mergeDetails(ye,ce),me=ce.fragments[0].start,ce.PTSKnown?ne.logger.log("live audio playlist sliding:"+me.toFixed(3)):ne.logger.log("live audio playlist - outdated PTS, unknown sliding")):(ce.PTSKnown=!1,ne.logger.log("live audio playlist - first load, unknown sliding"))}else ce.PTSKnown=!1;if(ge.details=ce,!this.startFragRequested){if(-1===this.startPosition){var he=ce.startTimeOffset;isNaN(he)?this.startPosition=0:(ne.logger.log("start time offset found in playlist, adjust startPosition to "+he),this.startPosition=he)}this.nextLoadPosition=this.startPosition}this.state===oe.WAITING_TRACK&&(this.state=oe.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===oe.KEY_LOADING&&(this.state=oe.IDLE,this.tick())}},{key:"onFragLoaded",value:function(ue){var ce=this.fragCurrent,fe=ue.frag;if(this.state===oe.FRAG_LOADING&&ce&&"audio"===fe.type&&fe.level===ce.level&&fe.sn===ce.sn){var ge=this.tracks[this.trackId],pe=ge.details,me=pe.totalduration,ye=ce.level,he=ce.sn,ve=ce.cc,be=this.config.defaultAudioCodec||ge.audioCodec||"mp4a.40.2",Ee=this.stats=ue.stats;if("initSegment"===he)this.state=oe.IDLE,Ee.tparsed=Ee.tbuffered=performance.now(),pe.initSegment.data=ue.payload,this.hls.trigger(X.default.FRAG_BUFFERED,{stats:Ee,frag:ce,id:"audio"}),this.tick();else{this.state=oe.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new Y.default(this.hls,"audio"));var ke=this.initPTS[ve],Te=pe.initSegment?pe.initSegment.data:[];if(Te||void 0!==ke){this.pendingBuffering=!0,ne.logger.log("Demuxing "+he+" of ["+pe.startSN+" ,"+pe.endSN+"],track "+ye);this.demuxer.push(ue.payload,Te,be,null,ce,me,!1,ke)}else ne.logger.log("unknown video PTS for continuity counter "+ve+", waiting for video PTS before demuxing audio frag "+he+" of ["+pe.startSN+" ,"+pe.endSN+"],track "+ye),this.waitingFragment=ue,this.state=oe.WAITING_INIT_PTS}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(ue){var ce=this.fragCurrent,fe=ue.frag;if(ce&&"audio"===ue.id&&fe.sn===ce.sn&&fe.level===ce.level&&this.state===oe.PARSING){var ge=ue.tracks,pe;if(ge.video&&delete ge.video,pe=ge.audio,pe){pe.levelCodec="mp4a.40.2",pe.id=ue.id,this.hls.trigger(X.default.BUFFER_CODECS,ge),ne.logger.log("audio track:audio,container:"+pe.container+",codecs[level/parsed]=["+pe.levelCodec+"/"+pe.codec+"]");var me=pe.initSegment;if(me){var ye={type:"audio",data:me,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[ye]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(X.default.BUFFER_APPENDING,ye))}this.tick()}}}},{key:"onFragParsingData",value:function(ue){var ce=this,fe=this.fragCurrent,ge=ue.frag;fe&&"audio"===ue.id&&"audio"===ue.type&&ge.sn===fe.sn&&ge.level===fe.level&&this.state===oe.PARSING&&function(){var pe=ce.trackId,me=ce.tracks[pe],ye=ce.hls;isNaN(ue.endPTS)&&(ue.endPTS=ue.startPTS+fe.duration,ue.endDTS=ue.startDTS+fe.duration),ne.logger.log("parsed "+ue.type+",PTS:["+ue.startPTS.toFixed(3)+","+ue.endPTS.toFixed(3)+"],DTS:["+ue.startDTS.toFixed(3)+"/"+ue.endDTS.toFixed(3)+"],nb:"+ue.nb),$.default.updateFragPTSDTS(me.details,fe.sn,ue.startPTS,ue.endPTS);var he=ce.audioSwitch,ve=ce.media,be=!1;if(he&&ve)if(ve.readyState){var Ee=ve.currentTime;ne.logger.log("switching audio track : currentTime:"+Ee),Ee>=ue.startPTS&&(ne.logger.log("switching audio track : flushing all audio"),ce.state=oe.BUFFER_FLUSHING,ye.trigger(X.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),be=!0,ce.audioSwitch=!1,ye.trigger(X.default.AUDIO_TRACK_SWITCHED,{id:pe}))}else ce.audioSwitch=!1,ye.trigger(X.default.AUDIO_TRACK_SWITCHED,{id:pe});var ke=ce.pendingData;ce.audioSwitch||([ue.data1,ue.data2].forEach(function(Te){Te&&Te.length&&ke.push({type:ue.type,data:Te,parent:"audio",content:"data"})}),!be&&ke.length&&(ke.forEach(function(Te){ce.state===oe.PARSING&&(ce.pendingBuffering=!0,ce.hls.trigger(X.default.BUFFER_APPENDING,Te))}),ce.pendingData=[],ce.appended=!0)),ce.tick()}()}},{key:"onFragParsed",value:function(ue){var ce=this.fragCurrent,fe=ue.frag;ce&&"audio"===ue.id&&fe.sn===ce.sn&&fe.level===ce.level&&this.state===oe.PARSING&&(this.stats.tparsed=performance.now(),this.state=oe.PARSED,this._checkAppendedParsed())}},{key:"onBufferCreated",value:function(ue){var ce=ue.tracks.audio;ce&&(this.mediaBuffer=ce.buffer,this.loadedmetadata=!0)}},{key:"onBufferAppended",value:function(ue){if("audio"===ue.parent){var ce=this.state;(ce===oe.PARSING||ce===oe.PARSED)&&(this.pendingBuffering=0<ue.pending,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){if(this.state===oe.PARSED&&(!this.appended||!this.pendingBuffering)){var ue=this.fragCurrent,ce=this.stats,fe=this.hls;if(ue){this.fragPrevious=ue,ce.tbuffered=performance.now(),fe.trigger(X.default.FRAG_BUFFERED,{stats:ce,frag:ue,id:"audio"});var ge=this.mediaBuffer?this.mediaBuffer:this.media;ne.logger.log("audio buffered : "+te.default.toString(ge.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,fe.trigger(X.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=oe.IDLE}this.tick()}}},{key:"onError",value:function(ue){var ce=ue.frag;if(!(ce&&"audio"!==ce.type))switch(ue.details){case ae.ErrorDetails.FRAG_LOAD_ERROR:case ae.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!ue.fatal){var fe=this.fragLoadError;fe?fe++:fe=1;var ge=this.config;if(fe<=ge.fragLoadingMaxRetry){this.fragLoadError=fe,ce.loadCounter=0;var pe=Math.min(Math.pow(2,fe-1)*ge.fragLoadingRetryDelay,ge.fragLoadingMaxRetryTimeout);ne.logger.warn("audioStreamController: frag loading failed, retry in "+pe+" ms"),this.retryDate=performance.now()+pe,this.state=oe.FRAG_LOADING_WAITING_RETRY}else ne.logger.error("audioStreamController: "+ue.details+" reaches max retry, redispatch as fatal ..."),ue.fatal=!0,this.state=oe.ERROR}break;case ae.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case ae.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case ae.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case ae.ErrorDetails.KEY_LOAD_ERROR:case ae.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==oe.ERROR&&(this.state=ue.fatal?oe.ERROR:oe.IDLE,ne.logger.warn("audioStreamController: "+ue.details+" while loading frag,switch to "+this.state+" state ..."));break;case ae.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===ue.parent&&(this.state===oe.PARSING||this.state===oe.PARSED)){var me=this.mediaBuffer,ye=this.media.currentTime,he=me&&H.default.isBuffered(me,ye)&&H.default.isBuffered(me,ye+0.5);if(he){var ve=this.config;ve.maxMaxBufferLength>=ve.maxBufferLength&&(ve.maxMaxBufferLength/=2,ne.logger.warn("audio:reduce max buffer length to "+ve.maxMaxBufferLength+"s"),this.fragLoadIdx+=2*ve.fragLoadingLoopThreshold),this.state=oe.IDLE}else ne.logger.warn("buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=oe.BUFFER_FLUSHING,this.hls.trigger(X.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}break;default:}}},{key:"onBufferFlushed",value:function(){var ue=this,ce=this.pendingData;ce&&ce.length?(ne.logger.log("appending pending audio data on Buffer Flushed"),ce.forEach(function(fe){ue.hls.trigger(X.default.BUFFER_APPENDING,fe)}),this.appended=!0,this.pendingData=[],this.state=oe.PARSED):(this.state=oe.IDLE,this.fragPrevious=null,this.tick())}},{key:"state",set:function(ue){if(this.state!==ue){var ce=this.state;this._state=ue,ne.logger.log("audio stream:"+ce+"->"+ue)}},get:function(){return this._state}}]),se}(Z.default);C.default=le},{24:24,30:30,31:31,32:32,34:34,35:35,45:45,50:50,51:51}],7:[function(I,O,C){"use strict";function F(Y){return Y&&Y.__esModule?Y:{default:Y}}function N(Y,z){if(!(Y instanceof z))throw new TypeError("Cannot call a class as a function")}function M(Y,z){if(!Y)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return z&&("object"==typeof z||"function"==typeof z)?z:Y}function B(Y,z){if("function"!=typeof z&&null!==z)throw new TypeError("Super expression must either be null or a function, not "+typeof z);Y.prototype=Object.create(z&&z.prototype,{constructor:{value:Y,enumerable:!1,writable:!0,configurable:!0}}),z&&(Object.setPrototypeOf?Object.setPrototypeOf(Y,z):Y.__proto__=z)}Object.defineProperty(C,"__esModule",{value:!0});var U=function(){function Y(z,X){for(var Q=0,Z;Q<X.length;Q++)Z=X[Q],Z.enumerable=Z.enumerable||!1,Z.configurable=!0,"value"in Z&&(Z.writable=!0),Object.defineProperty(z,Z.key,Z)}return function(z,X,Q){return X&&Y(z.prototype,X),Q&&Y(z,Q),z}}(),G=I(32),K=F(G),W=I(31),V=F(W),H=I(50),q=function(Y){function z(X){N(this,z);var Q=M(this,(z.__proto__||Object.getPrototypeOf(z)).call(this,X,K.default.MANIFEST_LOADING,K.default.MANIFEST_LOADED,K.default.AUDIO_TRACK_LOADED));return Q.ticks=0,Q.ontick=Q.tick.bind(Q),Q}return B(z,Y),U(z,[{key:"destroy",value:function(){V.default.prototype.destroy.call(this)}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),1<this.ticks&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){this.updateTrack(this.trackId)}},{key:"onManifestLoading",value:function(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function(Q){var Z=this,J=Q.audioTracks||[],$=!1;this.tracks=J,this.hls.trigger(K.default.AUDIO_TRACKS_UPDATED,{audioTracks:J});var ee=0;J.forEach(function(te){return te.default?(Z.audioTrack=ee,void($=!0)):void ee++}),!1==$&&J.length&&(H.logger.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)}},{key:"onAudioTrackLoaded",value:function(Q){Q.id<this.tracks.length&&(H.logger.log("audioTrack "+Q.id+" loaded"),this.tracks[Q.id].details=Q.details,Q.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*Q.details.targetduration)),!Q.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))}},{key:"setAudioTrackInternal",value:function(Q){if(0<=Q&&Q<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=Q,H.logger.log("switching to audioTrack "+Q);var Z=this.tracks[Q],J=this.hls,$=Z.type,ee=Z.url,te={id:Q,type:$,url:ee};J.trigger(K.default.AUDIO_TRACK_SWITCH,te),J.trigger(K.default.AUDIO_TRACK_SWITCHING,te);var ae=Z.details;ee&&(void 0===ae||!0===ae.live)&&(H.logger.log("(re)loading playlist for audioTrack "+Q),J.trigger(K.default.AUDIO_TRACK_LOADING,{url:ee,id:Q}))}}},{key:"updateTrack",value:function(Q){if(0<=Q&&Q<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=Q,H.logger.log("updating audioTrack "+Q);var Z=this.tracks[Q],J=Z.url,$=Z.details;J&&(void 0===$||!0===$.live)&&(H.logger.log("(re)loading playlist for audioTrack "+Q),this.hls.trigger(K.default.AUDIO_TRACK_LOADING,{url:J,id:Q}))}}},{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(Q){(this.trackId!==Q||void 0===this.tracks[Q].details)&&this.setAudioTrackInternal(Q)}}]),z}(V.default);C.default=q},{31:31,32:32,50:50}],8:[function(I,O,C){"use strict";function F(z){return z&&z.__esModule?z:{default:z}}function N(z,X){if(!(z instanceof X))throw new TypeError("Cannot call a class as a function")}function M(z,X){if(!z)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return X&&("object"==typeof X||"function"==typeof X)?X:z}function B(z,X){if("function"!=typeof X&&null!==X)throw new TypeError("Super expression must either be null or a function, not "+typeof X);z.prototype=Object.create(X&&X.prototype,{constructor:{value:z,enumerable:!1,writable:!0,configurable:!0}}),X&&(Object.setPrototypeOf?Object.setPrototypeOf(z,X):z.__proto__=X)}Object.defineProperty(C,"__esModule",{value:!0});var U=function(){function z(X,Q){for(var Z=0,J;Z<Q.length;Z++)J=Q[Z],J.enumerable=J.enumerable||!1,J.configurable=!0,"value"in J&&(J.writable=!0),Object.defineProperty(X,J.key,J)}return function(X,Q,Z){return Q&&z(X.prototype,Q),Z&&z(X,Z),X}}(),G=I(32),K=F(G),W=I(31),V=F(W),H=I(50),q=I(30),Y=function(z){function X(Q){N(this,X);var Z=M(this,(X.__proto__||Object.getPrototypeOf(X)).call(this,Q,K.default.MEDIA_ATTACHING,K.default.MEDIA_DETACHING,K.default.MANIFEST_PARSED,K.default.BUFFER_RESET,K.default.BUFFER_APPENDING,K.default.BUFFER_CODECS,K.default.BUFFER_EOS,K.default.BUFFER_FLUSHING,K.default.LEVEL_PTS_UPDATED,K.default.LEVEL_UPDATED));return Z._msDuration=null,Z._levelDuration=null,Z.onsbue=Z.onSBUpdateEnd.bind(Z),Z.onsbe=Z.onSBUpdateError.bind(Z),Z.pendingTracks={},Z.tracks={},Z}return B(X,z),U(X,[{key:"destroy",value:function(){V.default.prototype.destroy.call(this)}},{key:"onLevelPtsUpdated",value:function(Z){var J=Z.type,$=this.tracks.audio;if("audio"===J&&$&&"audio/mpeg"===$.container){var ee=this.sourceBuffer.audio,te=Math.abs(ee.timestampOffset-Z.start);if(0.1<te){var ae=ee.updating;try{ee.abort()}catch(ne){ae=!0,H.logger.warn("can not abort audio buffer: "+ne)}ae?this.audioTimestampOffset=Z.start:(H.logger.warn("change mpeg audio timestamp offset from "+ee.timestampOffset+" to "+Z.start),ee.timestampOffset=Z.start)}}}},{key:"onManifestParsed",value:function(Z){var J=Z.audio,$=Z.video,ee=0;Z.altAudio&&(J||$)&&(ee=(J?1:0)+($?1:0),H.logger.log(ee+" sourceBuffer(s) expected")),this.sourceBufferNb=ee}},{key:"onMediaAttaching",value:function(Z){var J=this.media=Z.media;if(J){var $=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),$.addEventListener("sourceopen",this.onmso),$.addEventListener("sourceended",this.onmse),$.addEventListener("sourceclose",this.onmsc),J.src=URL.createObjectURL($)}}},{key:"onMediaDetaching",value:function(){H.logger.log("media source detaching");var Z=this.mediaSource;if(Z){if("open"===Z.readyState)try{Z.endOfStream()}catch(J){H.logger.warn("onMediaDetaching:"+J.message+" while calling endOfStream")}Z.removeEventListener("sourceopen",this.onmso),Z.removeEventListener("sourceended",this.onmse),Z.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this.media.src),this.media.removeAttribute("src"),this.media.load()),this.mediaSource=null,this.media=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(K.default.MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function(){H.logger.log("media source opened"),this.hls.trigger(K.default.MEDIA_ATTACHED,{media:this.media});var Z=this.mediaSource;Z&&Z.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()}},{key:"checkPendingTracks",value:function(){var Z=this.pendingTracks,J=Object.keys(Z).length;J&&(this.sourceBufferNb<=J||0===this.sourceBufferNb)&&(this.createSourceBuffers(Z),this.pendingTracks={},this.doAppending())}},{key:"onMediaSourceClose",value:function(){H.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){H.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function(){if(this.audioTimestampOffset){var Z=this.sourceBuffer.audio;H.logger.warn("change mpeg audio timestamp offset from "+Z.timestampOffset+" to "+this.audioTimestampOffset),Z.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var J=this.parent,$=this.segments.reduce(function(ee,te){return te.parent===J?ee+1:ee},0);this.hls.trigger(K.default.BUFFER_APPENDED,{parent:J,pending:$}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()}},{key:"onSBUpdateError",value:function(Z){H.logger.error("sourceBuffer error:",Z),this.hls.trigger(K.default.ERROR,{type:q.ErrorTypes.MEDIA_ERROR,details:q.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferReset",value:function(){var Z=this.sourceBuffer;for(var J in Z){var $=Z[J];try{this.mediaSource.removeSourceBuffer($),$.removeEventListener("updateend",this.onsbue),$.removeEventListener("error",this.onsbe)}catch(ee){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}},{key:"onBufferCodecs",value:function(Z){if(0===Object.keys(this.sourceBuffer).length){for(var J in Z)this.pendingTracks[J]=Z[J];var $=this.mediaSource;$&&"open"===$.readyState&&this.checkPendingTracks()}}},{key:"createSourceBuffers",value:function(Z){var J=this.sourceBuffer,$=this.mediaSource;for(var ee in Z)if(!J[ee]){var te=Z[ee],ae=te.levelCodec||te.codec,ne=te.container+";codecs="+ae;H.logger.log("creating sourceBuffer("+ne+")");try{var oe=J[ee]=$.addSourceBuffer(ne);oe.addEventListener("updateend",this.onsbue),oe.addEventListener("error",this.onsbe),this.tracks[ee]={codec:ae,container:te.container},te.buffer=oe}catch(le){H.logger.error("error while trying to add sourceBuffer:"+le.message),this.hls.trigger(K.default.ERROR,{type:q.ErrorTypes.MEDIA_ERROR,details:q.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:le,mimeType:ne})}}this.hls.trigger(K.default.BUFFER_CREATED,{tracks:Z})}},{key:"onBufferAppending",value:function(Z){this._needsFlush||(this.segments?this.segments.push(Z):this.segments=[Z],this.doAppending())}},{key:"onBufferAppendFail",value:function(Z){H.logger.error("sourceBuffer error:",Z.event),this.hls.trigger(K.default.ERROR,{type:q.ErrorTypes.MEDIA_ERROR,details:q.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferEos",value:function(Z){var J=this.sourceBuffer,$=Z.type;for(var ee in J)(!$||ee===$)&&(J[ee].ended||(J[ee].ended=!0,H.logger.log(ee+" sourceBuffer now EOS")));this.checkEos()}},{key:"checkEos",value:function(){var Z=this.sourceBuffer,J=this.mediaSource;if(!J||"open"!==J.readyState)return void(this._needsEos=!1);for(var $ in Z){var ee=Z[$];if(!ee.ended)return;if(ee.updating)return void(this._needsEos=!0)}H.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{J.endOfStream()}catch(te){H.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}},{key:"onBufferFlushing",value:function(Z){this.flushRange.push({start:Z.startOffset,end:Z.endOffset,type:Z.type}),this.flushBufferCounter=0,this.doFlush()}},{key:"onLevelUpdated",value:function(Z){var J=Z.details;0===J.fragments.length||(this._levelDuration=J.totalduration+J.fragments[0].start,this.updateMediaElementDuration())}},{key:"updateMediaElementDuration",value:function(){var Z=this.media,J=this.mediaSource,$=this.sourceBuffer,ee=this._levelDuration;if(null!==ee&&Z&&J&&$&&0!==Z.readyState&&"open"===J.readyState){for(var te in $)if($[te].updating)return;null===this._msDuration&&(this._msDuration=J.duration);var ae=Z.duration;(ee>this._msDuration&&ee>ae||ae===Infinity||isNaN(ae))&&(H.logger.log("Updating mediasource duration to "+ee.toFixed(3)),this._msDuration=J.duration=ee)}}},{key:"doFlush",value:function(){for(;this.flushRange.length;){var Z=this.flushRange[0];if(this.flushBuffer(Z.start,Z.end,Z.type))this.flushRange.shift(),this.flushBufferCounter=0;else return void(this._needsFlush=!0)}if(0===this.flushRange.length){this._needsFlush=!1;var J=0,$=this.sourceBuffer;try{for(var ee in $)J+=$[ee].buffered.length}catch(te){H.logger.error("error while accessing sourceBuffer.buffered")}this.appended=J,this.hls.trigger(K.default.BUFFER_FLUSHED)}}},{key:"doAppending",value:function(){var Z=this.hls,J=this.sourceBuffer,$=this.segments;if(Object.keys(J).length){if(this.media.error)return this.segments=[],void H.logger.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if($&&$.length){var ee=$.shift();try{var te=ee.type,ae=J[te];ae?ae.updating?$.unshift(ee):(ae.ended=!1,this.parent=ee.parent,ae.appendBuffer(ee.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(oe){H.logger.error("error while trying to append buffer:"+oe.message),$.unshift(ee);var ne={type:q.ErrorTypes.MEDIA_ERROR,parent:ee.parent};if(22!==oe.code){if(this.appendError?this.appendError++:this.appendError=1,ne.details=q.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>Z.config.appendErrorMaxRetry)return H.logger.log("fail "+Z.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),$=[],ne.fatal=!0,void Z.trigger(K.default.ERROR,ne);ne.fatal=!1,Z.trigger(K.default.ERROR,ne)}else return this.segments=[],ne.details=q.ErrorDetails.BUFFER_FULL_ERROR,ne.fatal=!1,void Z.trigger(K.default.ERROR,ne)}}}}},{key:"flushBuffer",value:function(Z,J,$){var ie=this.sourceBuffer,ee,te,ae,ne,oe,le;if(Object.keys(ie).length){if(H.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+Z+"/"+J),this.flushBufferCounter<this.appended){for(var se in ie)if(!($&&se!==$))if(ee=ie[se],ee.ended=!1,!ee.updating)try{for(te=0;te<ee.buffered.length;te++)if(ae=ee.buffered.start(te),ne=ee.buffered.end(te),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&J===Number.POSITIVE_INFINITY?(oe=Z,le=J):(oe=Math.max(ae,Z),le=Math.min(ne,J)),0.5<Math.min(le,ne)-oe)return this.flushBufferCounter++,H.logger.log("flush "+se+" ["+oe+","+le+"], of ["+ae+","+ne+"], pos:"+this.media.currentTime),ee.remove(oe,le),!1}catch(de){H.logger.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}else return H.logger.warn("cannot flush, sb updating in progress"),!1;}else H.logger.warn("abort flushing too many retries");H.logger.log("buffer flushed")}return!0}}]),X}(V.default);C.default=Y},{30:30,31:31,32:32,50:50}],9:[function(I,O,C){"use strict";function F(q){return q&&q.__esModule?q:{default:q}}function N(q,Y){if(!(q instanceof Y))throw new TypeError("Cannot call a class as a function")}function M(q,Y){if(!q)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Y&&("object"==typeof Y||"function"==typeof Y)?Y:q}function B(q,Y){if("function"!=typeof Y&&null!==Y)throw new TypeError("Super expression must either be null or a function, not "+typeof Y);q.prototype=Object.create(Y&&Y.prototype,{constructor:{value:q,enumerable:!1,writable:!0,configurable:!0}}),Y&&(Object.setPrototypeOf?Object.setPrototypeOf(q,Y):q.__proto__=Y)}Object.defineProperty(C,"__esModule",{value:!0});var U=function(){function q(Y,z){for(var X=0,Q;X<z.length;X++)Q=z[X],Q.enumerable=Q.enumerable||!1,Q.configurable=!0,"value"in Q&&(Q.writable=!0),Object.defineProperty(Y,Q.key,Q)}return function(Y,z,X){return z&&q(Y.prototype,z),X&&q(Y,X),Y}}(),G=I(32),K=F(G),W=I(31),V=F(W),H=function(q){function Y(z){return N(this,Y),M(this,(Y.__proto__||Object.getPrototypeOf(Y)).call(this,z,K.default.FPS_DROP_LEVEL_CAPPING,K.default.MEDIA_ATTACHING,K.default.MANIFEST_PARSED))}return B(Y,q),U(Y,[{key:"destroy",value:function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))}},{key:"onFpsDropLevelCapping",value:function(X){this.restrictedLevels||(this.restrictedLevels=[]),this.isLevelRestricted(X.droppedLevel)||this.restrictedLevels.push(X.droppedLevel)}},{key:"onMediaAttaching",value:function(X){this.media=X.media instanceof HTMLVideoElement?X.media:null}},{key:"onManifestParsed",value:function(X){var Q=this.hls;Q.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=X.levels,Q.firstLevel=this.getMaxLevel(X.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"detectPlayerSize",value:function(){if(this.media){var X=this.levels?this.levels.length:0;if(X){var Q=this.hls;Q.autoLevelCapping=this.getMaxLevel(X-1),Q.autoLevelCapping>this.autoLevelCapping&&Q.streamController.nextLevelSwitch(),this.autoLevelCapping=Q.autoLevelCapping}}}},{key:"getMaxLevel",value:function(X){var Q=0,Z=void 0,$=this.mediaWidth,ee=this.mediaHeight,te=0,ae=0,J;for(Z=0;Z<=X&&(J=this.levels[Z],!this.isLevelRestricted(Z))&&(Q=Z,te=J.width,ae=J.height,!($<=te||ee<=ae));Z++);return Q}},{key:"isLevelRestricted",value:function(X){return this.restrictedLevels&&-1!==this.restrictedLevels.indexOf(X)}},{key:"contentScaleFactor",get:function(){var X=1;try{X=window.devicePixelRatio}catch(Q){}return X}},{key:"mediaWidth",get:function(){var Q=this.media,X;return Q&&(X=Q.width||Q.clientWidth||Q.offsetWidth,X*=this.contentScaleFactor),X}},{key:"mediaHeight",get:function(){var Q=this.media,X;return Q&&(X=Q.height||Q.clientHeight||Q.offsetHeight,X*=this.contentScaleFactor),X}}]),Y}(V.default);C.default=H},{31:31,32:32}],10:[function(I,O,C){"use strict";function F(Y){return Y&&Y.__esModule?Y:{default:Y}}function N(Y,z){if(!(Y instanceof z))throw new TypeError("Cannot call a class as a function")}function M(Y,z){if(!Y)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return z&&("object"==typeof z||"function"==typeof z)?z:Y}function B(Y,z){if("function"!=typeof z&&null!==z)throw new TypeError("Super expression must either be null or a function, not "+typeof z);Y.prototype=Object.create(z&&z.prototype,{constructor:{value:Y,enumerable:!1,writable:!0,configurable:!0}}),z&&(Object.setPrototypeOf?Object.setPrototypeOf(Y,z):Y.__proto__=z)}Object.defineProperty(C,"__esModule",{value:!0});var U=function(){function Y(z,X){for(var Q=0,Z;Q<X.length;Q++)Z=X[Q],Z.enumerable=Z.enumerable||!1,Z.configurable=!0,"value"in Z&&(Z.writable=!0),Object.defineProperty(z,Z.key,Z)}return function(z,X,Q){return X&&Y(z.prototype,X),Q&&Y(z,Q),z}}(),G=I(32),K=F(G),W=I(31),V=F(W),H=I(50),q=function(Y){function z(X){return N(this,z),M(this,(z.__proto__||Object.getPrototypeOf(z)).call(this,X,K.default.MEDIA_ATTACHING))}return B(z,Y),U(z,[{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1}},{key:"onMediaAttaching",value:function(Q){var Z=this.hls.config;if(Z.capLevelOnFPSDrop){var J=this.video=Q.media instanceof HTMLVideoElement?Q.media:null;"function"==typeof J.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),Z.fpsDroppedMonitoringPeriod)}}},{key:"checkFPS",value:function(Q,Z,J){var $=performance.now();if(Z){if(this.lastTime){var ee=$-this.lastTime,te=J-this.lastDroppedFrames,ae=Z-this.lastDecodedFrames,oe=this.hls;if(oe.trigger(K.default.FPS_DROP,{currentDropped:te,currentDecoded:ae,totalDroppedFrames:J}),0<1e3*te/ee&&te>oe.config.fpsDroppedMonitoringThreshold*ae){var le=oe.currentLevel;H.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+le),0<le&&(-1===oe.autoLevelCapping||oe.autoLevelCapping>=le)&&(--le,oe.trigger(K.default.FPS_DROP_LEVEL_CAPPING,{level:le,droppedLevel:oe.currentLevel}),oe.autoLevelCapping=le,oe.streamController.nextLevelSwitch())}}this.lastTime=$,this.lastDroppedFrames=J,this.lastDecodedFrames=Z}}},{key:"checkFPSInterval",value:function(){var Q=this.video;if(Q)if(this.isVideoPlaybackQualityAvailable){var Z=Q.getVideoPlaybackQuality();this.checkFPS(Q,Z.totalVideoFrames,Z.droppedVideoFrames)}else this.checkFPS(Q,Q.webkitDecodedFrameCount,Q.webkitDroppedFrameCount)}}]),z}(V.default);C.default=q},{31:31,32:32,50:50}],11:[function(I,O,C){"use strict";function F(Q){return Q&&Q.__esModule?Q:{default:Q}}function N(Q,Z){if(!(Q instanceof Z))throw new TypeError("Cannot call a class as a function")}function M(Q,Z){if(!Q)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Z&&("object"==typeof Z||"function"==typeof Z)?Z:Q}function B(Q,Z){if("function"!=typeof Z&&null!==Z)throw new TypeError("Super expression must either be null or a function, not "+typeof Z);Q.prototype=Object.create(Z&&Z.prototype,{constructor:{value:Q,enumerable:!1,writable:!0,configurable:!0}}),Z&&(Object.setPrototypeOf?Object.setPrototypeOf(Q,Z):Q.__proto__=Z)}Object.defineProperty(C,"__esModule",{value:!0});var U=function(){function Q(Z,J){for(var $=0,ee;$<J.length;$++)ee=J[$],ee.enumerable=ee.enumerable||!1,ee.configurable=!0,"value"in ee&&(ee.writable=!0),Object.defineProperty(Z,ee.key,ee)}return function(Z,J,$){return J&&Q(Z.prototype,J),$&&Q(Z,$),Z}}(),G=I(32),K=F(G),W=I(31),V=F(W),H=I(50),q=I(30),Y=I(34),z=F(Y),X=function(Q){function Z(J){N(this,Z);var $=M(this,(Z.__proto__||Object.getPrototypeOf(Z)).call(this,J,K.default.MANIFEST_LOADED,K.default.LEVEL_LOADED,K.default.FRAG_LOADED,K.default.ERROR));return $.ontick=$.tick.bind($),$._manualLevel=-1,$}return B(Z,Q),U(Z,[{key:"destroy",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this._manualLevel=-1}},{key:"startLoad",value:function(){this.canload=!0;var $=this._levels;$&&$.forEach(function(ee){ee.loadError=0;var te=ee.details;te&&te.live&&(ee.details=void 0)}),this.timer&&this.tick()}},{key:"stopLoad",value:function(){this.canload=!1}},{key:"onManifestLoaded",value:function($){var ee=[],te=[],ne={},oe=!1,le=!1,ie=this.hls,se=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),de=function(fe,ge){return MediaSource.isTypeSupported(fe+"/mp4;codecs="+ge)},ae;if($.levels.forEach(function(ce){ce.videoCodec&&(oe=!0),se&&ce.audioCodec&&-1!==ce.audioCodec.indexOf("mp4a.40.34")&&(ce.audioCodec=void 0),(ce.audioCodec||ce.attrs&&ce.attrs.AUDIO)&&(le=!0);var fe=ne[ce.bitrate];void 0===fe?(ne[ce.bitrate]=ee.length,ce.url=[ce.url],ce.urlId=0,ee.push(ce)):ee[fe].url.push(ce.url)}),oe&&le?ee.forEach(function(ce){ce.videoCodec&&te.push(ce)}):te=ee,te=te.filter(function(ce){var fe=ce.audioCodec,ge=ce.videoCodec;return(!fe||de("audio",fe))&&(!ge||de("video",ge))}),te.length){ae=te[0].bitrate,te.sort(function(ce,fe){return ce.bitrate-fe.bitrate}),this._levels=te;for(var ue=0;ue<te.length;ue++)if(te[ue].bitrate===ae){this._firstLevel=ue,H.logger.log("manifest loaded,"+te.length+" level(s) found, first bitrate:"+ae);break}ie.trigger(K.default.MANIFEST_PARSED,{levels:te,firstLevel:this._firstLevel,stats:$.stats,audio:le,video:oe,altAudio:0<$.audioTracks.length})}else ie.trigger(K.default.ERROR,{type:q.ErrorTypes.MEDIA_ERROR,details:q.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:ie.url,reason:"no level with compatible codecs found in manifest"})}},{key:"setLevelInternal",value:function($){var ee=this._levels,te=this.hls;if(0<=$&&$<ee.length){if(this.timer&&(clearTimeout(this.timer),this.timer=null),this._level!==$){H.logger.log("switching to level "+$),this._level=$;var ae=ee[$];ae.level=$,te.trigger(K.default.LEVEL_SWITCH,ae),te.trigger(K.default.LEVEL_SWITCHING,ae)}var ne=ee[$],oe=ne.details;if(!oe||!0===oe.live){var le=ne.urlId;te.trigger(K.default.LEVEL_LOADING,{url:ne.url[le],level:$,id:le})}}else te.trigger(K.default.ERROR,{type:q.ErrorTypes.OTHER_ERROR,details:q.ErrorDetails.LEVEL_SWITCH_ERROR,level:$,fatal:!1,reason:"invalid level idx"})}},{key:"onError",value:function($){if(!$.fatal){var ee=$.details,te=this.hls,oe=!1,ae,ne;switch(ee){case q.ErrorDetails.FRAG_LOAD_ERROR:case q.ErrorDetails.FRAG_LOAD_TIMEOUT:case q.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case q.ErrorDetails.KEY_LOAD_ERROR:case q.ErrorDetails.KEY_LOAD_TIMEOUT:ae=$.frag.level;break;case q.ErrorDetails.LEVEL_LOAD_ERROR:case q.ErrorDetails.LEVEL_LOAD_TIMEOUT:ae=$.context.level,oe=!0;break;case q.ErrorDetails.REMUX_ALLOC_ERROR:ae=$.level;break;default:}if(void 0!==ae){ne=this._levels[ae],ne.loadError?ne.loadError++:ne.loadError=1;var le=ne.url.length;if(1<le&&ne.loadError<le)ne.urlId=(ne.urlId+1)%le,ne.details=void 0,H.logger.warn("level controller,"+ee+" for level "+ae+": switching to redundant stream id "+ne.urlId);else{var ie=-1===this._manualLevel&&ae;if(ie)H.logger.warn("level controller,"+ee+": switch-down for next fragment"),te.nextAutoLevel=Math.max(0,ae-1);else if(ne&&ne.details&&ne.details.live)H.logger.warn("level controller,"+ee+" on live stream, discard"),oe&&(this._level=void 0);else if(ee===q.ErrorDetails.LEVEL_LOAD_ERROR||ee===q.ErrorDetails.LEVEL_LOAD_TIMEOUT){var se=te.media,de=se&&z.default.isBuffered(se,se.currentTime)&&z.default.isBuffered(se,se.currentTime+0.5);if(de){var ue=te.config.levelLoadingRetryDelay;H.logger.warn("level controller,"+ee+", but media buffered, retry in "+ue+"ms"),this.timer=setTimeout(this.ontick,ue)}else H.logger.error("cannot recover "+ee+" error"),this._level=void 0,this.timer&&(clearTimeout(this.timer),this.timer=null),$.fatal=!0}}}}}},{key:"onFragLoaded",value:function($){var ee=$.frag;if(ee&&"main"===ee.type){var te=this._levels[ee.level];te&&(te.loadError=0)}}},{key:"onLevelLoaded",value:function($){var ee=$.level;if(ee===this._level){var te=this._levels[ee];te.loadError=0;var ae=$.details;if(ae.live){var ne=1e3*(ae.averagetargetduration?ae.averagetargetduration:ae.targetduration),oe=te.details;oe&&ae.endSN===oe.endSN&&(ne/=2,H.logger.log("same live playlist, reload twice faster")),ne-=performance.now()-$.stats.trequest,ne=Math.max(1e3,Math.round(ne)),H.logger.log("live playlist, reload in "+ne+" ms"),this.timer=setTimeout(this.ontick,ne)}else this.timer=null}}},{key:"tick",value:function(){var $=this._level;if(void 0!==$&&this.canload){var ee=this._levels[$],te=ee.urlId;this.hls.trigger(K.default.LEVEL_LOADING,{url:ee.url[te],level:$,id:te})}}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._level},set:function($){var ee=this._levels;ee&&ee.length>$&&(this._level!==$||void 0===ee[$].details)&&this.setLevelInternal($)}},{key:"manualLevel",get:function(){return this._manualLevel},set:function($){this._manualLevel=$,void 0===this._startLevel&&(this._startLevel=$),-1!==$&&(this.level=$)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function($){this._firstLevel=$}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var $=this.hls.config.startLevel;return void 0===$?this._firstLevel:$}return this._startLevel},set:function($){this._startLevel=$}},{key:"nextLoadLevel",get:function(){return-1===this._manualLevel?this.hls.nextAutoLevel:this._manualLevel},set:function($){this.level=$,-1===this._manualLevel&&(this.hls.nextAutoLevel=$)}}]),Z}(V.default);C.default=X},{30:30,31:31,32:32,34:34,50:50}],12:[function(I,O,C){"use strict";function F(le){return le&&le.__esModule?le:{default:le}}function N(le,ie){if(!(le instanceof ie))throw new TypeError("Cannot call a class as a function")}function M(le,ie){if(!le)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ie&&("object"==typeof ie||"function"==typeof ie)?ie:le}function B(le,ie){if("function"!=typeof ie&&null!==ie)throw new TypeError("Super expression must either be null or a function, not "+typeof ie);le.prototype=Object.create(ie&&ie.prototype,{constructor:{value:le,enumerable:!1,writable:!0,configurable:!0}}),ie&&(Object.setPrototypeOf?Object.setPrototypeOf(le,ie):le.__proto__=ie)}Object.defineProperty(C,"__esModule",{value:!0});var U=function(){function le(ie,se){for(var de=0,ue;de<se.length;de++)ue=se[de],ue.enumerable=ue.enumerable||!1,ue.configurable=!0,"value"in ue&&(ue.writable=!0),Object.defineProperty(ie,ue.key,ue)}return function(ie,se,de){return se&&le(ie.prototype,se),de&&le(ie,de),ie}}(),G=I(45),K=F(G),W=I(34),V=F(W),H=I(24),q=F(H),Y=I(32),z=F(Y),X=I(31),Q=F(X),Z=I(35),J=F(Z),$=I(51),ee=F($),te=I(30),ae=I(50),ne={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},oe=function(le){function ie(se){N(this,ie);var de=M(this,(ie.__proto__||Object.getPrototypeOf(ie)).call(this,se,z.default.MEDIA_ATTACHED,z.default.MEDIA_DETACHING,z.default.MANIFEST_LOADING,z.default.MANIFEST_PARSED,z.default.LEVEL_LOADED,z.default.KEY_LOADED,z.default.FRAG_LOADED,z.default.FRAG_LOAD_EMERGENCY_ABORTED,z.default.FRAG_PARSING_INIT_SEGMENT,z.default.FRAG_PARSING_DATA,z.default.FRAG_PARSED,z.default.ERROR,z.default.AUDIO_TRACK_SWITCHING,z.default.AUDIO_TRACK_SWITCHED,z.default.BUFFER_CREATED,z.default.BUFFER_APPENDED,z.default.BUFFER_FLUSHED));return de.config=se.config,de.audioCodecSwap=!1,de.ticks=0,de._state=ne.STOPPED,de.ontick=de.tick.bind(de),de}return B(ie,le),U(ie,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),Q.default.prototype.destroy.call(this),this.state=ne.STOPPED}},{key:"startLoad",value:function(de){if(this.levels){var ue=this.lastCurrentTime,ce=this.hls;if(this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var fe=ce.startLevel;-1===fe&&(fe=0,this.bitrateTest=!0),this.level=ce.nextLoadLevel=fe,this.loadedmetadata=!1}0<ue&&-1===de&&(ae.logger.log("override startPosition with lastCurrentTime @"+ue.toFixed(3)),de=ue),this.state=ne.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=de,this.tick()}else ae.logger.warn("cannot start loading as manifest not parsed yet"),this.state=ne.STOPPED}},{key:"stopLoad",value:function(){var de=this.fragCurrent;de&&(de.loader&&de.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=ne.STOPPED}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),1<this.ticks&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){switch(this.state){case ne.ERROR:break;case ne.BUFFER_FLUSHING:this.fragLoadError=0;break;case ne.IDLE:if(!this._doTickIdle())return;break;case ne.WAITING_LEVEL:var de=this.levels[this.level];de&&de.details&&(this.state=ne.IDLE);break;case ne.FRAG_LOADING_WAITING_RETRY:var ue=performance.now(),ce=this.retryDate;(!ce||ue>=ce||this.media&&this.media.seeking)&&(ae.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=ne.IDLE);break;case ne.ERROR:case ne.STOPPED:case ne.FRAG_LOADING:case ne.PARSING:case ne.PARSED:case ne.ENDED:break;default:}this._checkBuffer(),this._checkFragmentChanged()}},{key:"_doTickIdle",value:function(){var de=this.hls,ue=de.config,ce=this.media;if(void 0!==this.levelLastLoaded&&!ce&&(this.startFragRequested||!ue.startFragPrefetch))return!0;var fe=this.loadedmetadata?ce.currentTime:this.nextLoadPosition;var ge=de.nextLoadLevel,pe=this.levels[ge],me=pe.bitrate,ye;ye=me?Math.max(8*ue.maxBufferSize/me,ue.maxBufferLength):ue.maxBufferLength,ye=Math.min(ye,ue.maxMaxBufferLength);var he=V.default.bufferInfo(this.mediaBuffer?this.mediaBuffer:ce,fe,ue.maxBufferHole),ve=he.len;if(ve>=ye)return!0;ae.logger.trace("buffer length of "+ve.toFixed(3)+" is below max of "+ye.toFixed(3)+". checking for more payload ..."),this.level=de.nextLoadLevel=ge;var be=pe.details;if("undefined"==typeof be||be.live&&this.levelLastLoaded!==ge)return this.state=ne.WAITING_LEVEL,!0;var Ee=this.fragPrevious;if(!be.live&&Ee&&Ee.sn===be.endSN&&ce.duration-Math.max(he.end,Ee.start)<=Math.max(0.2,Ee.duration/2)){var ke={};return this.altAudio&&(ke.type="video"),this.hls.trigger(z.default.BUFFER_EOS,ke),this.state=ne.ENDED,!0}return this._fetchPayloadOrEos(fe,he,be)}},{key:"_fetchPayloadOrEos",value:function(de,ue,ce){var fe=this.fragPrevious,ge=this.level,pe=ce.fragments,me=pe.length;if(0===me)return!1;var ye=pe[0].start,he=pe[me-1].start+pe[me-1].duration,ve=ue.end,be;if(ce.initSegment&&!ce.initSegment.data)be=ce.initSegment;else if(ce.live){var Ee=this.config.initialLiveManifestSize;if(me<Ee)return ae.logger.warn("Can not start playback of a level, reason: not enough fragments "+me+" < "+Ee),!1;if(be=this._ensureFragmentAtLivePoint(ce,ve,ye,he,fe,pe,me),null===be)return!1}else ve<ye&&(be=pe[0]);return be||(be=this._findFragment(ye,fe,me,pe,ve,he,ce)),!be||this._loadFragmentOrKey(be,ge,ce,de,ve)}},{key:"_ensureFragmentAtLivePoint",value:function(de,ue,ce,fe,ge,pe,me){var ye=this.hls.config,he=this.media,be=void 0===ye.liveMaxLatencyDuration?ye.liveMaxLatencyDurationCount*de.targetduration:ye.liveMaxLatencyDuration,ve;if(ue<Math.max(ce-ye.maxFragLookUpTolerance,fe-be)){var Ee=this.liveSyncPosition=this.computeLivePosition(ce,de);ae.logger.log("buffer end: "+ue.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+Ee.toFixed(3)),ue=Ee,he&&he.readyState&&he.duration>Ee&&(he.currentTime=Ee)}if(de.PTSKnown&&ue>fe&&he&&he.readyState)return null;if(this.startFragRequested&&!de.PTSKnown){if(ge){var ke=ge.sn+1;ke>=de.startSN&&ke<=de.endSN&&(ve=pe[ke-de.startSN],ae.logger.log("live playlist, switching playlist, load frag with next SN: "+ve.sn))}ve||(ve=pe[Math.min(me-1,Math.round(me/2))],ae.logger.log("live playlist, switching playlist, unknown, load middle frag : "+ve.sn))}return ve}},{key:"_findFragment",value:function(de,ue,ce,fe,ge,pe,me){var ye=this.hls.config,be=ye.maxFragLookUpTolerance,Ee=ue?fe[ue.sn-fe[0].sn+1]:void 0,ke=function(Pe){var Ie=Math.min(be,Pe.duration);return Pe.start+Pe.duration-Ie<=ge?1:Pe.start-Ie>ge&&Pe.start?-1:0},he,ve;if(ge<pe?(ge>pe-be&&(be=0),ve=Ee&&!ke(Ee)?Ee:K.default.search(fe,ke)):ve=fe[ce-1],ve){he=ve;var Te=he.sn-me.startSN,Re=ue&&he.level===ue.level,Se=fe[Te-1],Ae=fe[Te+1];if(!(Re&&he.sn===ue.sn))he.dropped&&!Re&&(Ae&&Ae.backtracked?(ae.logger.warn("Already backtracked from fragment "+(Te+1)+", will not backtrack to fragment "+Te+". Loading fragment "+(Te+1)),he=Ae):(ae.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),he.dropped=0,Se?(Se.loadCounter&&Se.loadCounter--,he=Se):he=null));else if(he.sn<me.endSN){var Le=ue.deltaPTS;Le&&Le>ye.maxBufferHole&&ue.dropped&&Te?(he=Se,ae.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),ue.loadCounter--):(he=Ae,ae.logger.log("SN just loaded, load next one: "+he.sn))}else he=null}return he}},{key:"_loadFragmentOrKey",value:function(de,ue,ce,fe,ge){var pe=this.hls,me=pe.config;if(de.decryptdata&&null!=de.decryptdata.uri&&null==de.decryptdata.key)ae.logger.log("Loading key for "+de.sn+" of ["+ce.startSN+" ,"+ce.endSN+"],level "+ue),this.state=ne.KEY_LOADING,pe.trigger(z.default.KEY_LOADING,{frag:de});else{if(ae.logger.log("Loading "+de.sn+" of ["+ce.startSN+" ,"+ce.endSN+"],level "+ue+", currentTime:"+fe.toFixed(3)+",bufferEnd:"+ge.toFixed(3)),void 0===this.fragLoadIdx?this.fragLoadIdx=0:this.fragLoadIdx++,de.loadCounter){de.loadCounter++;var ye=me.fragLoadingLoopThreshold;if(de.loadCounter>ye&&Math.abs(this.fragLoadIdx-de.loadIdx)<ye)return pe.trigger(z.default.ERROR,{type:te.ErrorTypes.MEDIA_ERROR,details:te.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:de}),!1}else de.loadCounter=1;return de.loadIdx=this.fragLoadIdx,this.fragCurrent=de,this.startFragRequested=!0,isNaN(de.sn)||(this.nextLoadPosition=de.start+de.duration),de.autoLevel=pe.autoLevelEnabled,de.bitrateTest=this.bitrateTest,pe.trigger(z.default.FRAG_LOADING,{frag:de}),this.demuxer||(this.demuxer=new q.default(pe,"main")),this.state=ne.FRAG_LOADING,!0}}},{key:"getBufferedFrag",value:function(de){return K.default.search(this._bufferedFrags,function(ue){return de<ue.startPTS?-1:de>ue.endPTS?1:0})}},{key:"followingBufferedFrag",value:function(de){return de?this.getBufferedFrag(de.endPTS+0.5):null}},{key:"_checkFragmentChanged",value:function(){var ce=this.media,de,ue;if(ce&&ce.readyState&&!1===ce.seeking&&(ue=ce.currentTime,ue>ce.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=ue),V.default.isBuffered(ce,ue)?de=this.getBufferedFrag(ue):V.default.isBuffered(ce,ue+0.1)&&(de=this.getBufferedFrag(ue+0.1)),de)){var fe=de;if(fe!==this.fragPlaying){this.hls.trigger(z.default.FRAG_CHANGED,{frag:fe});var ge=fe.level;this.fragPlaying&&this.fragPlaying.level===ge||this.hls.trigger(z.default.LEVEL_SWITCHED,{level:ge}),this.fragPlaying=fe}}}},{key:"immediateLevelSwitch",value:function(){if(ae.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var de=this.media,ue;de?(ue=de.paused,de.pause()):ue=!0,this.previouslyPaused=ue}var ce=this.fragCurrent;ce&&ce.loader&&ce.loader.abort(),this.fragCurrent=null,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}},{key:"immediateLevelSwitchEnd",value:function(){var de=this.media;de&&de.buffered.length&&(this.immediateSwitch=!1,V.default.isBuffered(de,de.currentTime)&&(de.currentTime-=1e-4),!this.previouslyPaused&&de.play())}},{key:"nextLevelSwitch",value:function(){var de=this.media;if(de&&de.readyState){var ue,ce,fe;if(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,ce=this.getBufferedFrag(de.currentTime),ce&&1<ce.startPTS&&this.flushMainBuffer(0,ce.startPTS-1),!de.paused){var ge=this.hls.nextLoadLevel,pe=this.levels[ge],me=this.fragLastKbps;ue=me&&this.fragCurrent?this.fragCurrent.duration*pe.bitrate/(1e3*me)+1:0}else ue=0;if(fe=this.getBufferedFrag(de.currentTime+ue),fe&&(fe=this.followingBufferedFrag(fe),fe)){var ye=this.fragCurrent;ye&&ye.loader&&ye.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(fe.startPTS,Number.POSITIVE_INFINITY)}}}},{key:"flushMainBuffer",value:function(de,ue){this.state=ne.BUFFER_FLUSHING;var ce={startOffset:de,endOffset:ue};this.altAudio&&(ce.type="video"),this.hls.trigger(z.default.BUFFER_FLUSHING,ce)}},{key:"onMediaAttached",value:function(de){var ue=this.media=this.mediaBuffer=de.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),ue.addEventListener("seeking",this.onvseeking),ue.addEventListener("seeked",this.onvseeked),ue.addEventListener("ended",this.onvended);var ce=this.config;this.levels&&ce.autoStartLoad&&this.hls.startLoad(ce.startPosition)}},{key:"onMediaDetaching",value:function(){var de=this.media;de&&de.ended&&(ae.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var ue=this.levels;ue&&ue.forEach(function(ce){ce.details&&ce.details.fragments.forEach(function(fe){fe.loadCounter=void 0,fe.backtracked=void 0})}),de&&(de.removeEventListener("seeking",this.onvseeking),de.removeEventListener("seeked",this.onvseeked),de.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){var de=this.media,ue=de?de.currentTime:void 0,ce=this.config;if(ae.logger.log("media seeking to "+ue.toFixed(3)),this.state===ne.FRAG_LOADING){var fe=this.mediaBuffer?this.mediaBuffer:de,ge=V.default.bufferInfo(fe,ue,this.config.maxBufferHole),pe=this.fragCurrent;if(0===ge.len&&pe){var me=ce.maxFragLookUpTolerance,ye=pe.start-me,he=pe.start+pe.duration+me;ue<ye||ue>he?(pe.loader&&(ae.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),pe.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=ne.IDLE):ae.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===ne.ENDED&&(this.state=ne.IDLE);de&&(this.lastCurrentTime=ue),this.state!==ne.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*ce.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=ue),this.tick()}},{key:"onMediaSeeked",value:function(){ae.logger.log("media seeked to "+this.media.currentTime.toFixed(3)),this.tick()}},{key:"onMediaEnded",value:function(){ae.logger.log("media ended"),this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoading",value:function(){ae.logger.log("trigger BUFFER_RESET"),this.hls.trigger(z.default.BUFFER_RESET),this._bufferedFrags=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function(de){var ue=!1,ce=!1,fe;de.levels.forEach(function(pe){fe=pe.audioCodec,fe&&(-1!==fe.indexOf("mp4a.40.2")&&(ue=!0),-1!==fe.indexOf("mp4a.40.5")&&(ce=!0))}),this.audioCodecSwitch=ue&&ce,this.audioCodecSwitch&&ae.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=de.levels,this.startLevelLoaded=!1,this.startFragRequested=!1;var ge=this.config;ge.autoStartLoad&&this.hls.startLoad(ge.startPosition)}},{key:"onLevelLoaded",value:function(de){var ue=de.details,ce=de.level,fe=this.levels[ce],ge=ue.totalduration,pe=0;if(ae.logger.log("level "+ce+" loaded ["+ue.startSN+","+ue.endSN+"],duration:"+ge),this.levelLastLoaded=ce,ue.live){var me=fe.details;me&&0<ue.fragments.length?(J.default.mergeDetails(me,ue),pe=ue.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(pe,me),ue.PTSKnown?ae.logger.log("live playlist sliding:"+pe.toFixed(3)):ae.logger.log("live playlist - outdated PTS, unknown sliding")):(ue.PTSKnown=!1,ae.logger.log("live playlist - first load, unknown sliding"))}else ue.PTSKnown=!1;if(fe.details=ue,this.hls.trigger(z.default.LEVEL_UPDATED,{details:ue,level:ce}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var ye=ue.startTimeOffset;isNaN(ye)?ue.live?(this.startPosition=this.computeLivePosition(pe,ue),ae.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(0>ye&&(ae.logger.log("negative start time offset "+ye+", count from end of last fragment"),ye=pe+ge+ye),ae.logger.log("start time offset found in playlist, adjust startPosition to "+ye),this.startPosition=ye),this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===ne.WAITING_LEVEL&&(this.state=ne.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===ne.KEY_LOADING&&(this.state=ne.IDLE,this.tick())}},{key:"onFragLoaded",value:function(de){var ue=this.fragCurrent,ce=de.frag;if(this.state===ne.FRAG_LOADING&&ue&&"main"===ce.type&&ce.level===ue.level&&ce.sn===ue.sn){var fe=de.stats,ge=this.levels[ue.level],pe=ge.details;if(ae.logger.log("Loaded  "+ue.sn+" of ["+pe.startSN+" ,"+pe.endSN+"],level "+ue.level),this.bitrateTest=!1,this.stats=fe,!0===ce.bitrateTest&&this.hls.nextLoadLevel)this.state=ne.IDLE,this.startFragRequested=!1,fe.tparsed=fe.tbuffered=performance.now(),this.hls.trigger(z.default.FRAG_BUFFERED,{stats:fe,frag:ue,id:"main"}),this.tick();else if("initSegment"===ce.sn)this.state=ne.IDLE,fe.tparsed=fe.tbuffered=performance.now(),pe.initSegment.data=de.payload,this.hls.trigger(z.default.FRAG_BUFFERED,{stats:fe,frag:ue,id:"main"}),this.tick();else{this.state=ne.PARSING;var me=pe.totalduration,ye=ue.level,he=ue.sn,ve=this.config.defaultAudioCodec||ge.audioCodec;this.audioCodecSwap&&(ae.logger.log("swapping playlist audio codec"),void 0===ve&&(ve=this.lastAudioCodec),ve&&(-1===ve.indexOf("mp4a.40.5")?ve="mp4a.40.5":ve="mp4a.40.2")),this.pendingBuffering=!0,this.appended=!1,ae.logger.log("Parsing "+he+" of ["+pe.startSN+" ,"+pe.endSN+"],level "+ye+", cc "+ue.cc);var be=this.demuxer;be||(be=this.demuxer=new q.default(this.hls,"main"));var Ee=this.media,ke=Ee&&Ee.seeking,Te=!ke&&(pe.PTSKnown||!pe.live),Re=pe.initSegment?pe.initSegment.data:[];be.push(de.payload,Re,ve,ge.videoCodec,ue,me,Te,void 0)}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(de){var ue=this.fragCurrent,ce=de.frag;if(ue&&"main"===de.id&&ce.sn===ue.sn&&ce.level===ue.level&&this.state===ne.PARSING){var fe=de.tracks,ge,pe;if(fe.audio&&this.altAudio&&delete fe.audio,pe=fe.audio,pe){var me=this.levels[this.level].audioCodec,ye=navigator.userAgent.toLowerCase();me&&this.audioCodecSwap&&(ae.logger.log("swapping playlist audio codec"),me=-1===me.indexOf("mp4a.40.5")?"mp4a.40.5":"mp4a.40.2"),this.audioCodecSwitch&&1!==pe.metadata.channelCount&&-1===ye.indexOf("firefox")&&(me="mp4a.40.5"),-1!==ye.indexOf("android")&&"audio/mpeg"!==pe.container&&(me="mp4a.40.2",ae.logger.log("Android: force audio codec to "+me)),pe.levelCodec=me,pe.id=de.id}for(ge in pe=fe.video,pe&&(pe.levelCodec=this.levels[this.level].videoCodec,pe.id=de.id),this.hls.trigger(z.default.BUFFER_CODECS,fe),fe){pe=fe[ge],ae.logger.log("main track:"+ge+",container:"+pe.container+",codecs[level/parsed]=["+pe.levelCodec+"/"+pe.codec+"]");var he=pe.initSegment;he&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(z.default.BUFFER_APPENDING,{type:ge,data:he,parent:"main",content:"initSegment"}))}this.tick()}}},{key:"onFragParsingData",value:function(de){var ue=this,ce=this.fragCurrent,fe=de.frag;if(ce&&"main"===de.id&&fe.sn===ce.sn&&fe.level===ce.level&&!("audio"===de.type&&this.altAudio)&&this.state===ne.PARSING){var ge=this.levels[this.level],pe=ce;if(isNaN(de.endPTS)&&(de.endPTS=de.startPTS+ce.duration,de.endDTS=de.startDTS+ce.duration),ae.logger.log("Parsed "+de.type+",PTS:["+de.startPTS.toFixed(3)+","+de.endPTS.toFixed(3)+"],DTS:["+de.startDTS.toFixed(3)+"/"+de.endDTS.toFixed(3)+"],nb:"+de.nb+",dropped:"+(de.dropped||0)),"video"===de.type)if(pe.dropped=de.dropped,pe.dropped){if(!pe.backtracked)return pe.backtracked=!0,this.nextLoadPosition=de.startPTS,this.state=ne.IDLE,void this.tick();ae.logger.warn("Already backtracked on this fragment, appending with the gap")}else pe.backtracked=!1;var me=J.default.updateFragPTSDTS(ge.details,pe.sn,de.startPTS,de.endPTS,de.startDTS,de.endDTS),ye=this.hls;ye.trigger(z.default.LEVEL_PTS_UPDATED,{details:ge.details,level:this.level,drift:me,type:de.type,start:de.startPTS,end:de.endPTS}),[de.data1,de.data2].forEach(function(he){he&&he.length&&ue.state===ne.PARSING&&(ue.appended=!0,ue.pendingBuffering=!0,ye.trigger(z.default.BUFFER_APPENDING,{type:de.type,data:he,parent:"main",content:"data"}))}),this.tick()}}},{key:"onFragParsed",value:function(de){var ue=this.fragCurrent,ce=de.frag;ue&&"main"===de.id&&ce.sn===ue.sn&&ce.level===ue.level&&this.state===ne.PARSING&&(this.stats.tparsed=performance.now(),this.state=ne.PARSED,this._checkAppendedParsed())}},{key:"onAudioTrackSwitching",value:function(de){var ue=!!de.url,ce=de.id;if(!ue){if(this.mediaBuffer!==this.media){ae.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var fe=this.fragCurrent;fe.loader&&(ae.logger.log("switching to main audio track, cancel main fragment load"),fe.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=ne.IDLE}var ge=this.hls;ge.trigger(z.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),ge.trigger(z.default.AUDIO_TRACK_SWITCHED,{id:ce}),this.altAudio=!1}}},{key:"onAudioTrackSwitched",value:function(de){var ue=de.id,ce=!!this.hls.audioTracks[ue].url;if(ce){var fe=this.videoBuffer;fe&&this.mediaBuffer!==fe&&(ae.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=fe)}this.altAudio=ce,this.tick()}},{key:"onBufferCreated",value:function(de){var ue=de.tracks,ge=!1,ce,fe;for(var pe in ue){var me=ue[pe];"main"===me.id?(fe=pe,ce=me,"video"==pe&&(this.videoBuffer=ue[pe].buffer)):ge=!0}ge&&ce?(ae.logger.log("alternate track found, use "+fe+".buffered to schedule main fragment loading"),this.mediaBuffer=ce.buffer):this.mediaBuffer=this.media}},{key:"onBufferAppended",value:function(de){if("main"===de.parent){var ue=this.state;(ue===ne.PARSING||ue===ne.PARSED)&&(this.pendingBuffering=0<de.pending,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){var de=this;if(this.state===ne.PARSED&&(!this.appended||!this.pendingBuffering)){var ue=this.fragCurrent;ue&&function(){var ce=de.mediaBuffer?de.mediaBuffer:de.media;ae.logger.log("main buffered : "+ee.default.toString(ce.buffered));var fe=de._bufferedFrags.filter(function(pe){return V.default.isBuffered(ce,(pe.startPTS+pe.endPTS)/2)});fe.push(ue),de._bufferedFrags=fe.sort(function(pe,me){return pe.startPTS-me.startPTS}),de.fragPrevious=ue;var ge=de.stats;ge.tbuffered=performance.now(),de.fragLastKbps=Math.round(8*ge.total/(ge.tbuffered-ge.tfirst)),de.hls.trigger(z.default.FRAG_BUFFERED,{stats:ge,frag:ue,id:"main"}),de.state=ne.IDLE}(),this.tick()}}},{key:"onError",value:function(de){var ue=de.frag||this.fragCurrent;if(!(ue&&"main"!==ue.type)){var ce=this.media,fe=ce&&V.default.isBuffered(ce,ce.currentTime)&&V.default.isBuffered(ce,ce.currentTime+0.5);switch(de.details){case te.ErrorDetails.FRAG_LOAD_ERROR:case te.ErrorDetails.FRAG_LOAD_TIMEOUT:case te.ErrorDetails.KEY_LOAD_ERROR:case te.ErrorDetails.KEY_LOAD_TIMEOUT:if(!de.fatal){var ge=this.fragLoadError;ge?ge++:ge=1;var pe=this.config;if(ge<=pe.fragLoadingMaxRetry||fe||ue.autoLevel&&ue.level){this.fragLoadError=ge,ue.loadCounter=0;var me=Math.min(Math.pow(2,ge-1)*pe.fragLoadingRetryDelay,pe.fragLoadingMaxRetryTimeout);ae.logger.warn("mediaController: frag loading failed, retry in "+me+" ms"),this.retryDate=performance.now()+me,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.state=ne.FRAG_LOADING_WAITING_RETRY}else ae.logger.error("mediaController: "+de.details+" reaches max retry, redispatch as fatal ..."),de.fatal=!0,this.state=ne.ERROR}break;case te.ErrorDetails.FRAG_LOOP_LOADING_ERROR:de.fatal||(fe?(this._reduceMaxBufferLength(ue.duration),this.state=ne.IDLE):(!ue.autoLevel||0===ue.level)&&(de.fatal=!0,this.state=ne.ERROR));break;case te.ErrorDetails.LEVEL_LOAD_ERROR:case te.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==ne.ERROR&&(de.fatal?(this.state=ne.ERROR,ae.logger.warn("streamController: "+de.details+",switch to "+this.state+" state ...")):this.state===ne.WAITING_LEVEL&&(this.state=ne.IDLE));break;case te.ErrorDetails.BUFFER_FULL_ERROR:"main"===de.parent&&(this.state===ne.PARSING||this.state===ne.PARSED)&&(fe?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=ne.IDLE):(ae.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)));break;default:}}}},{key:"_reduceMaxBufferLength",value:function(de){var ue=this.config;ue.maxMaxBufferLength>=de&&(ue.maxMaxBufferLength/=2,ae.logger.warn("main:reduce max buffer length to "+ue.maxMaxBufferLength+"s"),this.fragLoadIdx+=2*ue.fragLoadingLoopThreshold)}},{key:"_checkBuffer",value:function(){var de=this.media;if(de&&de.readyState){var ue=de.currentTime,ce=this.mediaBuffer?this.mediaBuffer:de,fe=ce.buffered;if(!this.loadedmetadata&&fe.length){this.loadedmetadata=!0;var ge=de.seeking?ue:this.startPosition,pe=V.default.isBuffered(ce,ge);ue===ge&&pe||(ae.logger.log("target start position:"+ge),!pe&&(ge=fe.start(0),ae.logger.log("target start position not buffered, seek to buffered.start(0) "+ge)),ae.logger.log("adjust currentTime from "+ue+" to "+ge),de.currentTime=ge)}else if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var me=V.default.bufferInfo(de,ue,0),ye=!(de.paused||de.ended||0===de.buffered.length),he=0.5,ve=ue!==this.lastCurrentTime,be=this.config;if(ve)this.stallReported&&(ae.logger.warn("playback not stuck anymore @"+ue+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0;else if(ye){var Ee=performance.now(),ke=this.hls;if(!this.stalled)this.stalled=Ee,this.stallReported=!1;else{var Te=Ee-this.stalled,Re=me.len,Se=this.nudgeRetry||0;if(Re<=he&&Te>1e3*be.lowBufferWatchdogPeriod){this.stallReported||(this.stallReported=!0,ae.logger.warn("playback stalling in low buffer @"+ue),ke.trigger(z.default.ERROR,{type:te.ErrorTypes.MEDIA_ERROR,details:te.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:Re}));var Ae=me.nextStart,Le=Ae-ue;if(Ae&&Le<be.maxSeekHole&&0<Le){this.nudgeRetry=++Se;var De=Se*be.nudgeOffset;ae.logger.log("adjust currentTime from "+de.currentTime+" to next buffered @ "+Ae+" + nudge "+De),de.currentTime=Ae+De,this.stalled=void 0,ke.trigger(z.default.ERROR,{type:te.ErrorTypes.MEDIA_ERROR,details:te.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:Ae+De-ue})}}else if(Re>he&&Te>1e3*be.highBufferWatchdogPeriod)if(this.stallReported||(this.stallReported=!0,ae.logger.warn("playback stalling in high buffer @"+ue),ke.trigger(z.default.ERROR,{type:te.ErrorTypes.MEDIA_ERROR,details:te.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:Re})),this.stalled=void 0,this.nudgeRetry=++Se,Se<be.nudgeMaxRetry){var Pe=de.currentTime,Ie=Pe+Se*be.nudgeOffset;ae.logger.log("adjust currentTime from "+Pe+" to "+Ie),de.currentTime=Ie,ke.trigger(z.default.ERROR,{type:te.ErrorTypes.MEDIA_ERROR,details:te.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else ae.logger.error("still stuck in high buffer @"+ue+" after "+be.nudgeMaxRetry+", raise fatal error"),ke.trigger(z.default.ERROR,{type:te.ErrorTypes.MEDIA_ERROR,details:te.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}}}}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=ne.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()}},{key:"onBufferFlushed",value:function(){var de=this.mediaBuffer?this.mediaBuffer:this.media;this._bufferedFrags=this._bufferedFrags.filter(function(ue){return V.default.isBuffered(de,(ue.startPTS+ue.endPTS)/2)}),this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=ne.IDLE,this.fragPrevious=null}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"computeLivePosition",value:function(de,ue){var ce=void 0===this.config.liveSyncDuration?this.config.liveSyncDurationCount*ue.targetduration:this.config.liveSyncDuration;return de+Math.max(0,ue.totalduration-ce)}},{key:"state",set:function(de){if(this.state!==de){var ue=this.state;this._state=de,ae.logger.log("main stream:"+ue+"->"+de),this.hls.trigger(z.default.STREAM_STATE_TRANSITION,{previousState:ue,nextState:de})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var de=this.media;if(de){var ue=this.getBufferedFrag(de.currentTime);if(ue)return ue.level}return-1}},{key:"nextBufferedFrag",get:function(){var de=this.media;return de?this.followingBufferedFrag(this.getBufferedFrag(de.currentTime)):null}},{key:"nextLevel",get:function(){var de=this.nextBufferedFrag;return de?de.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(de){this._liveSyncPosition=de}}]),ie}(Q.default);C.default=oe},{24:24,30:30,31:31,32:32,34:34,35:35,45:45,50:50,51:51}],13:[function(I,O,C){"use strict";function F(Y){return Y&&Y.__esModule?Y:{default:Y}}function N(Y,z){if(!(Y instanceof z))throw new TypeError("Cannot call a class as a function")}function M(Y,z){if(!Y)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return z&&("object"==typeof z||"function"==typeof z)?z:Y}function B(Y,z){if("function"!=typeof z&&null!==z)throw new TypeError("Super expression must either be null or a function, not "+typeof z);Y.prototype=Object.create(z&&z.prototype,{constructor:{value:Y,enumerable:!1,writable:!0,configurable:!0}}),z&&(Object.setPrototypeOf?Object.setPrototypeOf(Y,z):Y.__proto__=z)}Object.defineProperty(C,"__esModule",{value:!0});var U=function(){function Y(z,X){for(var Q=0,Z;Q<X.length;Q++)Z=X[Q],Z.enumerable=Z.enumerable||!1,Z.configurable=!0,"value"in Z&&(Z.writable=!0),Object.defineProperty(z,Z.key,Z)}return function(z,X,Q){return X&&Y(z.prototype,X),Q&&Y(z,Q),z}}(),G=I(32),K=F(G),W=I(31),V=F(W),H=I(50),q=function(Y){function z(X){N(this,z);var Q=M(this,(z.__proto__||Object.getPrototypeOf(z)).call(this,X,K.default.ERROR,K.default.SUBTITLE_TRACKS_UPDATED,K.default.SUBTITLE_TRACK_SWITCH,K.default.SUBTITLE_TRACK_LOADED,K.default.SUBTITLE_FRAG_PROCESSED));return Q.config=X.config,Q.vttFragSNsProcessed={},Q.vttFragQueues=void 0,Q.currentlyProcessing=null,Q.currentTrackId=-1,Q}return B(z,Y),U(z,[{key:"destroy",value:function(){V.default.prototype.destroy.call(this)}},{key:"clearVttFragQueues",value:function(){var Q=this;this.vttFragQueues={},this.tracks.forEach(function(Z){Q.vttFragQueues[Z.id]=[]})}},{key:"nextFrag",value:function(){if(null===this.currentlyProcessing&&-1<this.currentTrackId&&this.vttFragQueues[this.currentTrackId].length){var Q=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift();this.hls.trigger(K.default.FRAG_LOADING,{frag:Q})}}},{key:"onSubtitleFragProcessed",value:function(Q){Q.success&&this.vttFragSNsProcessed[Q.frag.trackId].push(Q.frag.sn),this.currentlyProcessing=null,this.nextFrag()}},{key:"onError",value:function(Q){var Z=Q.frag;Z&&"subtitle"!==Z.type||this.currentlyProcessing&&(this.currentlyProcessing=null,this.nextFrag())}},{key:"onSubtitleTracksUpdated",value:function(Q){var Z=this;H.logger.log("subtitle tracks updated"),this.tracks=Q.subtitleTracks,this.clearVttFragQueues(),this.vttFragSNsProcessed={},this.tracks.forEach(function(J){Z.vttFragSNsProcessed[J.id]=[]})}},{key:"onSubtitleTrackSwitch",value:function(Q){this.currentTrackId=Q.id,this.clearVttFragQueues()}},{key:"onSubtitleTrackLoaded",value:function(Q){var Z=this.vttFragSNsProcessed[Q.id],J=this.vttFragQueues[Q.id],$=this.currentlyProcessing?this.currentlyProcessing.sn:-1,ee=function(ne){return-1<Z.indexOf(ne.sn)},te=function(ne){return J.some(function(oe){return oe.sn===ne.sn})};Q.details.fragments.forEach(function(ae){ee(ae)||ae.sn===$||te(ae)||(ae.trackId=Q.id,J.push(ae))}),this.nextFrag()}}]),z}(V.default);C.default=q},{31:31,32:32,50:50}],14:[function(I,O,C){"use strict";function F(Y){return Y&&Y.__esModule?Y:{default:Y}}function N(Y,z){if(!(Y instanceof z))throw new TypeError("Cannot call a class as a function")}function M(Y,z){if(!Y)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return z&&("object"==typeof z||"function"==typeof z)?z:Y}function B(Y,z){if("function"!=typeof z&&null!==z)throw new TypeError("Super expression must either be null or a function, not "+typeof z);Y.prototype=Object.create(z&&z.prototype,{constructor:{value:Y,enumerable:!1,writable:!0,configurable:!0}}),z&&(Object.setPrototypeOf?Object.setPrototypeOf(Y,z):Y.__proto__=z)}Object.defineProperty(C,"__esModule",{value:!0});var U=function(){function Y(z,X){for(var Q=0,Z;Q<X.length;Q++)Z=X[Q],Z.enumerable=Z.enumerable||!1,Z.configurable=!0,"value"in Z&&(Z.writable=!0),Object.defineProperty(z,Z.key,Z)}return function(z,X,Q){return X&&Y(z.prototype,X),Q&&Y(z,Q),z}}(),G=I(32),K=F(G),W=I(31),V=F(W),H=I(50),q=function(Y){function z(X){N(this,z);var Q=M(this,(z.__proto__||Object.getPrototypeOf(z)).call(this,X,K.default.MEDIA_ATTACHED,K.default.MEDIA_DETACHING,K.default.MANIFEST_LOADING,K.default.MANIFEST_LOADED,K.default.SUBTITLE_TRACK_LOADED));return Q.tracks=[],Q.trackId=-1,Q.media=void 0,Q}return B(z,Y),U(z,[{key:"destroy",value:function(){V.default.prototype.destroy.call(this)}},{key:"onMediaAttached",value:function(Q){var Z=this;this.media=Q.media,this.media&&this.media.textTracks.addEventListener("change",function(){if(Z.media){for(var J=-1,$=Z.media.textTracks,ee=0;ee<$.length;ee++)"showing"===$[ee].mode&&(J=ee);Z.subtitleTrack=J}})}},{key:"onMediaDetaching",value:function(){this.media=void 0}},{key:"onManifestLoading",value:function(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function(Q){var Z=this,J=Q.subtitles||[],$=!1;this.tracks=J,this.trackId=-1,this.hls.trigger(K.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:J}),J.forEach(function(ee){ee.default&&(Z.subtitleTrack=ee.id,$=!0)})}},{key:"onTick",value:function(){var Q=this.trackId,Z=this.tracks[Q];if(Z){var J=Z.details;(void 0===J||!0===J.live)&&(H.logger.log("(re)loading playlist for subtitle track "+Q),this.hls.trigger(K.default.SUBTITLE_TRACK_LOADING,{url:Z.url,id:Q}))}}},{key:"onSubtitleTrackLoaded",value:function(Q){var Z=this;Q.id<this.tracks.length&&(H.logger.log("subtitle track "+Q.id+" loaded"),this.tracks[Q.id].details=Q.details,Q.details.live&&!this.timer&&(this.timer=setInterval(function(){Z.onTick()},1e3*Q.details.targetduration,this)),!Q.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))}},{key:"setSubtitleTrackInternal",value:function(Q){if(0<=Q&&Q<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=Q,H.logger.log("switching to subtitle track "+Q);var Z=this.tracks[Q];this.hls.trigger(K.default.SUBTITLE_TRACK_SWITCH,{id:Q});var J=Z.details;(void 0===J||!0===J.live)&&(H.logger.log("(re)loading playlist for subtitle track "+Q),this.hls.trigger(K.default.SUBTITLE_TRACK_LOADING,{url:Z.url,id:Q}))}}},{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(Q){this.trackId!==Q&&this.setSubtitleTrackInternal(Q)}}]),z}(V.default);C.default=q},{31:31,32:32,50:50}],15:[function(I,O,C){"use strict";function F(te){return te&&te.__esModule?te:{default:te}}function N(te,ae){if(!(te instanceof ae))throw new TypeError("Cannot call a class as a function")}function M(te,ae){if(!te)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ae&&("object"==typeof ae||"function"==typeof ae)?ae:te}function B(te,ae){if("function"!=typeof ae&&null!==ae)throw new TypeError("Super expression must either be null or a function, not "+typeof ae);te.prototype=Object.create(ae&&ae.prototype,{constructor:{value:te,enumerable:!1,writable:!0,configurable:!0}}),ae&&(Object.setPrototypeOf?Object.setPrototypeOf(te,ae):te.__proto__=ae)}function U(te){if(te&&te.cues)for(;0<te.cues.length;)te.removeCue(te.cues[0])}function G(te,ae){return te&&te.label===ae.name&&!(te.textTrack1||te.textTrack2)}function K(te,ae,ne,oe){return Math.min(ae,oe)-Math.max(te,ne)}Object.defineProperty(C,"__esModule",{value:!0});var W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(te){return typeof te}:function(te){return te&&"function"==typeof Symbol&&te.constructor===Symbol&&te!==Symbol.prototype?"symbol":typeof te},V=function(){function te(ae,ne){for(var oe=0,le;oe<ne.length;oe++)le=ne[oe],le.enumerable=le.enumerable||!1,le.configurable=!0,"value"in le&&(le.writable=!0),Object.defineProperty(ae,le.key,le)}return function(ae,ne,oe){return ne&&te(ae.prototype,ne),oe&&te(ae,oe),ae}}(),H=I(32),q=F(H),Y=I(31),z=F(Y),X=I(46),Q=F(X),Z=I(54),J=F(Z),$=I(50),ee=function(te){function ae(ne){N(this,ae);var oe=M(this,(ae.__proto__||Object.getPrototypeOf(ae)).call(this,ne,q.default.MEDIA_ATTACHING,q.default.MEDIA_DETACHING,q.default.FRAG_PARSING_USERDATA,q.default.MANIFEST_LOADING,q.default.MANIFEST_LOADED,q.default.FRAG_LOADED,q.default.LEVEL_SWITCHING,q.default.INIT_PTS_FOUND));if(oe.hls=ne,oe.config=ne.config,oe.enabled=!0,oe.Cues=ne.config.cueHandler,oe.textTracks=[],oe.tracks=[],oe.unparsedVttFrags=[],oe.initPTS=void 0,oe.cueRanges=[],oe.config.enableCEA708Captions){var le=oe,ie=function(ce,fe){var ge=null;try{ge=new window.Event("addtrack")}catch(pe){ge=document.createEvent("Event"),ge.initEvent("addtrack",!1,!1)}ge.track=ce,fe.dispatchEvent(ge)},se={newCue:function(ce,fe,ge){if(!le.textTrack1){var pe=le.getExistingTrack("1");if(!pe){var me=le.createTextTrack("captions",le.config.captionsTextTrack1Label,le.config.captionsTextTrack1LanguageCode);me&&(me.textTrack1=!0,le.textTrack1=me)}else le.textTrack1=pe,U(le.textTrack1),ie(le.textTrack1,le.media)}le.addCues("textTrack1",ce,fe,ge)}},de={newCue:function(ce,fe,ge){if(!le.textTrack2){var pe=le.getExistingTrack("2");if(!pe){var me=le.createTextTrack("captions",le.config.captionsTextTrack2Label,le.config.captionsTextTrack1LanguageCode);me&&(me.textTrack2=!0,le.textTrack2=me)}else le.textTrack2=pe,U(le.textTrack2),ie(le.textTrack2,le.media)}le.addCues("textTrack2",ce,fe,ge)}};oe.cea608Parser=new Q.default(0,se,de)}return oe}return B(ae,te),V(ae,[{key:"addCues",value:function(oe,le,ie,se){for(var de=this.cueRanges,ue=!1,ce=de.length;ce--;){var fe=de[ce],ge=K(fe[0],fe[1],le,ie);if(0<=ge&&(fe[0]=Math.min(fe[0],le),fe[1]=Math.max(fe[1],ie),ue=!0,0.5<ge/(ie-le)))return}ue||de.push([le,ie]),this.Cues.newCue(this[oe],le,ie,se)}},{key:"onInitPtsFound",value:function(oe){var le=this;"undefined"==typeof this.initPTS&&(this.initPTS=oe.initPTS),this.unparsedVttFrags.length&&(this.unparsedVttFrags.forEach(function(ie){le.onFragLoaded(ie)}),this.unparsedVttFrags=[])}},{key:"getExistingTrack",value:function(oe){var le=this.media;if(le)for(var ie=0;ie<le.textTracks.length;ie++){var se=le.textTracks[ie];if(!0===se["textTrack"+oe])return se}return null}},{key:"createTextTrack",value:function(oe,le,ie){var se=this.media;if(se)return se.addTextTrack(oe,le,ie)}},{key:"destroy",value:function(){z.default.prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(oe){this.media=oe.media}},{key:"onMediaDetaching",value:function(){U(this.textTrack1),U(this.textTrack2)}},{key:"onManifestLoading",value:function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0};var oe=this.media;if(oe){var le=oe.textTracks;if(le)for(var ie=0;ie<le.length;ie++)U(le[ie])}}},{key:"onManifestLoaded",value:function(oe){var le=this;this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=void 0,this.cueRanges=[],this.config.enableWebVTT&&function(){le.tracks=oe.subtitles||[];var ie=le.media?le.media.textTracks:[];le.tracks.forEach(function(se,de){var ce=ie[de],ue;ue=G(ce,se)?ce:le.createTextTrack("subtitles",se.name,se.lang),ue.mode=se.default?"showing":"hidden",le.textTracks.push(ue)})}()}},{key:"onLevelSwitching",value:function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions}},{key:"onFragLoaded",value:function(oe){var le=this,ie=oe.frag,se=oe.payload;if("main"===ie.type){var de=ie.sn;de!==this.lastSn+1&&this.cea608Parser.reset(),this.lastSn=de}else if("subtitle"===ie.type)if(se.byteLength){var ue=function(){if("undefined"==typeof le.initPTS)return le.unparsedVttFrags.push(oe),{v:void 0};var ce=le.vttCCs;ce[ie.cc]||(ce[ie.cc]={start:ie.start,prevCC:le.prevCC,new:!0},le.prevCC=ie.cc);var fe=le.textTracks,ge=le.hls;J.default.parse(se,le.initPTS,ce,ie.cc,function(pe){pe.forEach(function(me){fe[ie.trackId].addCue(me)}),ge.trigger(q.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:ie})},function(pe){$.logger.log("Failed to parse VTT cue: "+pe),ge.trigger(q.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:ie})})}();if("object"===("undefined"==typeof ue?"undefined":W(ue)))return ue.v}else this.hls.trigger(q.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:ie})}},{key:"onFragParsingUserdata",value:function(oe){if(this.enabled&&this.config.enableCEA708Captions)for(var le=0,ie;le<oe.samples.length;le++)ie=this.extractCea608Data(oe.samples[le].bytes),this.cea608Parser.addData(oe.samples[le].pts,ie)}},{key:"extractCea608Data",value:function(oe){for(var le=31&oe[0],ie=2,ge=[],pe=0,se,de,ue,ce,fe;pe<le;pe++)(se=oe[ie++],de=127&oe[ie++],ue=127&oe[ie++],ce=0!=(4&se),fe=3&se,0!==de||0!==ue)&&ce&&0===fe&&(ge.push(de),ge.push(ue));return ge}}]),ae}(z.default);C.default=ee},{31:31,32:32,46:46,50:50,54:54}],16:[function(I,O,C){"use strict";function F(B,U){if(!(B instanceof U))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(C,"__esModule",{value:!0});var N=function(){function B(U,G){for(var K=0,W;K<G.length;K++)W=G[K],W.enumerable=W.enumerable||!1,W.configurable=!0,"value"in W&&(W.writable=!0),Object.defineProperty(U,W.key,W)}return function(U,G,K){return G&&B(U.prototype,G),K&&B(U,K),U}}(),M=function(){function B(U,G){F(this,B),this.subtle=U,this.aesIV=G}return N(B,[{key:"decrypt",value:function(G,K){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},K,G)}}]),B}();C.default=M},{}],17:[function(I,O,C){"use strict";function F(B,U){if(!(B instanceof U))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(C,"__esModule",{value:!0});var N=function(){function B(U,G){for(var K=0,W;K<G.length;K++)W=G[K],W.enumerable=W.enumerable||!1,W.configurable=!0,"value"in W&&(W.writable=!0),Object.defineProperty(U,W.key,W)}return function(U,G,K){return G&&B(U.prototype,G),K&&B(U,K),U}}(),M=function(){function B(){F(this,B),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return N(B,[{key:"uint8ArrayToUint32Array_",value:function(G){for(var K=new DataView(G),W=new Uint32Array(4),V=0;4>V;V++)W[V]=K.getUint32(4*V);return W}},{key:"initTable",value:function(){var G=this.sBox,K=this.invSBox,W=this.subMix,V=W[0],H=W[1],q=W[2],Y=W[3],z=this.invSubMix,X=z[0],Q=z[1],Z=z[2],J=z[3],$=new Uint32Array(256),ee=0,te=0,ae=0;for(ae=0;256>ae;ae++)$[ae]=128>ae?ae<<1:283^ae<<1;for(ae=0;256>ae;ae++){var ne=te^te<<1^te<<2^te<<3^te<<4;ne=99^(ne>>>8^255&ne),G[ee]=ne,K[ne]=ee;var oe=$[ee],le=$[oe],ie=$[le],se=257*$[ne]^16843008*ne;V[ee]=se<<24|se>>>8,H[ee]=se<<16|se>>>16,q[ee]=se<<8|se>>>24,Y[ee]=se,se=16843009*ie^65537*le^257*oe^16843008*ee,X[ne]=se<<24|se>>>8,Q[ne]=se<<16|se>>>16,Z[ne]=se<<8|se>>>24,J[ne]=se,ee?(ee=oe^$[$[$[ie^oe]]],te^=$[$[te]]):ee=te=1}}},{key:"expandKey",value:function(G){for(var K=this.uint8ArrayToUint32Array_(G),W=!0,V=0;V<K.length&&W;)W=K[V]===this.key[V],V++;if(!W){this.key=K;var H=this.keySize=K.length;if(4!==H&&6!==H&&8!==H)throw new Error("Invalid aes key size="+H);var q=this.ksRows=4*(H+6+1),Y=void 0,z=void 0,X=this.keySchedule=new Uint32Array(q),Q=this.invKeySchedule=new Uint32Array(q),Z=this.sBox,J=this.rcon,$=this.invSubMix,ee=$[0],te=$[1],ae=$[2],ne=$[3],oe,le;for(Y=0;Y<q;Y++){if(Y<H){oe=X[Y]=K[Y];continue}le=oe,0==Y%H?(le=le<<8|le>>>24,le=Z[le>>>24]<<24|Z[255&le>>>16]<<16|Z[255&le>>>8]<<8|Z[255&le],le^=J[0|Y/H]<<24):6<H&&4==Y%H&&(le=Z[le>>>24]<<24|Z[255&le>>>16]<<16|Z[255&le>>>8]<<8|Z[255&le]),X[Y]=oe=(X[Y-H]^le)>>>0}for(z=0;z<q;z++)Y=q-z,le=3&z?X[Y]:X[Y-4],Q[z]=4>z||4>=Y?le:ee[Z[le>>>24]]^te[Z[255&le>>>16]]^ae[Z[255&le>>>8]]^ne[Z[255&le]],Q[z]>>>=0}}},{key:"networkToHostOrderSwap",value:function(G){return G<<24|(65280&G)<<8|(16711680&G)>>8|G>>>24}},{key:"decrypt",value:function(G,K,W){for(var V=this.keySize+6,H=this.invKeySchedule,q=this.invSBox,Y=this.invSubMix,z=Y[0],X=Y[1],Q=Y[2],Z=Y[3],J=this.uint8ArrayToUint32Array_(W),$=J[0],ee=J[1],te=J[2],ae=J[3],ne=new Int32Array(G),oe=new Int32Array(ne.length),Ee=this.networkToHostOrderSwap,le,ie,se,de,ue,ce,fe,ge,pe,me,ye,he,ve,be;K<ne.length;){for(pe=Ee(ne[K]),me=Ee(ne[K+1]),ye=Ee(ne[K+2]),he=Ee(ne[K+3]),ue=pe^H[0],ce=he^H[1],fe=ye^H[2],ge=me^H[3],ve=4,be=1;be<V;be++)le=z[ue>>>24]^X[255&ce>>16]^Q[255&fe>>8]^Z[255&ge]^H[ve],ie=z[ce>>>24]^X[255&fe>>16]^Q[255&ge>>8]^Z[255&ue]^H[ve+1],se=z[fe>>>24]^X[255&ge>>16]^Q[255&ue>>8]^Z[255&ce]^H[ve+2],de=z[ge>>>24]^X[255&ue>>16]^Q[255&ce>>8]^Z[255&fe]^H[ve+3],ue=le,ce=ie,fe=se,ge=de,ve+=4;le=q[ue>>>24]<<24^q[255&ce>>16]<<16^q[255&fe>>8]<<8^q[255&ge]^H[ve],ie=q[ce>>>24]<<24^q[255&fe>>16]<<16^q[255&ge>>8]<<8^q[255&ue]^H[ve+1],se=q[fe>>>24]<<24^q[255&ge>>16]<<16^q[255&ue>>8]<<8^q[255&ce]^H[ve+2],de=q[ge>>>24]<<24^q[255&ue>>16]<<16^q[255&ce>>8]<<8^q[255&fe]^H[ve+3],ve+=3,oe[K]=Ee(le^$),oe[K+1]=Ee(de^ee),oe[K+2]=Ee(se^te),oe[K+3]=Ee(ie^ae),$=pe,ee=me,te=ye,ae=he,K+=4}return oe.buffer}},{key:"destroy",value:function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0}}]),B}();C.default=M},{}],18:[function(I,O,C){"use strict";function F(z){return z&&z.__esModule?z:{default:z}}function N(z,X){if(!(z instanceof X))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(C,"__esModule",{value:!0});var M=function(){function z(X,Q){for(var Z=0,J;Z<Q.length;Z++)J=Q[Z],J.enumerable=J.enumerable||!1,J.configurable=!0,"value"in J&&(J.writable=!0),Object.defineProperty(X,J.key,J)}return function(X,Q,Z){return Q&&z(X.prototype,Q),Z&&z(X,Z),X}}(),B=I(16),U=F(B),G=I(19),K=F(G),W=I(17),V=F(W),H=I(30),q=I(50),Y=function(){function z(X,Q){N(this,z),this.observer=X,this.config=Q,this.logEnabled=!0;try{var Z=crypto?crypto:self.crypto;this.subtle=Z.subtle||Z.webkitSubtle}catch(J){}this.disableWebCrypto=!this.subtle}return M(z,[{key:"isSync",value:function(){return this.disableWebCrypto&&this.config.enableSoftwareAES}},{key:"decrypt",value:function(Q,Z,J,$){var ee=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(q.logger.log("JS AES decrypt"),this.logEnabled=!1);var te=this.decryptor;te||(this.decryptor=te=new V.default),te.expandKey(Z),$(te.decrypt(Q,0,J))}else(function(){ee.logEnabled&&(q.logger.log("WebCrypto AES decrypt"),ee.logEnabled=!1);var ae=ee.subtle;ee.key!==Z&&(ee.key=Z,ee.fastAesKey=new K.default(ae,Z)),ee.fastAesKey.expandKey().then(function(ne){var oe=new U.default(ae,J);oe.decrypt(Q,ne).catch(function(le){ee.onWebCryptoError(le,Q,Z,J,$)}).then(function(le){$(le)})}).catch(function(ne){ee.onWebCryptoError(ne,Q,Z,J,$)})})()}},{key:"onWebCryptoError",value:function(Q,Z,J,$,ee){this.config.enableSoftwareAES?(q.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(Z,J,$,ee)):(q.logger.error("decrypting error : "+Q.message),this.observer.trigger(Event.ERROR,{type:H.ErrorTypes.MEDIA_ERROR,details:H.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:Q.message}))}},{key:"destroy",value:function(){var Q=this.decryptor;Q&&(Q.destroy(),this.decryptor=void 0)}}]),z}();C.default=Y},{16:16,17:17,19:19,30:30,50:50}],19:[function(I,O,C){"use strict";function F(B,U){if(!(B instanceof U))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(C,"__esModule",{value:!0});var N=function(){function B(U,G){for(var K=0,W;K<G.length;K++)W=G[K],W.enumerable=W.enumerable||!1,W.configurable=!0,"value"in W&&(W.writable=!0),Object.defineProperty(U,W.key,W)}return function(U,G,K){return G&&B(U.prototype,G),K&&B(U,K),U}}(),M=function(){function B(U,G){F(this,B),this.subtle=U,this.key=G}return N(B,[{key:"expandKey",value:function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}]),B}();C.default=M},{}],20:[function(I,O,C){"use strict";function F(H){return H&&H.__esModule?H:{default:H}}function N(H,q){if(!(H instanceof q))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(C,"__esModule",{value:!0});var M=function(){function H(q,Y){for(var z=0,X;z<Y.length;z++)X=Y[z],X.enumerable=X.enumerable||!1,X.configurable=!0,"value"in X&&(X.writable=!0),Object.defineProperty(q,X.key,X)}return function(q,Y,z){return Y&&H(q.prototype,Y),z&&H(q,z),q}}(),B=I(21),U=F(B),G=I(50),K=I(26),W=F(K),V=function(){function H(q,Y,z){N(this,H),this.observer=q,this.config=z,this.remuxer=Y}return M(H,[{key:"resetInitSegment",value:function(Y,z,X,Q){this._aacTrack={container:"audio/adts",type:"audio",id:-1,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:z,duration:Q,inputTimeScale:9e4}}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(Y,z,X,Q){var J=new W.default(Y),$=90*J.timeStamp,Z,ee,te,ae,ne,oe,le,ie,se,de;for(Z=this._aacTrack,oe=J.length,se=Y.length;oe<se-1&&(255!==Y[oe]||240!=(240&Y[oe+1]));oe++);for(Z.samplerate||(ee=U.default.getAudioConfig(this.observer,Y,oe,Z.manifestCodec),Z.config=ee.config,Z.samplerate=ee.samplerate,Z.channelCount=ee.channelCount,Z.codec=ee.codec,G.logger.log("parsed codec:"+Z.codec+",rate:"+ee.samplerate+",nb channel:"+ee.channelCount)),ne=0,ae=92160000/Z.samplerate;oe+5<se&&(le=1&Y[oe+1]?7:9,te=(3&Y[oe+3])<<11|Y[oe+4]<<3|(224&Y[oe+5])>>>5,te-=le,0<te&&oe+le+te<=se);)for(ie=$+ne*ae,de={unit:Y.subarray(oe+le,oe+le+te),pts:ie,dts:ie},Z.samples.push(de),Z.len+=te,oe+=te+le,ne++;oe<se-1&&(255!==Y[oe]||240!=(240&Y[oe+1]));oe++);this.remuxer.remux(Z,{samples:[]},{samples:[{pts:$,dts:$,unit:J.payload}]},{samples:[]},z,X,Q)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(Y){var z=new W.default(Y),X,Q;if(z.hasTimeStamp)for(X=z.length,Q=Y.length;X<Q-1;X++)if(255===Y[X]&&240==(240&Y[X+1]))return!0;return!1}}]),H}();C.default=V},{21:21,26:26,50:50}],21:[function(I,O){"use strict";var F=I(50),N=I(30);O.exports={getAudioConfig:function(U,G,K,W){var X=navigator.userAgent.toLowerCase(),Z=[96000,88200,64000,48000,44100,32000,24000,22050,16000,12000,11025,8000,7350],V,H,q,Y,z;return(V=((192&G[K+2])>>>6)+1,H=(60&G[K+2])>>>2,H>Z.length-1)?void U.trigger(Event.ERROR,{type:N.ErrorTypes.MEDIA_ERROR,details:N.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+H}):(Y=(1&G[K+2])<<2,Y|=(192&G[K+3])>>>6,F.logger.log("manifest codec:"+W+",ADTS data:type:"+V+",sampleingIndex:"+H+"["+Z[H]+"Hz],channelConfig:"+Y),/firefox/i.test(X)?6<=H?(V=5,z=[,,,,],q=H-3):(V=2,z=[,,],q=H):-1===X.indexOf("android")?(V=5,z=[,,,,],W&&(-1!==W.indexOf("mp4a.40.29")||-1!==W.indexOf("mp4a.40.5"))||!W&&6<=H?q=H-3:((W&&-1!==W.indexOf("mp4a.40.2")&&6<=H&&1===Y||!W&&1===Y)&&(V=2,z=[,,]),q=H)):(V=2,z=[,,],q=H),z[0]=V<<3,z[0]|=(14&H)>>1,z[1]|=(1&H)<<7,z[1]|=Y<<3,5===V&&(z[1]|=(14&q)>>1,z[2]=(1&q)<<7,z[2]|=8,z[3]=0),{config:z,samplerate:Z[H],channelCount:Y,codec:"mp4a.40."+V,manifestCodec:W})}}},{30:30,50:50}],22:[function(I,O,C){"use strict";function F(te){return te&&te.__esModule?te:{default:te}}function N(te,ae){if(!(te instanceof ae))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(C,"__esModule",{value:!0});var M=function(){function te(ae,ne){for(var oe=0,le;oe<ne.length;oe++)le=ne[oe],le.enumerable=le.enumerable||!1,le.configurable=!0,"value"in le&&(le.writable=!0),Object.defineProperty(ae,le.key,le)}return function(ae,ne,oe){return ne&&te(ae.prototype,ne),oe&&te(ae,oe),ae}}(),B=I(32),U=F(B),G=I(30),K=I(18),W=F(K),V=I(20),H=F(V),q=I(27),Y=F(q),z=I(29),X=F(z),Q=I(42),Z=F(Q),J=I(43),$=F(J),ee=function(){function te(ae,ne,oe,le){N(this,te),this.observer=ae,this.typeSupported=ne,this.config=oe,this.vendor=le}return M(te,[{key:"destroy",value:function(){var ne=this.demuxer;ne&&ne.destroy()}},{key:"push",value:function(ne,oe,le,ie,se,de,ue,ce,fe,ge,pe,me){if(0<ne.byteLength&&null!=oe&&null!=oe.key&&"AES-128"===oe.method){var ye=this.decrypter;null==ye&&(ye=this.decrypter=new W.default(this.observer,this.config));var he=this,ve;try{ve=performance.now()}catch(be){ve=Date.now()}ye.decrypt(ne,oe.key.buffer,oe.iv.buffer,function(be){var Ee;try{Ee=performance.now()}catch(ke){Ee=Date.now()}he.observer.trigger(U.default.FRAG_DECRYPTED,{stats:{tstart:ve,tdecrypt:Ee}}),he.pushDecrypted(new Uint8Array(be),oe,new Uint8Array(le),ie,se,de,ue,ce,fe,ge,pe,me)})}else this.pushDecrypted(new Uint8Array(ne),oe,new Uint8Array(le),ie,se,de,ue,ce,fe,ge,pe,me)}},{key:"pushDecrypted",value:function(ne,oe,le,ie,se,de,ue,ce,fe,ge,pe,me){var ye=this.demuxer;if(!ye||ue&&!this.probe(ne)){var he=this.observer,ve=this.typeSupported,be=this.config,Ee=[{demux:X.default,remux:Z.default},{demux:H.default,remux:Z.default},{demux:Y.default,remux:$.default}];for(var ke in Ee){var Te=Ee[ke],Re=Te.demux.probe;if(Re(ne)){var Se=this.remuxer=new Te.remux(he,be,ve,this.vendor);ye=new Te.demux(he,Se,be,ve),this.probe=Re;break}}if(!ye)return void he.trigger(U.default.ERROR,{type:G.ErrorTypes.MEDIA_ERROR,details:G.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=ye}var Ae=this.remuxer;(ue||ce)&&(ye.resetInitSegment(le,ie,se,ge),Ae.resetInitSegment()),ue&&(ye.resetTimeStamp(),Ae.resetTimeStamp(me)),"function"==typeof ye.setDecryptData&&ye.setDecryptData(oe),ye.append(ne,de,fe,pe)}}]),te}();C.default=ee},{18:18,20:20,27:27,29:29,30:30,32:32,42:42,43:43}],23:[function(I,O,C){"use strict";function F(H){return H&&H.__esModule?H:{default:H}}Object.defineProperty(C,"__esModule",{value:!0});var N=I(22),M=F(N),B=I(32),U=F(B),G=I(50),K=I(1),W=F(K);C.default=function(q){var Y=new W.default;Y.trigger=function(Q){for(var Z=arguments.length,J=Array(1<Z?Z-1:0),$=1;$<Z;$++)J[$-1]=arguments[$];Y.emit.apply(Y,[Q,Q].concat(J))},Y.off=function(Q){for(var Z=arguments.length,J=Array(1<Z?Z-1:0),$=1;$<Z;$++)J[$-1]=arguments[$];Y.removeListener.apply(Y,[Q].concat(J))};var z=function(Q,Z){q.postMessage({event:Q,data:Z})};q.addEventListener("message",function(X){var Q=X.data;switch(Q.cmd){case"init":var Z=JSON.parse(Q.config);q.demuxer=new M.default(Y,Q.typeSupported,Z,Q.vendor);try{(0,G.enableLogs)(!0===Z.debug)}catch(J){console.warn("demuxerWorker: unable to enable logs")}z("init",null);break;case"demux":q.demuxer.push(Q.data,Q.decryptdata,Q.initSegment,Q.audioCodec,Q.videoCodec,Q.timeOffset,Q.discontinuity,Q.trackSwitch,Q.contiguous,Q.duration,Q.accurateTimeOffset,Q.defaultInitPTS);break;default:}}),Y.on(U.default.FRAG_DECRYPTED,z),Y.on(U.default.FRAG_PARSING_INIT_SEGMENT,z),Y.on(U.default.FRAG_PARSED,z),Y.on(U.default.ERROR,z),Y.on(U.default.FRAG_PARSING_METADATA,z),Y.on(U.default.FRAG_PARSING_USERDATA,z),Y.on(U.default.INIT_PTS_FOUND,z),Y.on(U.default.FRAG_PARSING_DATA,function(X,Q){var Z=[],J={event:X,data:Q};Q.data1&&(J.data1=Q.data1.buffer,Z.push(Q.data1.buffer),delete Q.data1),Q.data2&&(J.data2=Q.data2.buffer,Z.push(Q.data2.buffer),delete Q.data2),q.postMessage(J,Z)})}},{1:1,22:22,32:32,50:50}],24:[function(I,O,C){"use strict";function F(Q){return Q&&Q.__esModule?Q:{default:Q}}function N(Q,Z){if(!(Q instanceof Z))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(C,"__esModule",{value:!0});var M=function(){function Q(Z,J){for(var $=0,ee;$<J.length;$++)ee=J[$],ee.enumerable=ee.enumerable||!1,ee.configurable=!0,"value"in ee&&(ee.writable=!0),Object.defineProperty(Z,ee.key,ee)}return function(Z,J,$){return J&&Q(Z.prototype,J),$&&Q(Z,$),Z}}(),B=I(32),U=F(B),G=I(22),K=F(G),W=I(23),V=F(W),H=I(50),q=I(30),Y=I(1),z=F(Y),X=function(){function Q(Z,J){N(this,Q),this.hls=Z,this.id=J;var $=this.observer=new z.default,ee=Z.config;$.trigger=function(se){for(var de=arguments.length,ue=Array(1<de?de-1:0),ce=1;ce<de;ce++)ue[ce-1]=arguments[ce];$.emit.apply($,[se,se].concat(ue))},$.off=function(se){for(var de=arguments.length,ue=Array(1<de?de-1:0),ce=1;ce<de;ce++)ue[ce-1]=arguments[ce];$.removeListener.apply($,[se].concat(ue))};var te=function(ie,se){se=se||{},se.frag=this.frag,se.id=this.id,Z.trigger(ie,se)}.bind(this);$.on(U.default.FRAG_DECRYPTED,te),$.on(U.default.FRAG_PARSING_INIT_SEGMENT,te),$.on(U.default.FRAG_PARSING_DATA,te),$.on(U.default.FRAG_PARSED,te),$.on(U.default.ERROR,te),$.on(U.default.FRAG_PARSING_METADATA,te),$.on(U.default.FRAG_PARSING_USERDATA,te),$.on(U.default.INIT_PTS_FOUND,te);var ae={mp4:MediaSource.isTypeSupported("video/mp4"),mpeg:MediaSource.isTypeSupported("audio/mpeg"),mp3:MediaSource.isTypeSupported("audio/mp4; codecs=\"mp3\"")},ne=navigator.vendor;if(ee.enableWorker&&"undefined"!=typeof Worker){H.logger.log("demuxing in webworker");var oe;try{var le=I(3);oe=this.w=le(V.default),this.onwmsg=this.onWorkerMessage.bind(this),oe.addEventListener("message",this.onwmsg),oe.onerror=function(ie){Z.trigger(U.default.ERROR,{type:q.ErrorTypes.OTHER_ERROR,details:q.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:ie.message+" ("+ie.filename+":"+ie.lineno+")"}})},oe.postMessage({cmd:"init",typeSupported:ae,vendor:ne,id:J,config:JSON.stringify(ee)})}catch(ie){H.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),oe&&URL.revokeObjectURL(oe.objectURL),this.demuxer=new K.default($,ae,ee,ne),this.w=void 0}}else this.demuxer=new K.default($,ae,ee,ne)}return M(Q,[{key:"destroy",value:function(){var J=this.w;if(J)J.removeEventListener("message",this.onwmsg),J.terminate(),this.w=null;else{var $=this.demuxer;$&&($.destroy(),this.demuxer=null)}var ee=this.observer;ee&&(ee.removeAllListeners(),this.observer=null)}},{key:"push",value:function(J,$,ee,te,ae,ne,oe,le){var ie=this.w,se=isNaN(ae.startDTS)?ae.start:ae.startDTS,de=ae.decryptdata,ue=this.frag,ce=!(ue&&ae.cc===ue.cc),fe=!(ue&&ae.level===ue.level),ge=ue&&ae.sn===ue.sn+1,pe=!ce&&!fe&&ge;if(ce&&H.logger.log(this.id+":discontinuity detected"),fe&&H.logger.log(this.id+":switch detected"),this.frag=ae,ie)ie.postMessage({cmd:"demux",data:J,decryptdata:de,initSegment:$,audioCodec:ee,videoCodec:te,timeOffset:se,discontinuity:ce,trackSwitch:fe,contiguous:pe,duration:ne,accurateTimeOffset:oe,defaultInitPTS:le},[J]);else{var me=this.demuxer;me&&me.push(J,de,$,ee,te,se,ce,fe,pe,ne,oe,le)}}},{key:"onWorkerMessage",value:function(J){var $=J.data,ee=this.hls;switch($.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case U.default.FRAG_PARSING_DATA:$.data.data1=new Uint8Array($.data1),$.data2&&($.data.data2=new Uint8Array($.data2));default:$.data=$.data||{},$.data.frag=this.frag,$.data.id=this.id,ee.trigger($.event,$.data);}}}]),Q}();C.default=X},{1:1,3:3,22:22,23:23,30:30,32:32,50:50}],25:[function(I,O,C){"use strict";function F(U,G){if(!(U instanceof G))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(C,"__esModule",{value:!0});var N=function(){function U(G,K){for(var W=0,V;W<K.length;W++)V=K[W],V.enumerable=V.enumerable||!1,V.configurable=!0,"value"in V&&(V.writable=!0),Object.defineProperty(G,V.key,V)}return function(G,K,W){return K&&U(G.prototype,K),W&&U(G,W),G}}(),M=I(50),B=function(){function U(G){F(this,U),this.data=G,this.bytesAvailable=G.byteLength,this.word=0,this.bitsAvailable=0}return N(U,[{key:"loadWord",value:function(){var K=this.data,W=this.bytesAvailable,V=K.byteLength-W,H=new Uint8Array(4),q=Math.min(4,W);if(0===q)throw new Error("no bytes available");H.set(K.subarray(V,V+q)),this.word=new DataView(H.buffer).getUint32(0),this.bitsAvailable=8*q,this.bytesAvailable-=q}},{key:"skipBits",value:function(K){var W;this.bitsAvailable>K?(this.word<<=K,this.bitsAvailable-=K):(K-=this.bitsAvailable,W=K>>3,K-=W>>3,this.bytesAvailable-=W,this.loadWord(),this.word<<=K,this.bitsAvailable-=K)}},{key:"readBits",value:function(K){var W=Math.min(this.bitsAvailable,K),V=this.word>>>32-W;return 32<K&&M.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=W,0<this.bitsAvailable?this.word<<=W:0<this.bytesAvailable&&this.loadWord(),W=K-W,0<W&&this.bitsAvailable?V<<W|this.readBits(W):V}},{key:"skipLZ",value:function(){var K;for(K=0;K<this.bitsAvailable;++K)if(0!=(this.word&2147483648>>>K))return this.word<<=K,this.bitsAvailable-=K,K;return this.loadWord(),K+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var K=this.skipLZ();return this.readBits(K+1)-1}},{key:"readEG",value:function(){var K=this.readUEG();return 1&K?1+K>>>1:-1*(K>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(K){var W=8,V=8,H,q;for(H=0;H<K;H++)0!=V&&(q=this.readEG(),V=(W+q+256)%256),W=0==V?W:V}},{key:"readSPS",value:function(){var K=0,W=0,V=0,H=0,te=this.readUByte.bind(this),ae=this.readBits.bind(this),ne=this.readUEG.bind(this),oe=this.readBoolean.bind(this),le=this.skipBits.bind(this),ie=this.skipEG.bind(this),se=this.skipUEG.bind(this),de=this.skipScalingList.bind(this),q,Y,z,X,Q,Z,J,$,ee;if(te(),q=te(),Y=ae(5),le(3),z=te(),se(),100===q||110===q||122===q||244===q||44===q||83===q||86===q||118===q||128===q){var ue=ne();if(3===ue&&le(1),se(),se(),le(1),oe())for($=3===ue?12:8,ee=0;ee<$;ee++)oe()&&(6>ee?de(16):de(64))}se();var ce=ne();if(0===ce)ne();else if(1===ce)for(le(1),ie(),ie(),X=ne(),ee=0;ee<X;ee++)ie();se(),le(1),Q=ne(),Z=ne(),J=ae(1),0===J&&le(1),le(1),oe()&&(K=ne(),W=ne(),V=ne(),H=ne());var fe=[1,1];if(oe()&&oe()){var ge=te();switch(ge){case 1:fe=[1,1];break;case 2:fe=[12,11];break;case 3:fe=[10,11];break;case 4:fe=[16,11];break;case 5:fe=[40,33];break;case 6:fe=[24,11];break;case 7:fe=[20,11];break;case 8:fe=[32,11];break;case 9:fe=[80,33];break;case 10:fe=[18,11];break;case 11:fe=[15,11];break;case 12:fe=[64,33];break;case 13:fe=[160,99];break;case 14:fe=[4,3];break;case 15:fe=[3,2];break;case 16:fe=[2,1];break;case 255:{fe=[te()<<8|te(),te()<<8|te()];break}}}return{width:Math.ceil(16*(Q+1)-2*K-2*W),height:16*((2-J)*(Z+1))-(J?2:4)*(V+H),pixelRatio:fe}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),U}();C.default=B},{50:50}],26:[function(I,O,C){"use strict";function F(U,G){if(!(U instanceof G))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(C,"__esModule",{value:!0});var N=function(){function U(G,K){for(var W=0,V;W<K.length;W++)V=K[W],V.enumerable=V.enumerable||!1,V.configurable=!0,"value"in V&&(V.writable=!0),Object.defineProperty(G,V.key,V)}return function(G,K,W){return K&&U(G.prototype,K),W&&U(G,W),G}}(),M=I(50),B=function(){function U(G){F(this,U),this._hasTimeStamp=!1;var K=0,W,V,H,q,Y,z,X,Q;do if(X=this.readUTF(G,K,3),K+=3,"ID3"===X)K+=3,W=127&G[K++],V=127&G[K++],H=127&G[K++],q=127&G[K++],Y=(W<<21)+(V<<14)+(H<<7)+q,z=K+Y,this._parseID3Frames(G,K,z),K=z;else if("3DI"===X)K+=7,M.logger.log("3DI footer found, end: "+K);else return K-=3,Q=K,void(Q&&(!this.hasTimeStamp&&M.logger.warn("ID3 tag found, but no timestamp"),this._length=Q,this._payload=G.subarray(0,Q)));while(!0)}return N(U,[{key:"readUTF",value:function(K,W,V){var H="",q=W;do H+=String.fromCharCode(K[q++]);while(q<W+V);return H}},{key:"_parseID3Frames",value:function(K,W,V){for(var H,q,Y,z,X;W+8<=V;)switch(H=this.readUTF(K,W,4),W+=4,q=K[W++]<<24+K[W++]<<16+K[W++]<<8+K[W++],z=K[W++]<<8+K[W++],Y=W,H){case"PRIV":if("com.apple.streaming.transportStreamTimestamp"===this.readUTF(K,W,44)){W+=44,W+=4;var Q=1&K[W++];this._hasTimeStamp=!0,X=((K[W++]<<23)+(K[W++]<<15)+(K[W++]<<7)+K[W++])/45,Q&&(X+=47721858.84),X=Math.round(X),M.logger.trace("ID3 timestamp found: "+X),this._timeStamp=X}break;default:}}},{key:"hasTimeStamp",get:function(){return this._hasTimeStamp}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"length",get:function(){return this._length}},{key:"payload",get:function(){return this._payload}}]),U}();C.default=B},{50:50}],27:[function(I,O,C){"use strict";function N(K,W){if(!(K instanceof W))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(C,"__esModule",{value:!0});var M=function(){function K(W,V){for(var H=0,q;H<V.length;H++)q=V[H],q.enumerable=q.enumerable||!1,q.configurable=!0,"value"in q&&(q.writable=!0),Object.defineProperty(W,q.key,q)}return function(W,V,H){return V&&K(W.prototype,V),H&&K(W,H),W}}(),B=I(32),U=function(K){return K&&K.__esModule?K:{default:K}}(B),G=function(){function K(W,V){N(this,K),this.observer=W,this.remuxer=V}return M(K,[{key:"resetTimeStamp",value:function(){}},{key:"resetInitSegment",value:function(V,H,q){var z=this.initData=K.parseInitSegment(V),X={};z.audio&&(X.audio={container:"audio/mp4",codec:H,initSegment:V}),z.video&&(X.video={container:"video/mp4",codec:q,initSegment:V}),this.observer.trigger(U.default.FRAG_PARSING_INIT_SEGMENT,{tracks:X})}},{key:"append",value:function(V,H,q,Y){var z=this.initData,X=K.startDTS(z,V);this.remuxer.remux(z.audio,z.video,null,null,X,q,Y,V)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(V){if(8<=V.length){var H=K.bin2str(V.subarray(4,8));return 0<=["moof","ftyp","styp"].indexOf(H)}return!1}},{key:"bin2str",value:function(V){return String.fromCharCode.apply(null,V)}},{key:"findBox",value:function(V,H){var q=[],Y,z,X,Q,Z;if(!H.length)return null;for(Y=0;Y<V.byteLength;)z=V[Y]<<24,z|=V[Y+1]<<16,z|=V[Y+2]<<8,z|=V[Y+3],X=K.bin2str(V.subarray(Y+4,Y+8)),Q=1<z?Y+z:V.byteLength,X===H[0]&&(1===H.length?q.push(V.subarray(Y+8,Q)):(Z=K.findBox(V.subarray(Y+8,Q),H.slice(1)),Z.length&&(q=q.concat(Z)))),Y=Q;return q}},{key:"parseInitSegment",value:function(V){var H=[],q=K.findBox(V,["moov","trak"]);return q.forEach(function(Y){var z=K.findBox(Y,["tkhd"])[0];if(z){var X=z[0],Q=0===X?12:20,Z=z[Q]<<24|z[Q+1]<<16|z[Q+2]<<8|z[Q+3];Z=0>Z?4294967296+Z:Z;var J=K.findBox(Y,["mdia","mdhd"])[0];if(J){X=J[0],Q=0===X?12:20;var $=J[Q]<<24|J[Q+1]<<16|J[Q+2]<<8|J[Q+3],ee=K.findBox(Y,["mdia","hdlr"])[0];if(ee){var te=K.bin2str(ee.subarray(8,12)),ae={soun:"audio",vide:"video"}[te];ae&&(H[Z]={timescale:$,type:ae},H[ae]={timescale:$,id:Z})}}}}),H}},{key:"startDTS",value:function(V,H){var q,Y,z;return q=K.findBox(H,["moof","traf"]),Y=[].concat.apply([],q.map(function(X){return K.findBox(X,["tfhd"]).map(function(Q){var Z,J,$;return Z=Q[4]<<24|Q[5]<<16|Q[6]<<8|Q[7],J=V[Z].timescale||9e4,$=K.findBox(X,["tfdt"]).map(function(ee){var te,ae;return te=ee[0],ae=ee[4]<<24|ee[5]<<16|ee[6]<<8|ee[7],1===te&&(ae*=Math.pow(2,32),ae+=ee[8]<<24|ee[9]<<16|ee[10]<<8|ee[11]),ae})[0],$=$||Infinity,$/J})})),z=Math.min.apply(null,Y),isFinite(z)?z:0}}]),K}();C.default=G},{32:32}],28:[function(I,O,C){"use strict";function N(K,W){if(!(K instanceof W))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(C,"__esModule",{value:!0});var M=function(){function K(W,V){for(var H=0,q;H<V.length;H++)q=V[H],q.enumerable=q.enumerable||!1,q.configurable=!0,"value"in q&&(q.writable=!0),Object.defineProperty(W,q.key,q)}return function(W,V,H){return V&&K(W.prototype,V),H&&K(W,H),W}}(),B=I(18),U=function(K){return K&&K.__esModule?K:{default:K}}(B),G=function(){function K(W,V,H,q){N(this,K),this.decryptdata=H,this.discardEPB=q,this.decrypter=new U.default(W,V)}return M(K,[{key:"decryptBuffer",value:function(V,H){this.decrypter.decrypt(V,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,H)}},{key:"decryptAacSample",value:function(V,H,q,Y){var z=V[H].unit,X=z.subarray(16,z.length-z.length%16),Q=X.buffer.slice(X.byteOffset,X.byteOffset+X.length),Z=this;this.decryptBuffer(Q,function(J){J=new Uint8Array(J),z.set(J,16),Y||Z.decryptAacSamples(V,H+1,q)})}},{key:"decryptAacSamples",value:function(V,H,q){for(;;H++){if(H>=V.length)return void q();if(!(32>V[H].unit.length)){var Y=this.decrypter.isSync();if(this.decryptAacSample(V,H,q,Y),!Y)return}}}},{key:"getAvcEncryptedData",value:function(V){for(var H=16*Math.floor((V.length-48)/160)+16,q=new Int8Array(H),Y=0,z=32;z<=V.length-16;z+=160,Y+=16)q.set(V.subarray(z,z+16),Y);return q}},{key:"getAvcDecryptedUnit",value:function(V,H){H=new Uint8Array(H);for(var q=0,Y=32;Y<=V.length-16;Y+=160,q+=16)V.set(H.subarray(q,q+16),Y);return V}},{key:"decryptAvcSample",value:function(V,H,q,Y,z,X){var Q=this.discardEPB(z.data),Z=this.getAvcEncryptedData(Q),J=this;this.decryptBuffer(Z.buffer,function($){z.data=J.getAvcDecryptedUnit(Q,$),X||J.decryptAvcSamples(V,H,q+1,Y)})}},{key:"decryptAvcSamples",value:function(V,H,q,Y){for(;;H++,q=0){if(H>=V.length)return void Y();for(var z=V[H].units;;q++){if(q>=z.length)break;var X=z[q];if(!(48>=X.length||1!==X.type&&5!==X.type)){var Q=this.decrypter.isSync();if(this.decryptAvcSample(V,H,q,Y,X,Q),!Q)return}}}}}]),K}();C.default=G},{18:18}],29:[function(I,O,C){"use strict";function F(Q){return Q&&Q.__esModule?Q:{default:Q}}function N(Q,Z){if(!(Q instanceof Z))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(C,"__esModule",{value:!0});var M=function(){function Q(Z,J){for(var $=0,ee;$<J.length;$++)ee=J[$],ee.enumerable=ee.enumerable||!1,ee.configurable=!0,"value"in ee&&(ee.writable=!0),Object.defineProperty(Z,ee.key,ee)}return function(Z,J,$){return J&&Q(Z.prototype,J),$&&Q(Z,$),Z}}(),B=I(21),U=F(B),G=I(32),K=F(G),W=I(25),V=F(W),H=I(28),q=F(H),Y=I(50),z=I(30),X=function(){function Q(Z,J,$,ee){N(this,Q),this.observer=Z,this.config=$,this.typeSupported=ee,this.remuxer=J,this.sampleAes=null}return M(Q,[{key:"setDecryptData",value:function(J){this.sampleAes=null!=J&&null!=J.key&&"SAMPLE-AES"===J.method?new q.default(this.observer,this.config,J,this.discardEPB):null}},{key:"resetInitSegment",value:function(J,$,ee,te){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack={container:"video/mp2t",type:"video",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:0},this._audioTrack={container:"video/mp2t",type:"audio",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,isAAC:!0},this._id3Track={type:"id3",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0},this._txtTrack={type:"text",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0},this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=$,this.videoCodec=ee,this._duration=te}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(J,$,ee,te){var ne=J.length,ue=!1,ae,oe,le,ie,se,de;this.contiguous=ee;var ce=this.pmtParsed,fe=this._avcTrack,ge=this._audioTrack,pe=this._id3Track,me=fe.id,ye=ge.id,he=pe.id,ve=this._pmtId,be=fe.pesData,Ee=ge.pesData,ke=pe.pesData,Te=this._parsePAT,Re=this._parsePMT,Se=this._parsePES,Ae=this._parseAVCPES.bind(this),Le=this._parseAACPES.bind(this),De=this._parseMPEGPES.bind(this),Pe=this._parseID3PES.bind(this);for(ne-=ne%188,ae=0;ae<ne;ae+=188)if(71===J[ae]){if(oe=!!(64&J[ae+1]),le=((31&J[ae+1])<<8)+J[ae+2],ie=(48&J[ae+3])>>4,!(1<ie))se=ae+4;else if(se=ae+5+J[ae+4],se===ae+188)continue;switch(le){case me:oe&&(be&&(de=Se(be))&&Ae(de,!1),be={data:[],size:0}),be&&(be.data.push(J.subarray(se,ae+188)),be.size+=ae+188-se);break;case ye:oe&&(Ee&&(de=Se(Ee))&&(ge.isAAC?Le(de):De(de)),Ee={data:[],size:0}),Ee&&(Ee.data.push(J.subarray(se,ae+188)),Ee.size+=ae+188-se);break;case he:oe&&(ke&&(de=Se(ke))&&Pe(de),ke={data:[],size:0}),ke&&(ke.data.push(J.subarray(se,ae+188)),ke.size+=ae+188-se);break;case 0:oe&&(se+=J[se]+1),ve=this._pmtId=Te(J,se);break;case ve:oe&&(se+=J[se]+1);var Ie=Re(J,se,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);me=Ie.avc,0<me&&(fe.id=me),ye=Ie.audio,0<ye&&(ge.id=ye,ge.isAAC=Ie.isAAC),he=Ie.id3,0<he&&(pe.id=he),ue&&!ce&&(Y.logger.log("reparse from beginning"),ue=!1,ae=-188),ce=this.pmtParsed=!0;break;case 17:case 8191:break;default:ue=!0;}}else this.observer.trigger(K.default.ERROR,{type:z.ErrorTypes.MEDIA_ERROR,details:z.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});be&&(de=Se(be))?(Ae(de,!0),fe.pesData=null):fe.pesData=be,Ee&&(de=Se(Ee))?(ge.isAAC?Le(de):De(de),ge.pesData=null):(Ee&&Ee.size&&Y.logger.log("last AAC PES packet truncated,might overlap between fragments"),ge.pesData=Ee),ke&&(de=Se(ke))?(Pe(de),pe.pesData=null):pe.pesData=ke,null==this.sampleAes?this.remuxer.remux(ge,fe,pe,this._txtTrack,$,ee,te):this.decryptAndRemux(ge,fe,pe,this._txtTrack,$,ee,te)}},{key:"decryptAndRemux",value:function(J,$,ee,te,ae,ne,oe){var le=this;J.samples&&J.isAAC?function(){le.sampleAes.decryptAacSamples(J.samples,0,function(){le.decryptAndRemuxAvc(J,$,ee,te,ae,ne,oe)})}():this.decryptAndRemuxAvc(J,$,ee,te,ae,ne,oe)}},{key:"decryptAndRemuxAvc",value:function(J,$,ee,te,ae,ne,oe){var le=this;$.samples?function(){le.sampleAes.decryptAvcSamples($.samples,0,0,function(){le.remuxer.remux(J,$,ee,te,ae,ne,oe)})}():this.remuxer.remux(J,$,ee,te,ae,ne,oe)}},{key:"destroy",value:function(){this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function(J,$){return(31&J[$+10])<<8|J[$+11]}},{key:"_parsePMT",value:function(J,$,ee,te){var ie={audio:-1,avc:-1,id3:-1,isAAC:!0},ae,ne,oe,le;for(ae=(15&J[$+1])<<8|J[$+2],ne=$+3+ae-4,oe=(15&J[$+10])<<8|J[$+11],$+=12+oe;$<ne;){switch(le=(31&J[$+1])<<8|J[$+2],J[$]){case 207:if(!te){Y.logger.log("unkown stream type:"+J[$]);break}case 15:-1===ie.audio&&(ie.audio=le);break;case 21:-1===ie.id3&&(ie.id3=le);break;case 219:if(!te){Y.logger.log("unkown stream type:"+J[$]);break}case 27:-1===ie.avc&&(ie.avc=le);break;case 3:case 4:ee?-1===ie.audio&&(ie.audio=le,ie.isAAC=!1):Y.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:Y.logger.warn("HEVC stream type found, not supported for now");break;default:Y.logger.log("unkown stream type:"+J[$]);}$+=((15&J[$+3])<<8|J[$+4])+5}return ie}},{key:"_parsePES",value:function(J){var $=0,ue=J.data,ee,te,ae,ne,oe,le,ie,se,de;if(!J||0===J.size)return null;for(;19>ue[0].length&&1<ue.length;){var ce=new Uint8Array(ue[0].length+ue[1].length);ce.set(ue[0]),ce.set(ue[1],ue[0].length),ue[0]=ce,ue.splice(1,1)}if(ee=ue[0],ae=(ee[0]<<16)+(ee[1]<<8)+ee[2],1===ae){if(ne=(ee[4]<<8)+ee[5],ne&&ne>J.size-6)return null;te=ee[7],192&te&&(ie=536870912*(14&ee[9])+4194304*(255&ee[10])+16384*(254&ee[11])+128*(255&ee[12])+(254&ee[13])/2,4294967295<ie&&(ie-=8589934592),64&te?(se=536870912*(14&ee[14])+4194304*(255&ee[15])+16384*(254&ee[16])+128*(255&ee[17])+(254&ee[18])/2,4294967295<se&&(se-=8589934592),5400000<ie-se&&(Y.logger.warn(Math.round((ie-se)/9e4)+"s delta between PTS and DTS, align them"),ie=se)):se=ie),oe=ee[8],de=oe+9,J.size-=de,le=new Uint8Array(J.size);for(var fe=0,ge=ue.length;fe<ge;fe++){ee=ue[fe];var pe=ee.byteLength;if(de)if(de>pe){de-=pe;continue}else ee=ee.subarray(de),pe-=de,de=0;le.set(ee,$),$+=pe}return ne&&(ne-=oe+3),{data:le,pts:ie,dts:se,len:ne}}return null}},{key:"pushAccesUnit",value:function(J,$){if(J.units.length&&J.frame){var ee=$.samples,te=ee.length;!this.config.forceKeyFrameOnDiscontinuity||!0===J.key||$.sps&&(te||this.contiguous)?(J.id=te,ee.push(J)):$.dropped++}J.debug.length&&Y.logger.log(J.pts+"/"+J.dts+":"+J.debug)}},{key:"_parseAVCPES",value:function(J,$){var ee=this,te=this._avcTrack,ae=this._parseAVCNALu(J.data),ne=!1,le=this.avcSample,oe,ie,se;J.data=null,ae.forEach(function(de){switch(de.type){case 1:ie=!0,ne,le.frame=!0;var ue=de.data;if(4<ue.length){var ce=new V.default(ue).readSliceType();(2===ce||4===ce||7===ce||9===ce)&&(le.key=!0)}break;case 5:ie=!0,le||(le=ee.avcSample=ee._createAVCSample(!0,J.pts,J.dts,"")),ne,le.key=!0,le.frame=!0;break;case 6:ie=!0,ne,oe=new V.default(ee.discardEPB(de.data)),oe.readUByte();for(var fe=0,ge=0,pe=!1,me=0;!pe&&1<oe.bytesAvailable;){fe=0;do me=oe.readUByte(),fe+=me;while(255==me);ge=0;do me=oe.readUByte(),ge+=me;while(255===me);if(4===fe&&0!==oe.bytesAvailable){pe=!0;var ye=oe.readUByte();if(181===ye){var he=oe.readUShort();if(49===he){var ve=oe.readUInt();if(1195456820===ve){var be=oe.readUByte();if(3===be){var Ee=oe.readUByte(),ke=oe.readUByte(),Re=[Ee,ke];for(se=0;se<(31&Ee);se++)Re.push(oe.readUByte()),Re.push(oe.readUByte()),Re.push(oe.readUByte());ee._insertSampleInOrder(ee._txtTrack.samples,{type:3,pts:J.pts,bytes:Re})}}}}}else if(ge<oe.bytesAvailable)for(se=0;se<ge;se++)oe.readUByte()}break;case 7:if(ie=!0,ne,!te.sps){oe=new V.default(de.data);var Se=oe.readSPS();te.width=Se.width,te.height=Se.height,te.pixelRatio=Se.pixelRatio,te.sps=[de.data],te.duration=ee._duration;var Ae=de.data.subarray(1,4),Le="avc1.";for(se=0;3>se;se++){var De=Ae[se].toString(16);2>De.length&&(De="0"+De),Le+=De}te.codec=Le}break;case 8:ie=!0,ne,te.pps||(te.pps=[de.data]);break;case 9:ie=!1,le&&ee.pushAccesUnit(le,te),le=ee.avcSample=ee._createAVCSample(!1,J.pts,J.dts,"");break;case 12:ie=!1;break;default:ie=!1,le&&(le.debug+="unknown NAL "+de.type+" ");}if(le&&ie){var Pe=le.units;Pe.push(de)}}),$&&le&&(this.pushAccesUnit(le,te),this.avcSample=null)}},{key:"_createAVCSample",value:function(J,$,ee,te){return{key:J,pts:$,dts:ee,units:[],debug:te}}},{key:"_insertSampleInOrder",value:function(J,$){var ee=J.length;if(!(0<ee))J.push($);else if($.pts>=J[ee-1].pts)J.push($);else for(var te=ee-1;0<=te;te--)if($.pts<J[te].pts){J.splice(te,0,$);break}}},{key:"_getLastNalUnit",value:function(){var J=this.avcSample,$;if(!J||0===J.units.length){var ee=this._avcTrack,te=ee.samples;J=te[te.length-1]}if(J){var ae=J.units;$=ae[ae.length-1]}return $}},{key:"_parseAVCNALu",value:function(J){var $=0,ee=J.byteLength,ne=this._avcTrack,oe=ne.naluState||0,le=oe,ie=[],ue=-1,te,ae,se,de,ce;for(-1===oe&&(ue=0,ce=31&J[0],oe=0,$=1);$<ee;){if(te=J[$++],!oe){oe=te?0:1;continue}if(1===oe){oe=te?0:2;continue}if(!te)oe=3;else if(1===te){if(0<=ue)se={data:J.subarray(ue,$-oe-1),type:ce},ie.push(se);else{var fe=this._getLastNalUnit();if(fe&&(le&&$<=4-le&&fe.state&&(fe.data=fe.data.subarray(0,fe.data.byteLength-le)),ae=$-oe-1,0<ae)){var ge=new Uint8Array(fe.data.byteLength+ae);ge.set(fe.data,0),ge.set(J.subarray(0,ae),fe.data.byteLength),fe.data=ge}}$<ee?(de=31&J[$],ue=$,ce=de,oe=0):oe=-1}else oe=0}if(0<=ue&&0<=oe&&(se={data:J.subarray(ue,ee),type:ce,state:oe},ie.push(se)),0===ie.length){var pe=this._getLastNalUnit();if(pe){var me=new Uint8Array(pe.data.byteLength+J.byteLength);me.set(pe.data,0),me.set(J,pe.data.byteLength),pe.data=me}}return ne.naluState=oe,ie}},{key:"discardEPB",value:function(J){for(var $=J.byteLength,ee=[],te=1,ae,ne;te<$-2;)0===J[te]&&0===J[te+1]&&3===J[te+2]?(ee.push(te+2),te+=2):te++;if(0===ee.length)return J;ae=$-ee.length,ne=new Uint8Array(ae);var oe=0;for(te=0;te<ae;oe++,te++)oe===ee[0]&&(oe++,ee.shift()),ne[te]=J[oe];return ne}},{key:"_parseAACPES",value:function(J){var $=this._audioTrack,ee=J.data,te=J.pts,ne=this.aacOverFlow,oe=this.aacLastPTS,le,ie,se,de,ue,ce,fe,ge,pe;if(ne){var me=new Uint8Array(ne.byteLength+ee.byteLength);me.set(ne,0),me.set(ee,ne.byteLength),ee=me}for(ue=0,ge=ee.length;ue<ge-1&&(255!==ee[ue]||240!=(240&ee[ue+1]));ue++);if(ue){var ye,he;if(ue<ge-1?(ye="AAC PES did not start with ADTS header,offset:"+ue,he=!1):(ye="no ADTS header found in AAC PES",he=!0),Y.logger.warn("parsing error:"+ye),this.observer.trigger(K.default.ERROR,{type:z.ErrorTypes.MEDIA_ERROR,details:z.ErrorDetails.FRAG_PARSING_ERROR,fatal:he,reason:ye}),he)return}if(!$.samplerate){var ve=this.audioCodec;le=U.default.getAudioConfig(this.observer,ee,ue,ve),$.config=le.config,$.samplerate=le.samplerate,$.channelCount=le.channelCount,$.codec=le.codec,$.manifestCodec=le.manifestCodec,$.duration=this._duration,Y.logger.log("parsed codec:"+$.codec+",rate:"+le.samplerate+",nb channel:"+le.channelCount)}if(de=0,se=92160000/$.samplerate,ne&&oe){var be=oe+se;1<Math.abs(be-te)&&(Y.logger.log("AAC: align PTS for overlapping frames by "+Math.round((be-te)/90)),te=be)}for(;ue+5<ge&&(ce=1&ee[ue+1]?7:9,ie=(3&ee[ue+3])<<11|ee[ue+4]<<3|(224&ee[ue+5])>>>5,ie-=ce,0<ie&&ue+ce+ie<=ge);)for(fe=te+de*se,pe={unit:ee.subarray(ue+ce,ue+ce+ie),pts:fe,dts:fe},$.samples.push(pe),$.len+=ie,ue+=ie+ce,de++;ue<ge-1&&(255!==ee[ue]||240!=(240&ee[ue+1]));ue++);ne=ue<ge?ee.subarray(ue,ge):null,this.aacOverFlow=ne,this.aacLastPTS=fe}},{key:"_parseMPEGPES",value:function(J){for(var $=J.data,ee=J.pts,te=$.length,ae=0,ne=0,oe;ne<te&&0<(oe=this._parseMpeg($,ne,te,ae++,ee));)ne+=oe}},{key:"_onMpegFrame",value:function(J,$,ee,te,ae,ne){var le=ne+ae*(1e3*(1152/ee)),ie=this._audioTrack;ie.config=[],ie.channelCount=te,ie.samplerate=ee,ie.duration=this._duration,ie.samples.push({unit:J,pts:le,dts:le}),ie.len+=J.length}},{key:"_onMpegNoise",value:function(J){Y.logger.warn("mpeg audio has noise: "+J.length+" bytes")}},{key:"_parseMpeg",value:function(J,$,ee,te,ae){if($+2>ee)return-1;if(255===J[$]||224==(224&J[$+1])){if($+24>ee)return-1;var le=3&J[$+1]>>3,ie=3&J[$+1]>>1,se=15&J[$+2]>>4,de=3&J[$+2]>>2,ue=!!(2&J[$+2]);if(1!=le&&0!=se&&15!=se&&3!=de){var ce=3==le?3-ie:3==ie?3:4,fe=1e3*[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160][14*ce+se-1],ge=3==le?0:2==le?1:2,pe=[44100,48000,32000,22050,24000,16000,11025,12000,8000][3*ge+de],me=ue?1:0,ye=3==J[$+3]>>6?1:2,he=3==ie?(3==le?12:6)*fe/pe+me<<2:0|(3==le?144:72)*fe/pe+me;return $+he>ee?-1:(this._onMpegFrame&&this._onMpegFrame(J.subarray($,$+he),fe,pe,ye,te,ae),he)}}for(var ve=$+2;ve<ee;){if(255===J[ve-1]&&224==(224&J[ve]))return this._onMpegNoise&&this._onMpegNoise(J.subarray($,ve-1)),ve-$-1;ve++}return-1}},{key:"_parseID3PES",value:function(J){this._id3Track.samples.push(J)}}],[{key:"probe",value:function(J){return 564<=J.length&&71===J[0]&&71===J[188]&&71===J[376]}}]),Q}();C.default=X},{21:21,25:25,28:28,30:30,32:32,50:50}],30:[function(I,O,C){"use strict";Object.defineProperty(C,"__esModule",{value:!0});var F=C.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},N=C.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException",WEBVTT_EXCEPTION:"webVTTException"}},{}],31:[function(I,O,C){"use strict";function N(H,q){if(!(H instanceof q))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(C,"__esModule",{value:!0});var M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(H){return typeof H}:function(H){return H&&"function"==typeof Symbol&&H.constructor===Symbol&&H!==Symbol.prototype?"symbol":typeof H},B=function(){function H(q,Y){for(var z=0,X;z<Y.length;z++)X=Y[z],X.enumerable=X.enumerable||!1,X.configurable=!0,"value"in X&&(X.writable=!0),Object.defineProperty(q,X.key,X)}return function(q,Y,z){return Y&&H(q.prototype,Y),z&&H(q,z),q}}(),U=I(50),G=I(30),K=I(32),W=function(H){return H&&H.__esModule?H:{default:H}}(K),V=function(){function H(q){N(this,H),this.hls=q,this.onEvent=this.onEvent.bind(this);for(var Y=arguments.length,z=Array(1<Y?Y-1:0),X=1;X<Y;X++)z[X-1]=arguments[X];this.handledEvents=z,this.useGenericHandler=!0,this.registerListeners()}return B(H,[{key:"destroy",value:function(){this.unregisterListeners()}},{key:"isEventHandler",value:function(){return"object"===M(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(Y){if("hlsEventGeneric"===Y)throw new Error("Forbidden event name: "+Y);this.hls.on(Y,this.onEvent)}.bind(this))}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(Y){this.hls.off(Y,this.onEvent)}.bind(this))}},{key:"onEvent",value:function(Y,z){this.onEventGeneric(Y,z)}},{key:"onEventGeneric",value:function(Y,z){var X=function(Z,J){var $="on"+Z.replace("hls","");if("function"!=typeof this[$])throw new Error("Event "+Z+" has no generic handler in this "+this.constructor.name+" class (tried "+$+")");return this[$].bind(this,J)};try{X.call(this,Y,z).call()}catch(Q){U.logger.error("internal error happened while processing "+Y+":"+Q.message),this.hls.trigger(W.default.ERROR,{type:G.ErrorTypes.OTHER_ERROR,details:G.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:Y,err:Q})}}}]),H}();C.default=V},{30:30,32:32,50:50}],32:[function(I,O){"use strict";O.exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCH:"hlsLevelSwitch",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},{}],33:[function(I,O,C){"use strict";function F(B,U){if(!(B instanceof U))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(C,"__esModule",{value:!0});var N=function(){function B(U,G){for(var K=0,W;K<G.length;K++)W=G[K],W.enumerable=W.enumerable||!1,W.configurable=!0,"value"in W&&(W.writable=!0),Object.defineProperty(U,W.key,W)}return function(U,G,K){return G&&B(U.prototype,G),K&&B(U,K),U}}(),M=function(){function B(){F(this,B)}return N(B,null,[{key:"getSilentFrame",value:function(G,K){switch(G){case"mp4a.40.2":if(1===K)return new Uint8Array([0,200,0,128,35,128]);if(2===K)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===K)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===K)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===K)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===K)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===K)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===K)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===K)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);}return null}}]),B}();C.default=M},{}],34:[function(I,O){"use strict";O.exports={isBuffered:function(M,B){if(M)for(var U=M.buffered,G=0;G<U.length;G++)if(B>=U.start(G)&&B<=U.end(G))return!0;return!1},bufferInfo:function(M,B,U){if(M){var G=M.buffered,K=[],W;for(W=0;W<G.length;W++)K.push({start:G.start(W),end:G.end(W)});return this.bufferedInfo(K,B,U)}return{len:0,start:B,end:B,nextStart:void 0}},bufferedInfo:function(M,B,U){var G=[],K,W,V,H,q;for(M.sort(function(Z,J){var $=Z.start-J.start;return $?$:J.end-Z.end}),q=0;q<M.length;q++){var Y=G.length;if(Y){var z=G[Y-1].end;M[q].start-z<U?M[q].end>z&&(G[Y-1].end=M[q].end):G.push(M[q])}else G.push(M[q])}for(q=0,K=0,W=V=B;q<G.length;q++){var X=G[q].start,Q=G[q].end;if(B+U>=X&&B<Q)W=X,V=Q,K=V-B;else if(B+U<X){H=X;break}}return{len:K,start:W,end:V,nextStart:H}}}},{}],35:[function(I,O){"use strict";var F=I(50),N={mergeDetails:function(B,U){var G=Math.max(B.startSN,U.startSN)-U.startSN,K=Math.min(B.endSN,U.endSN)-U.startSN,W=U.startSN-B.startSN,V=B.fragments,H=U.fragments,q=0,Y;if(K<G)return void(U.PTSKnown=!1);for(var z=G;z<=K;z++){var X=V[W+z],Q=H[z];Q&&X&&(q=X.cc-Q.cc,!isNaN(X.startPTS)&&(Q.start=Q.startPTS=X.startPTS,Q.endPTS=X.endPTS,Q.duration=X.duration,Y=Q))}if(q)for(F.logger.log("discontinuity sliding from playlist, take drift into account"),z=0;z<H.length;z++)H[z].cc+=q;if(Y)N.updateFragPTSDTS(U,Y.sn,Y.startPTS,Y.endPTS,Y.startDTS,Y.endDTS);else if(0<=W&&W<V.length){var Z=V[W].start;for(z=0;z<H.length;z++)H[z].start+=Z}U.PTSKnown=B.PTSKnown},updateFragPTSDTS:function(B,U,G,K,W,V){var H,q,Y,z;if(!B||U<B.startSN||U>B.endSN)return 0;if(H=U-B.startSN,q=B.fragments,Y=q[H],!isNaN(Y.startPTS)){var X=Math.abs(Y.startPTS-G);Y.deltaPTS=isNaN(Y.deltaPTS)?X:Math.max(X,Y.deltaPTS),G=Math.min(G,Y.startPTS),K=Math.max(K,Y.endPTS),W=Math.min(W,Y.startDTS),V=Math.max(V,Y.endDTS)}var Q=G-Y.start;for(Y.start=Y.startPTS=G,Y.endPTS=K,Y.startDTS=W,Y.endDTS=V,Y.duration=K-G,z=H;0<z;z--)N.updatePTS(q,z,z-1);for(z=H;z<q.length-1;z++)N.updatePTS(q,z,z+1);return B.PTSKnown=!0,Q},updatePTS:function(B,U,G){var K=B[U],W=B[G],V=W.startPTS;isNaN(V)?G>U?W.start=K.start+K.duration:W.start=K.start-W.duration:G>U?(K.duration=V-K.start,0>K.duration&&F.logger.warn("negative duration computed for frag "+K.sn+",level "+K.level+", there should be some duration drift between playlist and fragment!")):(W.duration=K.start-V,0>W.duration&&F.logger.warn("negative duration computed for frag "+W.sn+",level "+W.level+", there should be some duration drift between playlist and fragment!"))}};O.exports=N},{50:50}],36:[function(I,O,C){"use strict";function F(ne){return ne&&ne.__esModule?ne:{default:ne}}function N(ne,oe){if(!(ne instanceof oe))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(C,"__esModule",{value:!0});var M=function(){function ne(oe,le){for(var ie=0,se;ie<le.length;ie++)se=le[ie],se.enumerable=se.enumerable||!1,se.configurable=!0,"value"in se&&(se.writable=!0),Object.defineProperty(oe,se.key,se)}return function(oe,le,ie){return le&&ne(oe.prototype,le),ie&&ne(oe,ie),oe}}(),B=I(32),U=F(B),G=I(30),K=I(40),W=F(K),V=I(38),H=F(V),q=I(39),Y=F(q),z=I(12),X=F(z),Q=I(11),Z=F(Q),J=I(50),$=I(1),ee=F($),te=I(4),ae=function(){function ne(){var oe=this,le=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};N(this,ne);var ie=ne.DefaultConfig;if((le.liveSyncDurationCount||le.liveMaxLatencyDurationCount)&&(le.liveSyncDuration||le.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var se in ie)se in le||(le[se]=ie[se]);if(void 0!==le.liveMaxLatencyDurationCount&&le.liveMaxLatencyDurationCount<=le.liveSyncDurationCount)throw new Error("Illegal hls.js config: \"liveMaxLatencyDurationCount\" must be gt \"liveSyncDurationCount\"");if(void 0!==le.liveMaxLatencyDuration&&(le.liveMaxLatencyDuration<=le.liveSyncDuration||void 0===le.liveSyncDuration))throw new Error("Illegal hls.js config: \"liveMaxLatencyDuration\" must be gt \"liveSyncDuration\"");(0,J.enableLogs)(le.debug),this.config=le,this._autoLevelCapping=-1;var de=this.observer=new ee.default;de.trigger=function(Ae){for(var Le=arguments.length,De=Array(1<Le?Le-1:0),Pe=1;Pe<Le;Pe++)De[Pe-1]=arguments[Pe];de.emit.apply(de,[Ae,Ae].concat(De))},de.off=function(Ae){for(var Le=arguments.length,De=Array(1<Le?Le-1:0),Pe=1;Pe<Le;Pe++)De[Pe-1]=arguments[Pe];de.removeListener.apply(de,[Ae].concat(De))},this.on=de.on.bind(de),this.off=de.off.bind(de),this.trigger=de.trigger.bind(de);var ue=this.abrController=new le.abrController(this),ce=new le.bufferController(this),fe=new le.capLevelController(this),ge=new le.fpsController(this),pe=new W.default(this),me=new H.default(this),ye=new Y.default(this),he=this.levelController=new Z.default(this),ve=this.streamController=new X.default(this),be=[he,ve],Ee=le.audioStreamController;Ee&&be.push(new Ee(this)),this.networkControllers=be;var ke=[pe,me,ye,ue,ce,fe,ge];if(Ee=le.audioTrackController,Ee){var Te=new Ee(this);this.audioTrackController=Te,ke.push(Te)}if(Ee=le.subtitleTrackController,Ee){var Re=new Ee(this);this.subtitleTrackController=Re,ke.push(Re)}[le.subtitleStreamController,le.timelineController].forEach(function(Se){Se&&ke.push(new Se(oe))}),this.coreComponents=ke}return M(ne,null,[{key:"isSupported",value:function(){return window.MediaSource=window.MediaSource||window.WebKitMediaSource,window.MediaSource&&"function"==typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported("video/mp4; codecs=\"avc1.42E01E,mp4a.40.2\"")}},{key:"version",get:function(){return"0.7.4"}},{key:"Events",get:function(){return U.default}},{key:"ErrorTypes",get:function(){return G.ErrorTypes}},{key:"ErrorDetails",get:function(){return G.ErrorDetails}},{key:"DefaultConfig",get:function(){return ne.defaultConfig?ne.defaultConfig:te.hlsDefaultConfig},set:function(le){ne.defaultConfig=le}}]),M(ne,[{key:"destroy",value:function(){J.logger.log("destroy"),this.trigger(U.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(le){le.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1}},{key:"attachMedia",value:function(le){J.logger.log("attachMedia"),this.media=le,this.trigger(U.default.MEDIA_ATTACHING,{media:le})}},{key:"detachMedia",value:function(){J.logger.log("detachMedia"),this.trigger(U.default.MEDIA_DETACHING),this.media=null}},{key:"loadSource",value:function(le){J.logger.log("loadSource:"+le),this.url=le,this.trigger(U.default.MANIFEST_LOADING,{url:le})}},{key:"startLoad",value:function(){var le=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1;J.logger.log("startLoad("+le+")"),this.networkControllers.forEach(function(ie){ie.startLoad(le)})}},{key:"stopLoad",value:function(){J.logger.log("stopLoad"),this.networkControllers.forEach(function(le){le.stopLoad()})}},{key:"swapAudioCodec",value:function(){J.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){J.logger.log("recoverMediaError");var le=this.media;this.detachMedia(),this.attachMedia(le)}},{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(le){J.logger.log("set currentLevel:"+le),this.loadLevel=le,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(le){J.logger.log("set nextLevel:"+le),this.levelController.manualLevel=le,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(le){J.logger.log("set loadLevel:"+le),this.levelController.manualLevel=le}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(le){this.levelController.nextLoadLevel=le}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(le){J.logger.log("set firstLevel:"+le),this.levelController.firstLevel=le}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(le){J.logger.log("set startLevel:"+le);var ie=this;-1!==le&&(le=Math.max(le,ie.minAutoLevel)),ie.levelController.startLevel=le}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(le){J.logger.log("set autoLevelCapping:"+le),this._autoLevelCapping=le}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var le=this,ie=le.levels,se=le.config.minAutoBitrate,de=ie?ie.length:0,ue=0,ce;ue<de;ue++)if(ce=ie[ue].realBitrate?Math.max(ie[ue].realBitrate,ie[ue].bitrate):ie[ue].bitrate,ce>se)return ue;return 0}},{key:"maxAutoLevel",get:function(){var le=this,ie=le.levels,se=le.autoLevelCapping,de;return de=-1===se&&ie&&ie.length?ie.length-1:se,de}},{key:"nextAutoLevel",get:function(){var le=this;return Math.min(Math.max(le.abrController.nextAutoLevel,le.minAutoLevel),le.maxAutoLevel)},set:function(le){var ie=this;ie.abrController.nextAutoLevel=Math.max(ie.minAutoLevel,le)}},{key:"audioTracks",get:function(){var le=this.audioTrackController;return le?le.audioTracks:[]}},{key:"audioTrack",get:function(){var le=this.audioTrackController;return le?le.audioTrack:-1},set:function(le){var ie=this.audioTrackController;ie&&(ie.audioTrack=le)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var le=this.subtitleTrackController;return le?le.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var le=this.subtitleTrackController;return le?le.subtitleTrack:-1},set:function(le){var ie=this.subtitleTrackController;ie&&(ie.subtitleTrack=le)}}]),ne}();C.default=ae},{1:1,4:4,11:11,12:12,30:30,32:32,38:38,39:39,40:40,50:50}],37:[function(I,O){"use strict";O.exports=I(36).default},{36:36}],38:[function(I,O,C){"use strict";function F(z){return z&&z.__esModule?z:{default:z}}function N(z,X){if(!(z instanceof X))throw new TypeError("Cannot call a class as a function")}function M(z,X){if(!z)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return X&&("object"==typeof X||"function"==typeof X)?X:z}function B(z,X){if("function"!=typeof X&&null!==X)throw new TypeError("Super expression must either be null or a function, not "+typeof X);z.prototype=Object.create(X&&X.prototype,{constructor:{value:z,enumerable:!1,writable:!0,configurable:!0}}),X&&(Object.setPrototypeOf?Object.setPrototypeOf(z,X):z.__proto__=X)}Object.defineProperty(C,"__esModule",{value:!0});var U=function(){function z(X,Q){for(var Z=0,J;Z<Q.length;Z++)J=Q[Z],J.enumerable=J.enumerable||!1,J.configurable=!0,"value"in J&&(J.writable=!0),Object.defineProperty(X,J.key,J)}return function(X,Q,Z){return Q&&z(X.prototype,Q),Z&&z(X,Z),X}}(),G=I(32),K=F(G),W=I(31),V=F(W),H=I(30),q=I(50),Y=function(z){function X(Q){N(this,X);var Z=M(this,(X.__proto__||Object.getPrototypeOf(X)).call(this,Q,K.default.FRAG_LOADING));return Z.loaders={},Z}return B(X,z),U(X,[{key:"destroy",value:function(){var Z=this.loaders;for(var J in Z){var $=Z[J];$&&$.destroy()}this.loaders={},V.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(Z){var J=Z.frag,$=J.type,ee=this.loaders[$],te=this.hls.config;J.loaded=0,ee&&(q.logger.warn("abort previous fragment loader for type:"+$),ee.abort()),ee=this.loaders[$]=J.loader="undefined"==typeof te.fLoader?new te.loader(te):new te.fLoader(te);var ae,ne,oe;ae={url:J.url,frag:J,responseType:"arraybuffer",progressData:!1};var le=J.byteRangeStartOffset,ie=J.byteRangeEndOffset;isNaN(le)||isNaN(ie)||(ae.rangeStart=le,ae.rangeEnd=ie),ne={timeout:te.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:te.fragLoadingMaxRetryTimeout},oe={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},ee.load(ae,ne,oe)}},{key:"loadsuccess",value:function(Z,J,$){var ee=Z.data,te=$.frag;te.loader=void 0,this.loaders[te.type]=void 0,this.hls.trigger(K.default.FRAG_LOADED,{payload:ee,frag:te,stats:J})}},{key:"loaderror",value:function(Z,J){var $=J.loader;$&&$.abort(),this.loaders[J.type]=void 0,this.hls.trigger(K.default.ERROR,{type:H.ErrorTypes.NETWORK_ERROR,details:H.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:J.frag,response:Z})}},{key:"loadtimeout",value:function(Z,J){var $=J.loader;$&&$.abort(),this.loaders[J.type]=void 0,this.hls.trigger(K.default.ERROR,{type:H.ErrorTypes.NETWORK_ERROR,details:H.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:J.frag})}},{key:"loadprogress",value:function(Z,J){var ee=J.frag;ee.loaded=Z.loaded,this.hls.trigger(K.default.FRAG_LOAD_PROGRESS,{frag:ee,stats:Z})}}]),X}(V.default);C.default=Y},{30:30,31:31,32:32,50:50}],39:[function(I,O,C){"use strict";function F(z){return z&&z.__esModule?z:{default:z}}function N(z,X){if(!(z instanceof X))throw new TypeError("Cannot call a class as a function")}function M(z,X){if(!z)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return X&&("object"==typeof X||"function"==typeof X)?X:z}function B(z,X){if("function"!=typeof X&&null!==X)throw new TypeError("Super expression must either be null or a function, not "+typeof X);z.prototype=Object.create(X&&X.prototype,{constructor:{value:z,enumerable:!1,writable:!0,configurable:!0}}),X&&(Object.setPrototypeOf?Object.setPrototypeOf(z,X):z.__proto__=X)}Object.defineProperty(C,"__esModule",{value:!0});var U=function(){function z(X,Q){for(var Z=0,J;Z<Q.length;Z++)J=Q[Z],J.enumerable=J.enumerable||!1,J.configurable=!0,"value"in J&&(J.writable=!0),Object.defineProperty(X,J.key,J)}return function(X,Q,Z){return Q&&z(X.prototype,Q),Z&&z(X,Z),X}}(),G=I(32),K=F(G),W=I(31),V=F(W),H=I(30),q=I(50),Y=function(z){function X(Q){N(this,X);var Z=M(this,(X.__proto__||Object.getPrototypeOf(X)).call(this,Q,K.default.KEY_LOADING));return Z.loaders={},Z.decryptkey=null,Z.decrypturl=null,Z}return B(X,z),U(X,[{key:"destroy",value:function(){for(var Z in this.loaders){var J=this.loaders[Z];J&&J.destroy()}this.loaders={},V.default.prototype.destroy.call(this)}},{key:"onKeyLoading",value:function(Z){var J=Z.frag,$=J.type,ee=this.loaders[$],te=J.decryptdata,ae=te.uri;if(ae!==this.decrypturl||null===this.decryptkey){var ne=this.hls.config;ee&&(q.logger.warn("abort previous key loader for type:"+$),ee.abort()),J.loader=this.loaders[$]=new ne.loader(ne),this.decrypturl=ae,this.decryptkey=null;var oe,le,ie;oe={url:ae,frag:J,responseType:"arraybuffer"},le={timeout:ne.fragLoadingTimeOut,maxRetry:ne.fragLoadingMaxRetry,retryDelay:ne.fragLoadingRetryDelay,maxRetryDelay:ne.fragLoadingMaxRetryTimeout},ie={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},J.loader.load(oe,le,ie)}else this.decryptkey&&(te.key=this.decryptkey,this.hls.trigger(K.default.KEY_LOADED,{frag:J}))}},{key:"loadsuccess",value:function(Z,J,$){var ee=$.frag;this.decryptkey=ee.decryptdata.key=new Uint8Array(Z.data),ee.loader=void 0,this.loaders[ee.type]=void 0,this.hls.trigger(K.default.KEY_LOADED,{frag:ee})}},{key:"loaderror",value:function(Z,J){var $=J.frag,ee=$.loader;ee&&ee.abort(),this.loaders[J.type]=void 0,this.hls.trigger(K.default.ERROR,{type:H.ErrorTypes.NETWORK_ERROR,details:H.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:$,response:Z})}},{key:"loadtimeout",value:function(Z,J){var $=J.frag,ee=$.loader;ee&&ee.abort(),this.loaders[J.type]=void 0,this.hls.trigger(K.default.ERROR,{type:H.ErrorTypes.NETWORK_ERROR,details:H.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:$})}}]),X}(V.default);C.default=Y},{30:30,31:31,32:32,50:50}],40:[function(I,O,C){"use strict";function F(oe){return oe&&oe.__esModule?oe:{default:oe}}function N(oe,le){if(!oe)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return le&&("object"==typeof le||"function"==typeof le)?le:oe}function M(oe,le){if("function"!=typeof le&&null!==le)throw new TypeError("Super expression must either be null or a function, not "+typeof le);oe.prototype=Object.create(le&&le.prototype,{constructor:{value:oe,enumerable:!1,writable:!0,configurable:!0}}),le&&(Object.setPrototypeOf?Object.setPrototypeOf(oe,le):oe.__proto__=le)}function B(oe,le){if(!(oe instanceof le))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(C,"__esModule",{value:!0});var U=function(){function oe(le,ie){for(var se=0,de;se<ie.length;se++)de=ie[se],de.enumerable=de.enumerable||!1,de.configurable=!0,"value"in de&&(de.writable=!0),Object.defineProperty(le,de.key,de)}return function(le,ie,se){return ie&&oe(le.prototype,ie),se&&oe(le,se),le}}(),G=I(2),K=F(G),W=I(32),V=F(W),H=I(31),q=F(H),Y=I(30),z=I(44),X=F(z),Q=I(50),Z=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,J=/#EXT-X-MEDIA:(.*)/g,$=/#EXTINF:(\d*(?:\.\d+)?)(?:,(.*))?|(?!#)(\S.+)|#EXT-X-BYTERANGE: *(.+)|#EXT-X-PROGRAM-DATE-TIME:(.+)|#.*/g,ee=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,te=function(){function oe(){B(this,oe),this.method=null,this.key=null,this.iv=null,this._uri=null}return U(oe,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=K.default.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),oe}(),ae=function(){function oe(){B(this,oe),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}return U(oe,[{key:"createInitializationVector",value:function(ie){for(var se=new Uint8Array(16),de=12;16>de;de++)se[de]=255&ie>>8*(15-de);return se}},{key:"fragmentDecryptdataFromLevelkey",value:function(ie,se){var de=ie;return ie&&ie.method&&ie.uri&&!ie.iv&&(de=new te,de.method=ie.method,de.baseuri=ie.baseuri,de.reluri=ie.reluri,de.iv=this.createInitializationVector(se)),de}},{key:"cloneObj",value:function(ie){return JSON.parse(JSON.stringify(ie))}},{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=K.default.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(ie){this._url=ie}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){if(!this._byteRange){var ie=this._byteRange=[];if(this.rawByteRange){var se=this.rawByteRange.split("@",2);if(1===se.length){var de=this.lastByteRangeEndOffset;ie[0]=de?de:0}else ie[0]=parseInt(se[1]);ie[1]=parseInt(se[0])+ie[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),oe}(),ne=function(oe){function le(ie){B(this,le);var se=N(this,(le.__proto__||Object.getPrototypeOf(le)).call(this,ie,V.default.MANIFEST_LOADING,V.default.LEVEL_LOADING,V.default.AUDIO_TRACK_LOADING,V.default.SUBTITLE_TRACK_LOADING));return se.loaders={},se}return M(le,oe),U(le,[{key:"destroy",value:function(){for(var se in this.loaders){var de=this.loaders[se];de&&de.destroy()}this.loaders={},q.default.prototype.destroy.call(this)}},{key:"onManifestLoading",value:function(se){this.load(se.url,{type:"manifest"})}},{key:"onLevelLoading",value:function(se){this.load(se.url,{type:"level",level:se.level,id:se.id})}},{key:"onAudioTrackLoading",value:function(se){this.load(se.url,{type:"audioTrack",id:se.id})}},{key:"onSubtitleTrackLoading",value:function(se){this.load(se.url,{type:"subtitleTrack",id:se.id})}},{key:"load",value:function(se,de){var ue=this.loaders[de.type];if(ue){var ce=ue.context;if(ce&&ce.url===se)return void Q.logger.trace("playlist request ongoing");Q.logger.warn("abort previous loader for type:"+de.type),ue.abort()}var fe=this.hls.config,ge,pe,me,ye;"manifest"===de.type?(ge=fe.manifestLoadingMaxRetry,pe=fe.manifestLoadingTimeOut,me=fe.manifestLoadingRetryDelay,ye=fe.manifestLoadingMaxRetryTimeout):(ge=fe.levelLoadingMaxRetry,pe=fe.levelLoadingTimeOut,me=fe.levelLoadingRetryDelay,ye=fe.levelLoadingMaxRetryTimeout,Q.logger.log("loading playlist for "+de.type+" "+(de.level||de.id))),ue=this.loaders[de.type]=de.loader="undefined"==typeof fe.pLoader?new fe.loader(fe):new fe.pLoader(fe),de.url=se,de.responseType="";var he,ve;he={timeout:pe,maxRetry:ge,retryDelay:me,maxRetryDelay:ye},ve={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},ue.load(de,he,ve)}},{key:"resolve",value:function(se,de){return K.default.buildAbsoluteURL(de,se,{alwaysNormalize:!0})}},{key:"parseMasterPlaylist",value:function(se,de){var ue=[],ce;for(Z.lastIndex=0;null!=(ce=Z.exec(se));){var fe={},ge=fe.attrs=new X.default(ce[1]);fe.url=this.resolve(ce[2],de);var pe=ge.decimalResolution("RESOLUTION");pe&&(fe.width=pe.width,fe.height=pe.height),fe.bitrate=ge.decimalInteger("AVERAGE-BANDWIDTH")||ge.decimalInteger("BANDWIDTH"),fe.name=ge.NAME;var me=ge.CODECS;if(me){me=me.split(/[ ,]+/);for(var ye=0,he;ye<me.length;ye++)he=me[ye],-1===he.indexOf("avc1")?fe.audioCodec=he:fe.videoCodec=this.avc1toavcoti(he)}ue.push(fe)}return ue}},{key:"parseMasterPlaylistMedia",value:function(se,de,ue){var fe=[],ge=0,ce;for(J.lastIndex=0;null!=(ce=J.exec(se));){var pe={},me=new X.default(ce[1]);me.TYPE===ue&&(pe.groupId=me["GROUP-ID"],pe.name=me.NAME,pe.type=ue,pe.default="YES"===me.DEFAULT,pe.autoselect="YES"===me.AUTOSELECT,pe.forced="YES"===me.FORCED,me.URI&&(pe.url=this.resolve(me.URI,de)),pe.lang=me.LANGUAGE,!pe.name&&(pe.name=pe.lang),pe.id=ge++,fe.push(pe))}return fe}},{key:"avc1toavcoti",value:function(se){var ue=se.split("."),de;return 2<ue.length?(de=ue.shift()+".",de+=parseInt(ue.shift()).toString(16),de+=("000"+parseInt(ue.shift()).toString(16)).substr(-4)):de=se,de}},{key:"parseLevelPlaylist",value:function(se,de,ue,ce){var fe=0,ge=0,pe={type:null,version:null,url:de,fragments:[],live:!0,startSN:0},me=new te,ye=0,he=null,ve=new ae,be,Ee;for($.lastIndex=0;null!==(be=$.exec(se));){var ke=be[1];if(ke){ve.duration=parseFloat(ke);var Te=(" "+be[2]).slice(1);ve.title=Te?Te:null,ve.tagList.push(Te?["INF",ke,Te]:["INF",ke])}else if(be[3]){if(!isNaN(ve.duration)){var Re=fe++;ve.type=ce,ve.start=ge,ve.levelkey=me,ve.sn=Re,ve.level=ue,ve.cc=ye,ve.baseurl=de,ve.relurl=(" "+be[3]).slice(1),pe.fragments.push(ve),he=ve,ge+=ve.duration,ve=new ae}}else if(be[4]){if(ve.rawByteRange=(" "+be[4]).slice(1),he){var Se=he.byteRangeEndOffset;Se&&(ve.lastByteRangeEndOffset=Se)}}else if(be[5])ve.rawProgramDateTime=(" "+be[5]).slice(1),ve.tagList.push(["PROGRAM-DATE-TIME",ve.rawProgramDateTime]);else{for(be=be[0].match(ee),Ee=1;Ee<be.length&&void 0===be[Ee];Ee++);var Ae=(" "+be[Ee+1]).slice(1),Le=(" "+be[Ee+2]).slice(1);switch(be[Ee]){case"#":ve.tagList.push(Le?[Ae,Le]:[Ae]);break;case"PLAYLIST-TYPE":pe.type=Ae.toUpperCase();break;case"MEDIA-SEQUENCE":fe=pe.startSN=parseInt(Ae);break;case"TARGETDURATION":pe.targetduration=parseFloat(Ae);break;case"VERSION":pe.version=parseInt(Ae);break;case"EXTM3U":break;case"ENDLIST":pe.live=!1;break;case"DIS":ye++,ve.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":ye=parseInt(Ae);break;case"KEY":var Pe=new X.default(Ae),Ie=Pe.enumeratedString("METHOD"),xe=Pe.URI,Oe=Pe.hexadecimalInteger("IV");Ie&&(me=new te,xe&&0<=["AES-128","SAMPLE-AES"].indexOf(Ie)&&(me.method=Ie,me.baseuri=de,me.reluri=xe,me.key=null,me.iv=Oe));break;case"START":var we=new X.default(Ae),Fe=we.decimalFloatingPoint("TIME-OFFSET");isNaN(Fe)||(pe.startTimeOffset=Fe);break;case"MAP":var Ne=new X.default(Ae);ve.relurl=Ne.URI,ve.rawByteRange=Ne.BYTERANGE,ve.baseurl=de,ve.level=ue,ve.type=ce,ve.sn="initSegment",pe.initSegment=ve,ve=new ae;break;default:Q.logger.warn("line parsed but not handled: "+be);}}}return ve=he,ve&&!ve.relurl&&(pe.fragments.pop(),ge-=ve.duration),pe.totalduration=ge,pe.averagetargetduration=ge/pe.fragments.length,pe.endSN=fe-1,pe}},{key:"loadsuccess",value:function(se,de,ue){var ce=se.data,fe=se.url,ge=ue.type,pe=ue.id,me=ue.level,ye=this.hls;if(this.loaders[ge]=void 0,(void 0===fe||0===fe.indexOf("data:"))&&(fe=ue.url),de.tload=performance.now(),0!==ce.indexOf("#EXTM3U"))ye.trigger(V.default.ERROR,{type:Y.ErrorTypes.NETWORK_ERROR,details:Y.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:fe,reason:"no EXTM3U delimiter"});else if(0<ce.indexOf("#EXTINF:")){var ve=isNaN(me)?isNaN(pe)?0:pe:me,be=this.parseLevelPlaylist(ce,fe,ve,"audioTrack"===ge?"audio":"subtitleTrack"===ge?"subtitle":"main");be.tload=de.tload,"manifest"===ge&&ye.trigger(V.default.MANIFEST_LOADED,{levels:[{url:fe,details:be}],audioTracks:[],url:fe,stats:de}),de.tparsed=performance.now(),be.targetduration?"audioTrack"!==ge&&"subtitleTrack"!==ge?ye.trigger(V.default.LEVEL_LOADED,{details:be,level:me||0,id:pe||0,stats:de}):"audioTrack"===ge?ye.trigger(V.default.AUDIO_TRACK_LOADED,{details:be,id:pe,stats:de}):"subtitleTrack"===ge&&ye.trigger(V.default.SUBTITLE_TRACK_LOADED,{details:be,id:pe,stats:de}):ye.trigger(V.default.ERROR,{type:Y.ErrorTypes.NETWORK_ERROR,details:Y.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:fe,reason:"invalid targetduration"})}else{var Ee=this.parseMasterPlaylist(ce,fe);if(Ee.length){var ke=this.parseMasterPlaylistMedia(ce,fe,"AUDIO"),Te=this.parseMasterPlaylistMedia(ce,fe,"SUBTITLES");if(ke.length){var Re=!1;ke.forEach(function(Se){Se.url||(Re=!0)}),!1==Re&&Ee[0].audioCodec&&!Ee[0].attrs.AUDIO&&(Q.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),ke.unshift({type:"main",name:"main"}))}ye.trigger(V.default.MANIFEST_LOADED,{levels:Ee,audioTracks:ke,subtitles:Te,url:fe,stats:de})}else ye.trigger(V.default.ERROR,{type:Y.ErrorTypes.NETWORK_ERROR,details:Y.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:fe,reason:"no level found in manifest"})}}},{key:"loaderror",value:function(se,de){var fe=de.loader,ue,ce;switch(de.type){case"manifest":ue=Y.ErrorDetails.MANIFEST_LOAD_ERROR,ce=!0;break;case"level":ue=Y.ErrorDetails.LEVEL_LOAD_ERROR,ce=!1;break;case"audioTrack":ue=Y.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,ce=!1;}fe&&(fe.abort(),this.loaders[de.type]=void 0),this.hls.trigger(V.default.ERROR,{type:Y.ErrorTypes.NETWORK_ERROR,details:ue,fatal:ce,url:fe.url,loader:fe,response:se,context:de})}},{key:"loadtimeout",value:function(se,de){var fe=de.loader,ue,ce;switch(de.type){case"manifest":ue=Y.ErrorDetails.MANIFEST_LOAD_TIMEOUT,ce=!0;break;case"level":ue=Y.ErrorDetails.LEVEL_LOAD_TIMEOUT,ce=!1;break;case"audioTrack":ue=Y.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT,ce=!1;}fe&&(fe.abort(),this.loaders[de.type]=void 0),this.hls.trigger(V.default.ERROR,{type:Y.ErrorTypes.NETWORK_ERROR,details:ue,fatal:ce,url:fe.url,loader:fe,context:de})}}]),le}(q.default);C.default=ne},{2:2,30:30,31:31,32:32,44:44,50:50}],41:[function(I,O,C){"use strict";function F(U,G){if(!(U instanceof G))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(C,"__esModule",{value:!0});var N=function(){function U(G,K){for(var W=0,V;W<K.length;W++)V=K[W],V.enumerable=V.enumerable||!1,V.configurable=!0,"value"in V&&(V.writable=!0),Object.defineProperty(G,V.key,V)}return function(G,K,W){return K&&U(G.prototype,K),W&&U(G,W),G}}(),M=Math.pow(2,32)-1,B=function(){function U(){F(this,U)}return N(U,null,[{key:"init",value:function(){U.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};for(var K in U.types)U.types.hasOwnProperty(K)&&(U.types[K]=[K.charCodeAt(0),K.charCodeAt(1),K.charCodeAt(2),K.charCodeAt(3)]);var W=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),V=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);U.HDLR_TYPES={video:W,audio:V};var H=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),q=new Uint8Array([0,0,0,0,0,0,0,0]);U.STTS=U.STSC=U.STCO=q,U.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),U.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),U.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),U.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var Y=new Uint8Array([105,115,111,109]),z=new Uint8Array([97,118,99,49]),X=new Uint8Array([0,0,0,1]);U.FTYP=U.box(U.types.ftyp,Y,X,Y,z),U.DINF=U.box(U.types.dinf,U.box(U.types.dref,H))}},{key:"box",value:function(K){for(var W=Array.prototype.slice.call(arguments,1),V=8,H=W.length,q=H,Y;H--;)V+=W[H].byteLength;for(Y=new Uint8Array(V),Y[0]=255&V>>24,Y[1]=255&V>>16,Y[2]=255&V>>8,Y[3]=255&V,Y.set(K,4),(H=0,V=8);H<q;H++)Y.set(W[H],V),V+=W[H].byteLength;return Y}},{key:"hdlr",value:function(K){return U.box(U.types.hdlr,U.HDLR_TYPES[K])}},{key:"mdat",value:function(K){return U.box(U.types.mdat,K)}},{key:"mdhd",value:function(K,W){W*=K;var V=Math.floor(W/(M+1)),H=Math.floor(W%(M+1));return U.box(U.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,255&K>>24,255&K>>16,255&K>>8,255&K,V>>24,255&V>>16,255&V>>8,255&V,H>>24,255&H>>16,255&H>>8,255&H,85,196,0,0]))}},{key:"mdia",value:function(K){return U.box(U.types.mdia,U.mdhd(K.timescale,K.duration),U.hdlr(K.type),U.minf(K))}},{key:"mfhd",value:function(K){return U.box(U.types.mfhd,new Uint8Array([0,0,0,0,K>>24,255&K>>16,255&K>>8,255&K]))}},{key:"minf",value:function(K){return"audio"===K.type?U.box(U.types.minf,U.box(U.types.smhd,U.SMHD),U.DINF,U.stbl(K)):U.box(U.types.minf,U.box(U.types.vmhd,U.VMHD),U.DINF,U.stbl(K))}},{key:"moof",value:function(K,W,V){return U.box(U.types.moof,U.mfhd(K),U.traf(V,W))}},{key:"moov",value:function(K){for(var W=K.length,V=[];W--;)V[W]=U.trak(K[W]);return U.box.apply(null,[U.types.moov,U.mvhd(K[0].timescale,K[0].duration)].concat(V).concat(U.mvex(K)))}},{key:"mvex",value:function(K){for(var W=K.length,V=[];W--;)V[W]=U.trex(K[W]);return U.box.apply(null,[U.types.mvex].concat(V))}},{key:"mvhd",value:function(K,W){W*=K;var V=Math.floor(W/(M+1)),H=Math.floor(W%(M+1)),q=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,255&K>>24,255&K>>16,255&K>>8,255&K,V>>24,255&V>>16,255&V>>8,255&V,H>>24,255&H>>16,255&H>>8,255&H,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return U.box(U.types.mvhd,q)}},{key:"sdtp",value:function(K){var W=K.samples||[],V=new Uint8Array(4+W.length),H,q;for(q=0;q<W.length;q++)H=W[q].flags,V[q+4]=H.dependsOn<<4|H.isDependedOn<<2|H.hasRedundancy;return U.box(U.types.sdtp,V)}},{key:"stbl",value:function(K){return U.box(U.types.stbl,U.stsd(K),U.box(U.types.stts,U.STTS),U.box(U.types.stsc,U.STSC),U.box(U.types.stsz,U.STSZ),U.box(U.types.stco,U.STCO))}},{key:"avc1",value:function(K){var W=[],V=[],H,q,Y;for(H=0;H<K.sps.length;H++)q=K.sps[H],Y=q.byteLength,W.push(255&Y>>>8),W.push(255&Y),W=W.concat(Array.prototype.slice.call(q));for(H=0;H<K.pps.length;H++)q=K.pps[H],Y=q.byteLength,V.push(255&Y>>>8),V.push(255&Y),V=V.concat(Array.prototype.slice.call(q));var z=U.box(U.types.avcC,new Uint8Array([1,W[3],W[4],W[5],255,224|K.sps.length].concat(W).concat([K.pps.length]).concat(V))),X=K.width,Q=K.height,Z=K.pixelRatio[0],J=K.pixelRatio[1];return U.box(U.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255&X>>8,255&X,255&Q>>8,255&Q,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),z,U.box(U.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),U.box(U.types.pasp,new Uint8Array([Z>>24,255&Z>>16,255&Z>>8,255&Z,J>>24,255&J>>16,255&J>>8,255&J])))}},{key:"esds",value:function(K){var W=K.config.length;return new Uint8Array([0,0,0,0,3,23+W,0,1,0,4,15+W,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([W]).concat(K.config).concat([6,1,2]))}},{key:"mp4a",value:function(K){var W=K.samplerate;return U.box(U.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,K.channelCount,0,16,0,0,0,0,255&W>>8,255&W,0,0]),U.box(U.types.esds,U.esds(K)))}},{key:"mp3",value:function(K){var W=K.samplerate;return U.box(U.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,K.channelCount,0,16,0,0,0,0,255&W>>8,255&W,0,0]))}},{key:"stsd",value:function(K){return"audio"===K.type?K.isAAC||"mp3"!==K.codec?U.box(U.types.stsd,U.STSD,U.mp4a(K)):U.box(U.types.stsd,U.STSD,U.mp3(K)):U.box(U.types.stsd,U.STSD,U.avc1(K))}},{key:"tkhd",value:function(K){var W=K.id,V=K.duration*K.timescale,H=K.width,q=K.height,Y=Math.floor(V/(M+1)),z=Math.floor(V%(M+1));return U.box(U.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,255&W>>24,255&W>>16,255&W>>8,255&W,0,0,0,0,Y>>24,255&Y>>16,255&Y>>8,255&Y,z>>24,255&z>>16,255&z>>8,255&z,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,255&H>>8,255&H,0,0,255&q>>8,255&q,0,0]))}},{key:"traf",value:function(K,W){var V=U.sdtp(K),H=K.id,q=Math.floor(W/(M+1)),Y=Math.floor(W%(M+1));return U.box(U.types.traf,U.box(U.types.tfhd,new Uint8Array([0,0,0,0,H>>24,255&H>>16,255&H>>8,255&H])),U.box(U.types.tfdt,new Uint8Array([1,0,0,0,q>>24,255&q>>16,255&q>>8,255&q,Y>>24,255&Y>>16,255&Y>>8,255&Y])),U.trun(K,V.length+16+20+8+16+8+8),V)}},{key:"trak",value:function(K){return K.duration=K.duration||4294967295,U.box(U.types.trak,U.tkhd(K),U.mdia(K))}},{key:"trex",value:function(K){var W=K.id;return U.box(U.types.trex,new Uint8Array([0,0,0,0,W>>24,255&W>>16,255&W>>8,255&W,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(K,W){var V=K.samples||[],H=V.length,q=12+16*H,Y=new Uint8Array(q),z,X,Q,Z,J,$;for(W+=8+q,Y.set([0,0,15,1,255&H>>>24,255&H>>>16,255&H>>>8,255&H,255&W>>>24,255&W>>>16,255&W>>>8,255&W],0),z=0;z<H;z++)X=V[z],Q=X.duration,Z=X.size,J=X.flags,$=X.cts,Y.set([255&Q>>>24,255&Q>>>16,255&Q>>>8,255&Q,255&Z>>>24,255&Z>>>16,255&Z>>>8,255&Z,J.isLeading<<2|J.dependsOn,J.isDependedOn<<6|J.hasRedundancy<<4|J.paddingValue<<1|J.isNonSync,61440&J.degradPrio,15&J.degradPrio,255&$>>>24,255&$>>>16,255&$>>>8,255&$],12+16*z);return U.box(U.types.trun,Y)}},{key:"initSegment",value:function(K){U.types||U.init();var W=U.moov(K),V;return V=new Uint8Array(U.FTYP.byteLength+W.byteLength),V.set(U.FTYP),V.set(W,U.FTYP.byteLength),V}}]),U}();C.default=B},{}],42:[function(I,O,C){"use strict";function F(z){return z&&z.__esModule?z:{default:z}}function N(z,X){if(!(z instanceof X))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(C,"__esModule",{value:!0});var M=function(){function z(X,Q){for(var Z=0,J;Z<Q.length;Z++)J=Q[Z],J.enumerable=J.enumerable||!1,J.configurable=!0,"value"in J&&(J.writable=!0),Object.defineProperty(X,J.key,J)}return function(X,Q,Z){return Q&&z(X.prototype,Q),Z&&z(X,Z),X}}(),B=I(33),U=F(B),G=I(32),K=F(G),W=I(50),V=I(41),H=F(V),q=I(30),Y=function(){function z(X,Q,Z,J){N(this,z),this.observer=X,this.config=Q,this.typeSupported=Z;var $=navigator.userAgent;this.isSafari=J&&-1<J.indexOf("Apple")&&$&&!$.match("CriOS"),this.ISGenerated=!1}return M(z,[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(Q){this._initPTS=this._initDTS=Q}},{key:"resetInitSegment",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(Q,Z,J,$,ee,te,ae){if(this.ISGenerated||this.generateIS(Q,Z,ee),this.ISGenerated)if(Q.samples.length){var ne=this.remuxAudio(Q,ee,te,ae);if(Z.samples.length){var oe;ne&&(oe=ne.endPTS-ne.startPTS),this.remuxVideo(Z,ee,te,oe)}}else{var le;Z.samples.length&&(le=this.remuxVideo(Z,ee,te)),le&&Q.codec&&this.remuxEmptyAudio(Q,ee,te,le)}J.samples.length&&this.remuxID3(J,ee),$.samples.length&&this.remuxText($,ee),this.observer.trigger(K.default.FRAG_PARSED)}},{key:"generateIS",value:function(Q,Z,J){var $=this.observer,ee=Q.samples,te=Z.samples,ae=this.typeSupported,ne="audio/mp4",oe={},ie=void 0===this._initPTS,se,de;if(ie&&(se=de=Infinity),Q.config&&ee.length&&(Q.timescale=Q.samplerate,W.logger.log("audio sampling rate : "+Q.samplerate),!Q.isAAC&&(ae.mpeg?(ne="audio/mpeg",Q.codec=""):ae.mp3&&(Q.codec="mp3")),oe.audio={container:ne,codec:Q.codec,initSegment:!Q.isAAC&&ae.mpeg?new Uint8Array:H.default.initSegment([Q]),metadata:{channelCount:Q.channelCount}},ie&&(se=de=ee[0].pts-Q.inputTimeScale*J)),Z.sps&&Z.pps&&te.length){var ue=Z.inputTimeScale;Z.timescale=ue,oe.video={container:"video/mp4",codec:Z.codec,initSegment:H.default.initSegment([Z]),metadata:{width:Z.width,height:Z.height}},ie&&(se=Math.min(se,te[0].pts-ue*J),de=Math.min(de,te[0].dts-ue*J),this.observer.trigger(K.default.INIT_PTS_FOUND,{initPTS:se}))}Object.keys(oe).length?($.trigger(K.default.FRAG_PARSING_INIT_SEGMENT,{tracks:oe}),this.ISGenerated=!0,ie&&(this._initPTS=se,this._initDTS=de)):$.trigger(K.default.ERROR,{type:q.ErrorTypes.MEDIA_ERROR,details:q.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(Q,Z,J,$){var ee=8,te=Q.timescale,ce=Q.samples,fe=[],ge=ce.length,pe=this._PTSNormalize,me=this._initDTS,ae,ne,oe,le,ie,se,de,ue;ce.sort(function(Je,$e){var et=Je.dts-$e.dts,tt=Je.pts-$e.pts;return et?et:tt?tt:Je.id-$e.id});var ye=ce.reduce(function(Je,$e){return Math.max(Math.min(Je,$e.pts-$e.dts),-18000)},0);if(0>ye){W.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(ye/90)+" ms to overcome this issue");for(var he=0;he<ce.length;he++)ce[he].dts+=ye}var ve=J?this.nextAvcDts:Z*te;var be=ce[0];ie=Math.max(pe(be.dts-me,ve),0),le=Math.max(pe(be.pts-me,ve),0);var Ee=Math.round((ie-ve)/90);J&&Ee&&(1<Ee?W.logger.log("AVC:"+Ee+" ms hole between fragments detected,filling it"):-1>Ee&&W.logger.log("AVC:"+-Ee+" ms overlapping between fragments detected"),ie=ve,ce[0].dts=ie+me,le=Math.max(le-Ee,ve),ce[0].pts=le+me,W.logger.log("Video/PTS/DTS adjusted: "+Math.round(le/90)+"/"+Math.round(ie/90)+",delta:"+Ee+" ms")),se=ie,be=ce[ce.length-1],ue=Math.max(pe(be.dts-me,ve),0),de=Math.max(pe(be.pts-me,ve),0),de=Math.max(de,ue);var ke=this.isSafari;ke&&(ae=Math.round((ue-ie)/(ce.length-1)));for(var Te=0,Re=0,Se=0;Se<ge;Se++){for(var Ae=ce[Se],Le=Ae.units,De=Le.length,Pe=0,Ie=0;Ie<De;Ie++)Pe+=Le[Ie].data.length;Re+=Pe,Te+=De,Ae.length=Pe,Ae.dts=ke?ie+Se*ae:Math.max(pe(Ae.dts-me,ve),ie),Ae.pts=Math.max(pe(Ae.pts-me,ve),Ae.dts)}var xe=Re+4*Te+8;try{ne=new Uint8Array(xe)}catch(Je){return void this.observer.trigger(K.default.ERROR,{type:q.ErrorTypes.MUX_ERROR,details:q.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:xe,reason:"fail allocating video mdat "+xe})}var Oe=new DataView(ne.buffer);Oe.setUint32(0,xe),ne.set(H.default.types.mdat,4);for(var Ce=0;Ce<ge;Ce++){for(var we=ce[Ce],Fe=we.units,Ne=0,Me=void 0,Be=0,Ue=Fe.length;Be<Ue;Be++){var Ge=Fe[Be],Ke=Ge.data,je=Ge.data.byteLength;Oe.setUint32(ee,je),ee+=4,ne.set(Ke,ee),ee+=je,Ne+=4+je}if(!ke){if(Ce<ge-1)ae=ce[Ce+1].dts-we.dts;else{var We=this.config,Ve=we.dts-ce[0<Ce?Ce-1:Ce].dts;if(We.stretchShortVideoTrack){var He=We.maxBufferHole,qe=We.maxSeekHole,Ye=Math.floor(Math.min(He,qe)*te),ze=($?le+$*te:this.nextAudioPts)-we.pts;ze>Ye?(ae=ze-Ve,0>ae&&(ae=Ve),W.logger.log("It is approximately "+ze/90+" ms to the next segment; using duration "+ae/90+" ms for the last video frame.")):ae=Ve}else ae=Ve}Me=Math.round(we.pts-we.dts)}else Me=Math.max(0,ae*Math.round((we.pts-we.dts)/ae));fe.push({size:Ne,duration:ae,cts:Me,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:we.key?2:1,isNonSync:we.key?0:1}})}this.nextAvcDts=ue+ae;var Xe=Q.dropped;if(Q.len=0,Q.nbNalu=0,Q.dropped=0,fe.length&&-1<navigator.userAgent.toLowerCase().indexOf("chrome")){var Qe=fe[0].flags;Qe.dependsOn=2,Qe.isNonSync=0}Q.samples=fe,oe=H.default.moof(Q.sequenceNumber++,ie,Q),Q.samples=[];var Ze={data1:oe,data2:ne,startPTS:le/te,endPTS:(de+ae)/te,startDTS:ie/te,endDTS:this.nextAvcDts/te,type:"video",nb:fe.length,dropped:Xe};return this.observer.trigger(K.default.FRAG_PARSING_DATA,Ze),Ze}},{key:"remuxAudio",value:function(Q,Z,J,$){var ee=Q.inputTimeScale,te=Q.timescale,ae=ee/te,ne=Q.isAAC?1024:1152,oe=ne*ae,le=this._PTSNormalize,ie=this._initDTS,se=!Q.isAAC&&this.typeSupported.mpeg,ue=se?0:8,Re=[],Se=[],de,ce,fe,ge,pe,me,ye,he,ve,be,Ee,ke,Te,Ae,Le,De;if(Q.samples.sort(function(qe,Ye){return qe.pts-Ye.pts}),Se=Q.samples,De=this.nextAudioPts,J|=Se.length&&De&&(0.1>Math.abs(Z-De/ee)||Math.abs(Se[0].pts-De-ie)<20*oe),J||(De=Z*ee),$&&Q.isAAC)for(var Pe=0,Ie=De;Pe<Se.length;){var xe=Se[Pe],Oe=le(xe.pts-ie,De),Ce=Oe-Ie;if(Ce<=-oe)W.logger.warn("Dropping 1 audio frame @ "+(Ie/ee).toFixed(3)+"s due to "+Math.abs(1e3*Ce/ee)+" ms overlap."),Se.splice(Pe,1),Q.len-=xe.unit.length;else if(Ce>=oe&&Ie){var we=Math.round(Ce/oe);W.logger.warn("Injecting "+we+" audio frame @ "+(Ie/ee).toFixed(3)+"s due to "+1e3*Ce/ee+" ms gap.");for(var Fe=0;Fe<we;Fe++)Le=Ie+ie,Le=Math.max(Le,ie),Ae=U.default.getSilentFrame(Q.manifestCodec||Q.codec,Q.channelCount),Ae||(W.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),Ae=xe.unit.subarray()),Se.splice(Pe,0,{unit:Ae,pts:Le,dts:Le}),Q.len+=Ae.length,Ie+=oe,Pe+=1;xe.pts=xe.dts=Ie+ie,Ie+=oe,Pe+=1}else Math.abs(Ce)>0.1*oe,Ie+=oe,xe.pts=0==Pe?xe.dts=ie+De:xe.dts=Se[Pe-1].pts+oe,Pe+=1}for(var Ne=0,Me=Se.length;Ne<Me;Ne++){if(ce=Se[Ne],ge=ce.unit,be=ce.pts-ie,Ee=ce.dts-ie,void 0!=ve)ke=le(be,ve),Te=le(Ee,ve),fe.duration=Math.round((Te-ve)/ae);else{ke=le(be,De),Te=le(Ee,De);var Be=Math.round(1e3*(ke-De)/ee),Ue=0;if(J&&Q.isAAC&&Be){if(0<Be)Ue=Math.round((ke-De)/oe),W.logger.log(Be+" ms hole between AAC samples detected,filling it"),0<Ue&&(Ae=U.default.getSilentFrame(Q.manifestCodec||Q.codec,Q.channelCount),!Ae&&(Ae=ge.subarray()),Q.len+=Ue*Ae.length);else if(-12>Be){W.logger.log(-Be+" ms overlapping between AAC samples detected, drop frame"),Q.len-=ge.byteLength;continue}ke=Te=De}if(ye=Math.max(0,ke),he=Math.max(0,Te),0<Q.len){var Ge=se?Q.len:Q.len+8;try{pe=new Uint8Array(Ge)}catch(qe){return void this.observer.trigger(K.default.ERROR,{type:q.ErrorTypes.MUX_ERROR,details:q.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Ge,reason:"fail allocating audio mdat "+Ge})}se||(de=new DataView(pe.buffer),de.setUint32(0,Ge),pe.set(H.default.types.mdat,4))}else return;for(var Ke=0;Ke<Ue;Ke++)Le=ke-(Ue-Ke)*oe,Ae=U.default.getSilentFrame(Q.manifestCodec||Q.codec,Q.channelCount),Ae||(W.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),Ae=ge.subarray()),pe.set(Ae,ue),ue+=Ae.byteLength,fe={size:Ae.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},Re.push(fe)}pe.set(ge,ue);var je=ge.byteLength;ue+=je,fe={size:je,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},Re.push(fe),ve=Te}var We=0,Ve=Re.length;if(2<=Ve&&(We=Re[Ve-2].duration,fe.duration=We),Ve){this.nextAudioPts=ke+ae*We,Q.len=0,Q.samples=Re,me=se?new Uint8Array:H.default.moof(Q.sequenceNumber++,he/ae,Q),Q.samples=[];var He={data1:me,data2:pe,startPTS:ye/ee,endPTS:this.nextAudioPts/ee,startDTS:he/ee,endDTS:(Te+ae*We)/ee,type:"audio",nb:Ve};return this.observer.trigger(K.default.FRAG_PARSING_DATA,He),He}return null}},{key:"remuxEmptyAudio",value:function(Q,Z,J,$){var ee=Q.inputTimeScale,te=Q.samplerate?Q.samplerate:ee,ne=this.nextAudioPts,oe=(void 0===ne?$.startDTS*ee:ne)+this._initDTS,le=$.endDTS*ee+this._initDTS,se=ee/te*1024,de=Math.ceil((le-oe)/se),ue=U.default.getSilentFrame(Q.manifestCodec||Q.codec,Q.channelCount);if(W.logger.warn("remux empty Audio"),!ue)return void W.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var ce=[],fe=0,ge;fe<de;fe++)ge=oe+fe*se,ce.push({unit:ue,pts:ge,dts:ge}),Q.len+=ue.length;Q.samples=ce,this.remuxAudio(Q,Z,J)}},{key:"remuxID3",value:function(Q,Z){var J=Q.samples.length,ee=Q.inputTimeScale,te=this._initPTS,ae=this._initDTS,$;if(J){for(var ne=0;ne<J;ne++)$=Q.samples[ne],$.pts=($.pts-te)/ee,$.dts=($.dts-ae)/ee;this.observer.trigger(K.default.FRAG_PARSING_METADATA,{samples:Q.samples})}Q.samples=[],Z=Z}},{key:"remuxText",value:function(Q,Z){Q.samples.sort(function(ne,oe){return ne.pts-oe.pts});var J=Q.samples.length,ee=Q.inputTimeScale,te=this._initPTS,$;if(J){for(var ae=0;ae<J;ae++)$=Q.samples[ae],$.pts=($.pts-te)/ee;this.observer.trigger(K.default.FRAG_PARSING_USERDATA,{samples:Q.samples})}Q.samples=[],Z=Z}},{key:"_PTSNormalize",value:function(Q,Z){var J;if(void 0===Z)return Q;for(J=Z<Q?-8589934592:8589934592;4294967296<Math.abs(Q-Z);)Q+=J;return Q}}]),z}();C.default=Y},{30:30,32:32,33:33,41:41,50:50}],43:[function(I,O,C){"use strict";function N(K,W){if(!(K instanceof W))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(C,"__esModule",{value:!0});var M=function(){function K(W,V){for(var H=0,q;H<V.length;H++)q=V[H],q.enumerable=q.enumerable||!1,q.configurable=!0,"value"in q&&(q.writable=!0),Object.defineProperty(W,q.key,q)}return function(W,V,H){return V&&K(W.prototype,V),H&&K(W,H),W}}(),B=I(32),U=function(K){return K&&K.__esModule?K:{default:K}}(B),G=function(){function K(W){N(this,K),this.observer=W}return M(K,[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(){}},{key:"resetInitSegment",value:function(){}},{key:"remux",value:function(V,H,q,Y,z,X,Q,Z){var J=this.observer,$="";V&&($+="audio"),H&&($+="video"),J.trigger(U.default.FRAG_PARSING_DATA,{data1:Z,startPTS:z,startDTS:z,type:$,nb:1,dropped:0}),J.trigger(U.default.FRAG_PARSED)}}]),K}();C.default=G},{32:32}],44:[function(I,O,C){"use strict";function F(G,K){if(!(G instanceof K))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(C,"__esModule",{value:!0});var N=function(){function G(K,W){for(var V=0,H;V<W.length;V++)H=W[V],H.enumerable=H.enumerable||!1,H.configurable=!0,"value"in H&&(H.writable=!0),Object.defineProperty(K,H.key,H)}return function(K,W,V){return W&&G(K.prototype,W),V&&G(K,V),K}}(),M=/^(\d+)x(\d+)$/,B=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,U=function(){function G(K){for(var W in F(this,G),"string"==typeof K&&(K=G.parseAttrList(K)),K)K.hasOwnProperty(W)&&(this[W]=K[W])}return N(G,[{key:"decimalInteger",value:function(W){var V=parseInt(this[W],10);return V>Number.MAX_SAFE_INTEGER?Infinity:V}},{key:"hexadecimalInteger",value:function(W){if(this[W]){var V=(this[W]||"0x").slice(2);V=(1&V.length?"0":"")+V;for(var H=new Uint8Array(V.length/2),q=0;q<V.length/2;q++)H[q]=parseInt(V.slice(2*q,2*q+2),16);return H}return null}},{key:"hexadecimalIntegerAsNumber",value:function(W){var V=parseInt(this[W],16);return V>Number.MAX_SAFE_INTEGER?Infinity:V}},{key:"decimalFloatingPoint",value:function(W){return parseFloat(this[W])}},{key:"enumeratedString",value:function(W){return this[W]}},{key:"decimalResolution",value:function(W){var V=M.exec(this[W]);return null===V?void 0:{width:parseInt(V[1],10),height:parseInt(V[2],10)}}}],[{key:"parseAttrList",value:function(W){var H={},V;for(B.lastIndex=0;null!==(V=B.exec(W));){var q=V[2],Y="\"";0===q.indexOf(Y)&&q.lastIndexOf(Y)===q.length-1&&(q=q.slice(1,-1)),H[V[1]]=q}return H}}]),G}();C.default=U},{}],45:[function(I,O){"use strict";O.exports={search:function(M,B){for(var U=0,G=M.length-1,K=null,W=null;U<=G;){K=0|(U+G)/2,W=M[K];var V=B(W);if(0<V)U=K+1;else if(0>V)G=K-1;else return W}return null}}},{}],46:[function(I,O,C){"use strict";function F(te,ae){if(!(te instanceof ae))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(C,"__esModule",{value:!0});var N=function(){function te(ae,ne){for(var oe=0,le;oe<ne.length;oe++)le=ne[oe],le.enumerable=le.enumerable||!1,le.configurable=!0,"value"in le&&(le.writable=!0),Object.defineProperty(ae,le.key,le)}return function(ae,ne,oe){return ne&&te(ae.prototype,ne),oe&&te(ae,oe),ae}}(),M={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},B=function(ae){var ne=ae;return M.hasOwnProperty(ae)&&(ne=M[ae]),String.fromCharCode(ne)},U=15,G=100,K={16:11,17:1,18:3,19:12,20:14,21:5,22:7,23:9},W={17:2,18:4,19:13,20:15,21:6,22:8,23:10},V={24:11,25:1,26:3,27:12,28:14,29:5,30:7,31:9},H={25:2,26:4,27:13,28:15,29:6,30:8,31:10},q=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],Y={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(ae){this.time=ae},log:function(ae,ne){var oe=this.verboseFilter[ae];this.verboseLevel>=oe&&console.log(this.time+" ["+ae+"] "+ne)}},z=function(ae){for(var ne=[],oe=0;oe<ae.length;oe++)ne.push(ae[oe].toString(16));return ne},X=function(){function te(ae,ne,oe,le,ie){F(this,te),this.foreground=ae||"white",this.underline=ne||!1,this.italics=oe||!1,this.background=le||"black",this.flash=ie||!1}return N(te,[{key:"reset",value:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}},{key:"setStyles",value:function(ne){for(var oe=["foreground","underline","italics","background","flash"],le=0,ie;le<oe.length;le++)ie=oe[le],ne.hasOwnProperty(ie)&&(this[ie]=ne[ie])}},{key:"isDefault",value:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}},{key:"equals",value:function(ne){return this.foreground===ne.foreground&&this.underline===ne.underline&&this.italics===ne.italics&&this.background===ne.background&&this.flash===ne.flash}},{key:"copy",value:function(ne){this.foreground=ne.foreground,this.underline=ne.underline,this.italics=ne.italics,this.background=ne.background,this.flash=ne.flash}},{key:"toString",value:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}]),te}(),Q=function(){function te(ae,ne,oe,le,ie,se){F(this,te),this.uchar=ae||" ",this.penState=new X(ne,oe,le,ie,se)}return N(te,[{key:"reset",value:function(){this.uchar=" ",this.penState.reset()}},{key:"setChar",value:function(ne,oe){this.uchar=ne,this.penState.copy(oe)}},{key:"setPenState",value:function(ne){this.penState.copy(ne)}},{key:"equals",value:function(ne){return this.uchar===ne.uchar&&this.penState.equals(ne.penState)}},{key:"copy",value:function(ne){this.uchar=ne.uchar,this.penState.copy(ne.penState)}},{key:"isEmpty",value:function(){return" "===this.uchar&&this.penState.isDefault()}}]),te}(),Z=function(){function te(){F(this,te),this.chars=[];for(var ae=0;ae<G;ae++)this.chars.push(new Q);this.pos=0,this.currPenState=new X}return N(te,[{key:"equals",value:function(ne){for(var oe=!0,le=0;le<G;le++)if(!this.chars[le].equals(ne.chars[le])){oe=!1;break}return oe}},{key:"copy",value:function(ne){for(var oe=0;oe<G;oe++)this.chars[oe].copy(ne.chars[oe])}},{key:"isEmpty",value:function(){for(var ne=!0,oe=0;oe<G;oe++)if(!this.chars[oe].isEmpty()){ne=!1;break}return ne}},{key:"setCursor",value:function(ne){this.pos!==ne&&(this.pos=ne),0>this.pos?(Y.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>G&&(Y.log("ERROR","Too large cursor position "+this.pos),this.pos=G)}},{key:"moveCursor",value:function(ne){var oe=this.pos+ne;if(1<ne)for(var le=this.pos+1;le<oe+1;le++)this.chars[le].setPenState(this.currPenState);this.setCursor(oe)}},{key:"backSpace",value:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}},{key:"insertChar",value:function(ne){144<=ne&&this.backSpace();var oe=B(ne);return this.pos>=G?void Y.log("ERROR","Cannot insert "+ne.toString(16)+" ("+oe+") at position "+this.pos+". Skipping it!"):void(this.chars[this.pos].setChar(oe,this.currPenState),this.moveCursor(1))}},{key:"clearFromPos",value:function(ne){var oe;for(oe=ne;oe<G;oe++)this.chars[oe].reset()}},{key:"clear",value:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}},{key:"clearToEndOfRow",value:function(){this.clearFromPos(this.pos)}},{key:"getTextString",value:function(){for(var ne=[],oe=!0,le=0,ie;le<G;le++)ie=this.chars[le].uchar," "!==ie&&(oe=!1),ne.push(ie);return oe?"":ne.join("")}},{key:"setPenStyles",value:function(ne){this.currPenState.setStyles(ne);var oe=this.chars[this.pos];oe.setPenState(this.currPenState)}}]),te}(),J=function(){function te(){F(this,te),this.rows=[];for(var ae=0;ae<U;ae++)this.rows.push(new Z);this.currRow=U-1,this.nrRollUpRows=null,this.reset()}return N(te,[{key:"reset",value:function(){for(var ne=0;ne<U;ne++)this.rows[ne].clear();this.currRow=U-1}},{key:"equals",value:function(ne){for(var oe=!0,le=0;le<U;le++)if(!this.rows[le].equals(ne.rows[le])){oe=!1;break}return oe}},{key:"copy",value:function(ne){for(var oe=0;oe<U;oe++)this.rows[oe].copy(ne.rows[oe])}},{key:"isEmpty",value:function(){for(var ne=!0,oe=0;oe<U;oe++)if(!this.rows[oe].isEmpty()){ne=!1;break}return ne}},{key:"backSpace",value:function(){var ne=this.rows[this.currRow];ne.backSpace()}},{key:"clearToEndOfRow",value:function(){var ne=this.rows[this.currRow];ne.clearToEndOfRow()}},{key:"insertChar",value:function(ne){var oe=this.rows[this.currRow];oe.insertChar(ne)}},{key:"setPen",value:function(ne){var oe=this.rows[this.currRow];oe.setPenStyles(ne)}},{key:"moveCursor",value:function(ne){var oe=this.rows[this.currRow];oe.moveCursor(ne)}},{key:"setCursor",value:function(ne){Y.log("INFO","setCursor: "+ne);var oe=this.rows[this.currRow];oe.setCursor(ne)}},{key:"setPAC",value:function(ne){Y.log("INFO","pacData = "+JSON.stringify(ne));var oe=ne.row-1;if(this.nrRollUpRows&&oe<this.nrRollUpRows-1&&(oe=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==oe){for(var le=0;le<U;le++)this.rows[le].clear();var ie=this.currRow+1-this.nrRollUpRows,se=this.lastOutputScreen;if(se){var de=se.rows[ie].cueStartTime;if(de&&de<Y.time)for(var ue=0;ue<this.nrRollUpRows;ue++)this.rows[oe-this.nrRollUpRows+ue+1].copy(se.rows[ie+ue])}}this.currRow=oe;var ce=this.rows[this.currRow];if(null!==ne.indent){var fe=ne.indent,ge=Math.max(fe-1,0);ce.setCursor(ne.indent),ne.color=ce.chars[ge].penState.foreground}var pe={foreground:ne.color,underline:ne.underline,italics:ne.italics,background:"black",flash:!1};this.setPen(pe)}},{key:"setBkgData",value:function(ne){Y.log("INFO","bkgData = "+JSON.stringify(ne)),this.backSpace(),this.setPen(ne),this.insertChar(32)}},{key:"setRollUpRows",value:function(ne){this.nrRollUpRows=ne}},{key:"rollUp",value:function(){if(null===this.nrRollUpRows)return void Y.log("DEBUG","roll_up but nrRollUpRows not set yet");Y.log("TEXT",this.getDisplayText());var ne=this.currRow+1-this.nrRollUpRows,oe=this.rows.splice(ne,1)[0];oe.clear(),this.rows.splice(this.currRow,0,oe),Y.log("INFO","Rolling up")}},{key:"getDisplayText",value:function(ne){ne=ne||!1;for(var oe=[],le="",ie=-1,se=0,de;se<U;se++)de=this.rows[se].getTextString(),de&&(ie=se+1,ne?oe.push("Row "+ie+": '"+de+"'"):oe.push(de.trim()));return 0<oe.length&&(ne?le="["+oe.join(" | ")+"]":le=oe.join("\n")),le}},{key:"getTextAndFormat",value:function(){return this.rows}}]),te}(),$=function(){function te(ae,ne){F(this,te),this.chNr=ae,this.outputFilter=ne,this.mode=null,this.verbose=0,this.displayedMemory=new J,this.nonDisplayedMemory=new J,this.lastOutputScreen=new J,this.currRollUpRow=this.displayedMemory.rows[U-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return N(te,[{key:"reset",value:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[U-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null}},{key:"getHandler",value:function(){return this.outputFilter}},{key:"setHandler",value:function(ne){this.outputFilter=ne}},{key:"setPAC",value:function(ne){this.writeScreen.setPAC(ne)}},{key:"setBkgData",value:function(ne){this.writeScreen.setBkgData(ne)}},{key:"setMode",value:function(ne){ne===this.mode||(this.mode=ne,Y.log("INFO","MODE="+ne),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=ne)}},{key:"insertChars",value:function(ne){for(var oe=0;oe<ne.length;oe++)this.writeScreen.insertChar(ne[oe]);var le=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";Y.log("INFO",le+": "+this.writeScreen.getDisplayText(!0)),("MODE_PAINT-ON"===this.mode||"MODE_ROLL-UP"===this.mode)&&(Y.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}},{key:"ccRCL",value:function(){Y.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}},{key:"ccBS",value:function(){Y.log("INFO","BS - BackSpace"),"MODE_TEXT"===this.mode||(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}},{key:"ccAOF",value:function(){}},{key:"ccAON",value:function(){}},{key:"ccDER",value:function(){Y.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}},{key:"ccRU",value:function(ne){Y.log("INFO","RU("+ne+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(ne)}},{key:"ccFON",value:function(){Y.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})}},{key:"ccRDC",value:function(){Y.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}},{key:"ccTR",value:function(){Y.log("INFO","TR"),this.setMode("MODE_TEXT")}},{key:"ccRTD",value:function(){Y.log("INFO","RTD"),this.setMode("MODE_TEXT")}},{key:"ccEDM",value:function(){Y.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()}},{key:"ccCR",value:function(){Y.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()}},{key:"ccENM",value:function(){Y.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}},{key:"ccEOC",value:function(){if(Y.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var ne=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=ne,this.writeScreen=this.nonDisplayedMemory,Y.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()}},{key:"ccTO",value:function(ne){Y.log("INFO","TO("+ne+") - Tab Offset"),this.writeScreen.moveCursor(ne)}},{key:"ccMIDROW",value:function(ne){var oe={flash:!1,underline:1==ne%2,italics:46<=ne};if(!oe.italics){var le=Math.floor(ne/2)-16;oe.foreground=["white","green","blue","cyan","red","yellow","magenta"][le]}else oe.foreground="white";Y.log("INFO","MIDROW: "+JSON.stringify(oe)),this.writeScreen.setPen(oe)}},{key:"outputDataUpdate",value:function(){var ne=Y.time;null===ne||this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(ne,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?!this.displayedMemory.equals(this.lastOutputScreen)&&(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,ne,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:ne):this.cueStartTime=ne,this.lastOutputScreen.copy(this.displayedMemory))}},{key:"cueSplitAtTime",value:function(ne){this.outputFilter&&!this.displayedMemory.isEmpty()&&(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,ne,this.displayedMemory),this.cueStartTime=ne)}}]),te}(),ee=function(){function te(ae,ne,oe){F(this,te),this.field=ae||1,this.outputs=[ne,oe],this.channels=[new $(1,ne),new $(2,oe)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return N(te,[{key:"getHandler",value:function(ne){return this.channels[ne].getHandler()}},{key:"setHandler",value:function(ne,oe){this.channels[ne].setHandler(oe)}},{key:"addData",value:function(ne,oe){var de=!1,le,ie,se;this.lastTime=ne,Y.setTime(ne);for(var ue=0;ue<oe.length;ue+=2){if(ie=127&oe[ue],se=127&oe[ue+1],0===ie&&0===se){this.dataCounters.padding+=2;continue}else Y.log("DATA","["+z([oe[ue],oe[ue+1]])+"] -> ("+z([ie,se])+")");if(le=this.parseCmd(ie,se),le||(le=this.parseMidrow(ie,se)),le||(le=this.parsePAC(ie,se)),le||(le=this.parseBackgroundAttributes(ie,se)),!le&&(de=this.parseChars(ie,se),de))if(this.currChNr&&0<=this.currChNr){var ce=this.channels[this.currChNr-1];ce.insertChars(de)}else Y.log("WARNING","No channel found yet. TEXT-MODE?");le?this.dataCounters.cmd+=2:de?this.dataCounters.char+=2:(this.dataCounters.other+=2,Y.log("WARNING","Couldn't parse cleaned data "+z([ie,se])+" orig: "+z([oe[ue],oe[ue+1]])))}}},{key:"parseCmd",value:function(ne,oe){var le=null;if(!((20===ne||28===ne)&&32<=oe&&47>=oe||(23===ne||31===ne)&&33<=oe&&35>=oe))return!1;if(ne===this.lastCmdA&&oe===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,Y.log("DEBUG","Repeated command ("+z([ne,oe])+") is dropped"),!0;le=20===ne||23===ne?1:2;var de=this.channels[le-1];return 20===ne||28===ne?32===oe?de.ccRCL():33===oe?de.ccBS():34===oe?de.ccAOF():35===oe?de.ccAON():36===oe?de.ccDER():37===oe?de.ccRU(2):38===oe?de.ccRU(3):39===oe?de.ccRU(4):40===oe?de.ccFON():41===oe?de.ccRDC():42===oe?de.ccTR():43===oe?de.ccRTD():44===oe?de.ccEDM():45===oe?de.ccCR():46===oe?de.ccENM():47===oe&&de.ccEOC():de.ccTO(oe-32),this.lastCmdA=ne,this.lastCmdB=oe,this.currChNr=le,!0}},{key:"parseMidrow",value:function(ne,oe){var le=null;if((17===ne||25===ne)&&32<=oe&&47>=oe){if(le=17===ne?1:2,le!==this.currChNr)return Y.log("ERROR","Mismatch channel in midrow parsing"),!1;var ie=this.channels[le-1];return ie.ccMIDROW(oe),Y.log("DEBUG","MIDROW ("+z([ne,oe])+")"),!0}return!1}},{key:"parsePAC",value:function(ne,oe){var le=null,ie=null;if(!((17<=ne&&23>=ne||25<=ne&&31>=ne)&&64<=oe&&127>=oe||(16===ne||24===ne)&&64<=oe&&95>=oe))return!1;if(ne===this.lastCmdA&&oe===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;le=23>=ne?1:2,ie=64<=oe&&95>=oe?1===le?K[ne]:V[ne]:1===le?W[ne]:H[ne];var ue=this.interpretPAC(ie,oe),ce=this.channels[le-1];return ce.setPAC(ue),this.lastCmdA=ne,this.lastCmdB=oe,this.currChNr=le,!0}},{key:"interpretPAC",value:function(ne,oe){var le=oe,ie={color:null,italics:!1,indent:null,underline:!1,row:ne};return le=95<oe?oe-96:oe-64,ie.underline=1==(1&le),13>=le?ie.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(le/2)]:15>=le?(ie.italics=!0,ie.color="white"):ie.indent=4*Math.floor((le-16)/2),ie}},{key:"parseChars",value:function(ne,oe){var le=null,ie=null,se=null;if(25<=ne?(le=2,se=ne-8):(le=1,se=ne),17<=se&&19>=se){var de=oe;de=17===se?oe+80:18===se?oe+112:oe+144,Y.log("INFO","Special char '"+B(de)+"' in channel "+le),ie=[de]}else 32<=ne&&127>=ne&&(ie=0===oe?[ne]:[ne,oe]);if(ie){var ue=z(ie);Y.log("DEBUG","Char codes =  "+ue.join(",")),this.lastCmdA=null,this.lastCmdB=null}return ie}},{key:"parseBackgroundAttributes",value:function(ne,oe){var le,ie,se,de;return((16===ne||24===ne)&&32<=oe&&47>=oe||(23===ne||31===ne)&&45<=oe&&47>=oe)&&(le={},16===ne||24===ne?(ie=Math.floor((oe-32)/2),le.background=q[ie],1==oe%2&&(le.background+="_semi")):45===oe?le.background="transparent":(le.foreground="black",47===oe&&(le.underline=!0)),se=24>ne?1:2,de=this.channels[se-1],de.setBkgData(le),this.lastCmdA=null,this.lastCmdB=null,!0)}},{key:"reset",value:function(){for(var ne=0;ne<this.channels.length;ne++)this.channels[ne]&&this.channels[ne].reset();this.lastCmdA=null,this.lastCmdB=null}},{key:"cueSplitAtTime",value:function(ne){for(var oe=0;oe<this.channels.length;oe++)this.channels[oe]&&this.channels[oe].cueSplitAtTime(ne)}}]),te}();C.default=ee},{}],47:[function(I,O){"use strict";var F=I(53);O.exports={newCue:function(B,U,G,K){for(var z=window.VTTCue||window.TextTrackCue,X=0,W,V,H,q,Y;X<K.rows.length;X++)if(W=K.rows[X],H=!0,q=0,Y="",!W.isEmpty()){for(var Q=0;Q<W.chars.length;Q++)W.chars[Q].uchar.match(/\s/)&&H?q++:(Y+=W.chars[Q].uchar,H=!1);W.cueStartTime=U,U===G&&(G+=1e-4),V=new z(U,G,(0,F.fixLineBreaks)(Y.trim())),16<=q?q--:q++,V.line=navigator.userAgent.match(/Firefox\//)?X+1:7<X?X-2:X+1,V.align="left",V.position=Math.max(0,Math.min(100,100*(q/32)+(navigator.userAgent.match(/Firefox\//)?50:0))),B.addCue(V)}}}},{53:53}],48:[function(I,O,C){"use strict";function N(K,W){if(!(K instanceof W))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(C,"__esModule",{value:!0});var M=function(){function K(W,V){for(var H=0,q;H<V.length;H++)q=V[H],q.enumerable=q.enumerable||!1,q.configurable=!0,"value"in q&&(q.writable=!0),Object.defineProperty(W,q.key,q)}return function(W,V,H){return V&&K(W.prototype,V),H&&K(W,H),W}}(),B=I(49),U=function(K){return K&&K.__esModule?K:{default:K}}(B),G=function(){function K(W,V,H,q){N(this,K),this.hls=W,this.defaultEstimate_=q,this.minWeight_=1e-3,this.minDelayMs_=50,this.slow_=new U.default(V),this.fast_=new U.default(H)}return M(K,[{key:"sample",value:function(V,H){V=Math.max(V,this.minDelayMs_);var q=8e3*H/V,Y=V/1e3;this.fast_.sample(Y,q),this.slow_.sample(Y,q)}},{key:"canEstimate",value:function(){var V=this.fast_;return V&&V.getTotalWeight()>=this.minWeight_}},{key:"getEstimate",value:function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}},{key:"destroy",value:function(){}}]),K}();C.default=G},{49:49}],49:[function(I,O,C){"use strict";function F(B,U){if(!(B instanceof U))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(C,"__esModule",{value:!0});var N=function(){function B(U,G){for(var K=0,W;K<G.length;K++)W=G[K],W.enumerable=W.enumerable||!1,W.configurable=!0,"value"in W&&(W.writable=!0),Object.defineProperty(U,W.key,W)}return function(U,G,K){return G&&B(U.prototype,G),K&&B(U,K),U}}(),M=function(){function B(U){F(this,B),this.alpha_=U?Math.exp(Math.log(0.5)/U):0,this.estimate_=0,this.totalWeight_=0}return N(B,[{key:"sample",value:function(G,K){var W=Math.pow(this.alpha_,G);this.estimate_=K*(1-W)+W*this.estimate_,this.totalWeight_+=G}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var G=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/G}return this.estimate_}}]),B}();C.default=M},{}],50:[function(I,O,C){"use strict";function F(){}function N(H,q){return q="["+H+"] > "+q,q}function M(H){var q=self.console[H];return q?function(){for(var Y=arguments.length,z=Array(Y),X=0;X<Y;X++)z[X]=arguments[X];z[0]&&(z[0]=N(H,z[0])),q.apply(self.console,z)}:F}function B(H){for(var q=arguments.length,Y=Array(1<q?q-1:0),z=1;z<q;z++)Y[z-1]=arguments[z];Y.forEach(function(X){K[X]=H[X]?H[X].bind(H):M(X)})}Object.defineProperty(C,"__esModule",{value:!0});var U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(H){return typeof H}:function(H){return H&&"function"==typeof Symbol&&H.constructor===Symbol&&H!==Symbol.prototype?"symbol":typeof H},G={trace:F,debug:F,log:F,warn:F,info:F,error:F},K=G,W=C.enableLogs=function(q){if(!0===q||"object"===("undefined"==typeof q?"undefined":U(q))){B(q,"debug","log","info","warn","error");try{K.log()}catch(Y){K=G}}else K=G},V=C.logger=K},{}],51:[function(I,O){"use strict";O.exports={toString:function(M){for(var B="",U=M.length,G=0;G<U;G++)B+="["+M.start(G).toFixed(3)+","+M.end(G).toFixed(3)+"]";return B}}},{}],52:[function(I,O,C){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.default=function(){function F(W){if("string"!=typeof W)return!1;var V=G[W.toLowerCase()];return!!V&&W.toLowerCase()}function N(W){if("string"!=typeof W)return!1;var V=K[W.toLowerCase()];return!!V&&W.toLowerCase()}function M(W){for(var V=1,H;V<arguments.length;V++)for(var q in H=arguments[V],H)W[q]=H[q];return W}function B(W,V,H){var q=this,Y=function(){return"undefined"==typeof navigator?void 0:/MSIE\s8\.0/.test(navigator.userAgent)}(),z={};Y?q=document.createElement("custom"):z.enumerable=!0,q.hasBeenReset=!1;var X="",Q=!1,Z=W,J=V,$=H,ee=null,te="",ae=!0,ne="auto",oe="start",le=50,ie="middle",se=50,de="middle";if(Object.defineProperty(q,"id",M({},z,{get:function(){return X},set:function(ce){X=""+ce}})),Object.defineProperty(q,"pauseOnExit",M({},z,{get:function(){return Q},set:function(ce){Q=!!ce}})),Object.defineProperty(q,"startTime",M({},z,{get:function(){return Z},set:function(ce){if("number"!=typeof ce)throw new TypeError("Start time must be set to a number.");Z=ce,this.hasBeenReset=!0}})),Object.defineProperty(q,"endTime",M({},z,{get:function(){return J},set:function(ce){if("number"!=typeof ce)throw new TypeError("End time must be set to a number.");J=ce,this.hasBeenReset=!0}})),Object.defineProperty(q,"text",M({},z,{get:function(){return $},set:function(ce){$=""+ce,this.hasBeenReset=!0}})),Object.defineProperty(q,"region",M({},z,{get:function(){return ee},set:function(ce){ee=ce,this.hasBeenReset=!0}})),Object.defineProperty(q,"vertical",M({},z,{get:function(){return te},set:function(ce){var fe=F(ce);if(!1===fe)throw new SyntaxError("An invalid or illegal string was specified.");te=fe,this.hasBeenReset=!0}})),Object.defineProperty(q,"snapToLines",M({},z,{get:function(){return ae},set:function(ce){ae=!!ce,this.hasBeenReset=!0}})),Object.defineProperty(q,"line",M({},z,{get:function(){return ne},set:function(ce){if("number"!=typeof ce&&ce!==U)throw new SyntaxError("An invalid number or illegal string was specified.");ne=ce,this.hasBeenReset=!0}})),Object.defineProperty(q,"lineAlign",M({},z,{get:function(){return oe},set:function(ce){var fe=N(ce);if(!fe)throw new SyntaxError("An invalid or illegal string was specified.");oe=fe,this.hasBeenReset=!0}})),Object.defineProperty(q,"position",M({},z,{get:function(){return le},set:function(ce){if(0>ce||100<ce)throw new Error("Position must be between 0 and 100.");le=ce,this.hasBeenReset=!0}})),Object.defineProperty(q,"positionAlign",M({},z,{get:function(){return ie},set:function(ce){var fe=N(ce);if(!fe)throw new SyntaxError("An invalid or illegal string was specified.");ie=fe,this.hasBeenReset=!0}})),Object.defineProperty(q,"size",M({},z,{get:function(){return se},set:function(ce){if(0>ce||100<ce)throw new Error("Size must be between 0 and 100.");se=ce,this.hasBeenReset=!0}})),Object.defineProperty(q,"align",M({},z,{get:function(){return de},set:function(ce){var fe=N(ce);if(!fe)throw new SyntaxError("An invalid or illegal string was specified.");de=fe,this.hasBeenReset=!0}})),q.displayState=void 0,Y)return q}if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var U="auto",G={"":!0,lr:!0,rl:!0},K={start:!0,middle:!0,end:!0,left:!0,right:!0};return B.prototype.getCueAsHTML=function(){var W=window.WebVTT;return W.convertCueToDOMTree(window,this.text)},B}()},{}],53:[function(I,O,C){"use strict";function N(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new H,this.regionList=[]}function M(z){function X(Z,J,$,ee){return 3600*(0|Z)+60*(0|J)+(0|$)+(0|ee)/1e3}var Q=z.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return Q?Q[3]?X(Q[1],Q[2],Q[3].replace(":",""),Q[4]):59<Q[1]?X(Q[1],Q[2],0,Q[4]):X(0,Q[1],Q[2],Q[4]):null}function B(){this.values=Object.create(null)}function U(z,X,Q,Z){var J=Z?z.split(Z):[z];for(var $ in J)if("string"==typeof J[$]){var ee=J[$].split(Q);if(2===ee.length){var te=ee[0],ae=ee[1];X(te,ae)}}}function G(z,X,Q){function Z(){var te=M(z);if(null===te)throw new Error("Malformed timestamp: "+ee);return z=z.replace(/^[^\sa-zA-Z-]+/,""),te}function $(){z=z.replace(/^\s+/,"")}var ee=z;if($(),X.startTime=Z(),$(),"-->"!==z.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+ee);z=z.substr(3),$(),X.endTime=Z(),$(),function(te,ae){var ne=new B;U(te,function(ie,se){switch(ie){case"region":for(var de=Q.length-1;0<=de;de--)if(Q[de].id===se){ne.set(ie,Q[de].region);break}break;case"vertical":ne.alt(ie,se,["rl","lr"]);break;case"line":var ue=se.split(","),ce=ue[0];ne.integer(ie,ce),ne.percent(ie,ce)&&ne.set("snapToLines",!1),ne.alt(ie,ce,["auto"]),2===ue.length&&ne.alt("lineAlign",ue[1],["start",Y,"end"]);break;case"position":ue=se.split(","),ne.percent(ie,ue[0]),2===ue.length&&ne.alt("positionAlign",ue[1],["start",Y,"end","line-left","line-right","auto"]);break;case"size":ne.percent(ie,se);break;case"align":ne.alt(ie,se,["start",Y,"end","left","right"]);}},/:/,/\s/),ae.region=ne.get("region",null),ae.vertical=ne.get("vertical","");var oe=ne.get("line","auto");"auto"===oe&&-1===q.line&&(oe=-1),ae.line=oe,ae.lineAlign=ne.get("lineAlign","start"),ae.snapToLines=ne.get("snapToLines",!0),ae.size=ne.get("size",100),ae.align=ne.get("align",Y);var le=ne.get("position","auto");"auto"===le&&50===q.position&&(le="start"===ae.align||"left"===ae.align?0:"end"===ae.align||"right"===ae.align?100:50),ae.position=le}(z,X)}function K(z){return z.replace(/<br(?: \/)?>/gi,"\n")}Object.defineProperty(C,"__esModule",{value:!0}),C.fixLineBreaks=void 0;var W=I(52),V=function(z){return z&&z.__esModule?z:{default:z}}(W),H=function(){return{decode:function(Q){if(!Q)return"";if("string"!=typeof Q)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(Q))}}};B.prototype={set:function(X,Q){this.get(X)||""===Q||(this.values[X]=Q)},get:function(X,Q,Z){return Z?this.has(X)?this.values[X]:Q[Z]:this.has(X)?this.values[X]:Q},has:function(X){return X in this.values},alt:function(X,Q,Z){for(var J=0;J<Z.length;++J)if(Q===Z[J]){this.set(X,Q);break}},integer:function(X,Q){/^-?\d+$/.test(Q)&&this.set(X,parseInt(Q,10))},percent:function(X,Q){var Z;return(Z=Q.match(/^([\d]{1,3})(\.[\d]*)?%$/))&&(Q=parseFloat(Q),0<=Q&&100>=Q)&&(this.set(X,Q),!0)}};var q=new V.default(0,0,0),Y="middle"===q.align?"middle":"center";N.prototype={parse:function(X){function Q(){var ne=J.buffer,oe=0;for(ne=K(ne);oe<ne.length&&"\r"!==ne[oe]&&"\n"!==ne[oe];)++oe;var le=ne.substr(0,oe);return"\r"===ne[oe]&&++oe,"\n"===ne[oe]&&++oe,J.buffer=ne.substr(oe),le}function Z(ne){U(ne,function(oe,le){"Region"===oe?console.log("parse region",le):void 0},/:/)}var J=this;X&&(J.buffer+=J.decoder.decode(X,{stream:!0}));try{var $;if("INITIAL"===J.state){if(!/\r\n|\n/.test(J.buffer))return this;$=Q();var ee=$.match(/^WEBVTT([ \t].*)?$/);if(!ee||!ee[0])throw new Error("Malformed WebVTT signature.");J.state="HEADER"}for(var te=!1;J.buffer;){if(!/\r\n|\n/.test(J.buffer))return this;switch(te?te=!1:$=Q(),J.state){case"HEADER":/:/.test($)?Z($):!$&&(J.state="ID");continue;case"NOTE":$||(J.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test($)){J.state="NOTE";break}if(!$)continue;if(J.cue=new V.default(0,0,""),J.state="CUE",-1===$.indexOf("-->")){J.cue.id=$;continue}case"CUE":try{G($,J.cue,J.regionList)}catch(ne){J.cue=null,J.state="BADCUE";continue}J.state="CUETEXT";continue;case"CUETEXT":var ae=-1!==$.indexOf("-->");if(!$||ae&&(te=!0)){J.oncue&&J.oncue(J.cue),J.cue=null,J.state="ID";continue}J.cue.text&&(J.cue.text+="\n"),J.cue.text+=$;continue;case"BADCUE":$||(J.state="ID");continue;}}}catch(ne){"CUETEXT"===J.state&&J.cue&&J.oncue&&J.oncue(J.cue),J.cue=null,J.state="INITIAL"===J.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var X=this;try{if(X.buffer+=X.decoder.decode(),(X.cue||"HEADER"===X.state)&&(X.buffer+="\n\n",X.parse()),"INITIAL"===X.state)throw new Error("Malformed WebVTT signature.")}catch(Q){throw Q}return X.onflush&&X.onflush(),this}},C.fixLineBreaks=K,C.default=N},{52:52}],54:[function(I,O){"use strict";var N=I(53),M=function(K){return K&&K.__esModule?K:{default:K}}(N),B=function(W){var V=parseInt(W.substr(-3)),H=parseInt(W.substr(-6,2)),q=parseInt(W.substr(-9,2)),Y=9<W.length?parseInt(W.substr(0,W.indexOf(":"))):0;return isNaN(V)||isNaN(H)||isNaN(q)||isNaN(Y)?-1:(V+=1e3*H,V+=60000*q,V+=3600000*Y,V)},U=function(W,V,H){var q=W[V],Y=W[q.prevCC];if(!Y||!Y.new&&q.new)return W.ccOffset=W.presentationOffset=q.start,void(q.new=!1);for(;Y&&Y.new;)W.ccOffset+=q.start-Y.start,q.new=!1,q=Y,Y=W[q.prevCC];W.presentationOffset=H};O.exports={parse:function(W,V,H,q,Y,z){var X=/\r\n|\n\r|\n|\r/g,Q=String.fromCharCode.apply(null,new Uint8Array(W)).trim().replace(X,"\n").split("\n"),Z="00:00.000",J=0,$=0,ee=0,te=[],ae,ne=!0,oe=new M.default;oe.oncue=function(le){var ie=H[q],se=H.ccOffset;ie&&ie.new&&($?se=H.ccOffset=ie.start:U(H,q,ee)),ee&&!$&&(se=ee+H.ccOffset-H.presentationOffset),le.startTime+=se-$,le.endTime+=se-$,le.text=decodeURIComponent(escape(le.text)),0<le.endTime&&te.push(le)},oe.onparsingerror=function(le){ae=le},oe.onflush=function(){return ae&&z?void z(ae):void Y(te)},Q.forEach(function(le){if(ne){if(le.startsWith("X-TIMESTAMP-MAP=")){ne=!1,le.substr(16).split(",").forEach(function(ie){ie.startsWith("LOCAL:")?Z=ie.substr(6):ie.startsWith("MPEGTS:")&&(J=parseInt(ie.substr(7)))});try{V=0>V?V+8589934592:V,J-=V,$=B(Z)/1e3,ee=J/9e4,-1==$&&(ae=new Error("Malformed X-TIMESTAMP-MAP: "+le))}catch(ie){ae=new Error("Malformed X-TIMESTAMP-MAP: "+le)}return}""===le&&(ne=!1)}oe.parse(le+"\n")}),oe.flush()}}},{53:53}],55:[function(I,O,C){"use strict";function F(U,G){if(!(U instanceof G))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(C,"__esModule",{value:!0});var N=function(){function U(G,K){for(var W=0,V;W<K.length;W++)V=K[W],V.enumerable=V.enumerable||!1,V.configurable=!0,"value"in V&&(V.writable=!0),Object.defineProperty(G,V.key,V)}return function(G,K,W){return K&&U(G.prototype,K),W&&U(G,W),G}}(),M=I(50),B=function(){function U(G){F(this,U),G&&G.xhrSetup&&(this.xhrSetup=G.xhrSetup)}return N(U,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var K=this.loader;K&&4!==K.readyState&&(this.stats.aborted=!0,K.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"load",value:function(K,W,V){this.context=K,this.config=W,this.callbacks=V,this.stats={trequest:performance.now(),retry:0},this.retryDelay=W.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function(){var W=this.context,K;K="undefined"==typeof XDomainRequest?this.loader=new XMLHttpRequest:this.loader=new XDomainRequest,K.onreadystatechange=this.readystatechange.bind(this),K.onprogress=this.loadprogress.bind(this),K.open("GET",W.url,!0),W.rangeEnd&&K.setRequestHeader("Range","bytes="+W.rangeStart+"-"+(W.rangeEnd-1)),K.responseType=W.responseType;var V=this.stats;V.tfirst=0,V.loaded=0,this.xhrSetup&&this.xhrSetup(K,W.url),this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),K.send()}},{key:"readystatechange",value:function(K){var W=K.currentTarget,V=W.readyState,H=this.stats,q=this.context,Y=this.config;if(!H.aborted&&2<=V)if(window.clearTimeout(this.requestTimeout),0===H.tfirst&&(H.tfirst=Math.max(performance.now(),H.trequest)),4===V){var z=W.status;if(200<=z&&300>z){H.tload=Math.max(H.tfirst,performance.now());var X,Q;"arraybuffer"===q.responseType?(X=W.response,Q=X.byteLength):(X=W.responseText,Q=X.length),H.loaded=H.total=Q;var Z={url:W.responseURL,data:X};this.callbacks.onSuccess(Z,H,q)}else H.retry>=Y.maxRetry||400<=z&&499>z?(M.logger.error(z+" while loading "+q.url),this.callbacks.onError({code:z,text:W.statusText},q)):(M.logger.warn(z+" while loading "+q.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,Y.maxRetryDelay),H.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),Y.timeout)}},{key:"loadtimeout",value:function(){M.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context)}},{key:"loadprogress",value:function(K){var W=this.stats;W.loaded=K.loaded,K.lengthComputable&&(W.total=K.total);var V=this.callbacks.onProgress;V&&V(W,this.context,null)}}]),U}();C.default=B},{50:50}]},{},[37])(37)})},393:function(y,E,R){(function(S,A){(function(L,D){"use strict";function I(X){"function"!=typeof X&&(X=new Function(""+X));for(var Q=Array(arguments.length-1),Z=0;Z<Q.length;Z++)Q[Z]=arguments[Z+1];var J={callback:X,args:Q};return V[W]=J,Y(W),W++}function O(X){delete V[X]}function C(X){var Q=X.callback,Z=X.args;switch(Z.length){case 0:Q();break;case 1:Q(Z[0]);break;case 2:Q(Z[0],Z[1]);break;case 3:Q(Z[0],Z[1],Z[2]);break;default:Q.apply(D,Z);}}function F(X){if(H)setTimeout(F,0,X);else{var Q=V[X];if(Q){H=!0;try{C(Q)}finally{O(X),H=!1}}}}function N(){Y=function(X){A.nextTick(function(){F(X)})}}function M(){if(L.postMessage&&!L.importScripts){var X=!0,Q=L.onmessage;return L.onmessage=function(){X=!1},L.postMessage("","*"),L.onmessage=Q,X}}function B(){var X="setImmediate$"+Math.random()+"$",Q=function(Z){Z.source===L&&"string"==typeof Z.data&&0===Z.data.indexOf(X)&&F(+Z.data.slice(X.length))};L.addEventListener?L.addEventListener("message",Q,!1):L.attachEvent("onmessage",Q),Y=function(Z){L.postMessage(X+Z,"*")}}function U(){var X=new MessageChannel;X.port1.onmessage=function(Q){var Z=Q.data;F(Z)},Y=function(Q){X.port2.postMessage(Q)}}function G(){var X=q.documentElement;Y=function(Q){var Z=q.createElement("script");Z.onreadystatechange=function(){F(Q),Z.onreadystatechange=null,X.removeChild(Z),Z=null},X.appendChild(Z)}}function K(){Y=function(X){setTimeout(F,0,X)}}if(!L.setImmediate){var W=1,V={},H=!1,q=L.document,z=Object.getPrototypeOf&&Object.getPrototypeOf(L),Y;z=z&&z.setTimeout?z:L,"[object process]"==={}.toString.call(L.process)?N():M()?B():L.MessageChannel?U():q&&"onreadystatechange"in q.createElement("script")?G():K(),z.setImmediate=I,z.clearImmediate=O}})("undefined"==typeof self?"undefined"==typeof S?this:S:self)}).call(E,R(352),R(108))},394:function(y,E,R){function S(L,D){this._id=L,this._clearFn=D}var A=Function.prototype.apply;E.setTimeout=function(){return new S(A.call(setTimeout,window,arguments),clearTimeout)},E.setInterval=function(){return new S(A.call(setInterval,window,arguments),clearInterval)},E.clearTimeout=E.clearInterval=function(L){L&&L.close()},S.prototype.unref=S.prototype.ref=function(){},S.prototype.close=function(){this._clearFn.call(window,this._id)},E.enroll=function(L,D){clearTimeout(L._idleTimeoutId),L._idleTimeout=D},E.unenroll=function(L){clearTimeout(L._idleTimeoutId),L._idleTimeout=-1},E._unrefActive=E.active=function(L){clearTimeout(L._idleTimeoutId);var D=L._idleTimeout;0<=D&&(L._idleTimeoutId=setTimeout(function(){L._onTimeout&&L._onTimeout()},D))},R(393),E.setImmediate=setImmediate,E.clearImmediate=clearImmediate},396:function(y,E,R){"use strict";Object.defineProperty(E,"__esModule",{value:!0});var S=R(7),A=R.n(S),L=R(586),D=R.n(L),I=R(357);class O extends S.Component{constructor(C){for(var F=arguments.length,N=Array(1<F?F-1:0),M=1;M<F;M++)N[M-1]=arguments[M];super(C,...N),this.state={src:null};var B=C.location.search,U=new D.a(B);Object.assign(this.state,{src:U.get("uri")||null})}componentWillMount(){var C=this.state.src;C&&this.context.setVideo({uri:C})}shouldComponentUpdate(C){return this.props.location.search!==C.location.search}componentWillUpdate(C){var F=C.location.search,N=new D.a(F),M=N.get("uri");M&&this.state.src!==M&&this.setState({src:M})}render(){return A.a.createElement("div",{"data-video-uri":this.state.src||!1},A.a.createElement(I["default"],{src:this.state.src}))}}E["default"]=O,O.contextTypes={setVideo:S.PropTypes.func.isRequired},O.displayName="Player",O.propTypes={location:S.PropTypes.shape({search:S.PropTypes.string.isRequired}).isRequired}},586:function(y,E,R){"use strict";(function(S){function A(G){return encodeURIComponent(G).replace(C,M)}function L(G){return decodeURIComponent(G.replace(F," "))}function D(G){if(this[U]=Object.create(null),!!G){"?"===G.charAt(0)&&(G=G.slice(1));for(var V=(G||"").split("&"),H=0,q=V.length,K,W;H<q;H++)W=V[H],K=W.indexOf("="),-1<K?this.append(L(W.slice(0,K)),L(W.slice(K+1))):W.length&&this.append(L(W),"")}}var O=D.prototype,C=/[!'\(\)~]|%20|%00/g,F=/\+/g,N={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"},M=function(G){return N[G]},B=function(){try{return!!Symbol.iterator}catch(G){return!1}}(),U="__URLSearchParams__:"+Math.random();O.append=function(K,W){var V=this[U];K in V?V[K].push(""+W):V[K]=[""+W]},O.delete=function(K){delete this[U][K]},O.get=function(K){var W=this[U];return K in W?W[K][0]:null},O.getAll=function(K){var W=this[U];return K in W?W[K].slice(0):[]},O.has=function(K){return K in this[U]},O.set=function(K,W){this[U][K]=[""+W]},O.forEach=function(K,W){var V=this[U];Object.getOwnPropertyNames(V).forEach(function(H){V[H].forEach(function(q){K.call(W,q,H,this)},this)},this)},O.keys=function(){var K=[];this.forEach(function(V,H){K.push(H)});var W={next:function(){var V=K.shift();return{done:void 0===V,value:V}}};return B&&(W[Symbol.iterator]=function(){return W}),W},O.values=function(){var K=[];this.forEach(function(V){K.push(V)});var W={next:function(){var V=K.shift();return{done:void 0===V,value:V}}};return B&&(W[Symbol.iterator]=function(){return W}),W},O.entries=function(){var K=[];this.forEach(function(V,H){K.push([H,V])});var W={next:function(){var V=K.shift();return{done:void 0===V,value:V}}};return B&&(W[Symbol.iterator]=function(){return W}),W},B&&(O[Symbol.iterator]=O.entries),O.toJSON=function(){return{}},O.toString=function(){var K=this[U],W=[],V,H,q,Y;for(H in K)for(q=A(H),V=0,Y=K[H];V<Y.length;V++)W.push(q+"="+A(Y[V]));return W.join("&")},y.exports=S.URLSearchParams||D}).call(E,R(352))}});
//# sourceMappingURL=chunk.1.cf40f4b9480d1bf67f62.js.map